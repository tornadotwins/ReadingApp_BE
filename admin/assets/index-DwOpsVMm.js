import{a as p,j as n}from"./createTheme-5WTCcQAP.js";import{s as i,B as u,t as pe,K as xe,u as me,F as w,A as E,H as M,E as he,Q as fe,w as Ce,q as B,T as k}from"./App-DXqbDzgb.js";import{j as $,d as ye}from"./journey.services-DTAYWN-f.js";import{S as J}from"./index-DI2t1KcP.js";import{g as be,a as P}from"./images-BNEWrLuw.js";import{A as ve,o as Se}from"./index-sI8Dvx2S.js";import{S as we}from"./index-rVfcEpoU.js";import{T as Be,B as Ie}from"./index-sTfyoM_b.js";import{C as je,I as ke,T as Te,a as Ae,P as De}from"./PreviewCollapsibleBlock-DUA8SXGL.js";import"./ArrowDownward-CFxNO1yw.js";import"./index-BqNb8qiS.js";const Ee=i(u)({position:"relative",minHeight:"calc(100vh - 37px)",width:"100%","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),Me=i(u)({width:"100%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"}),Pe=i(u)({margin:"20px 40px"}),_e=i(u)({margin:"20px 40px",display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{display:"block"}}),Le=i(u)({display:"flex",justifyContent:"space-between",alignItems:"center","& > .MuiFormControl-root":{marginRight:"20px"},"@media screen and (max-width: 650px)":{display:"block","& > .MuiFormControl-root":{alignItems:"start","& .MuiInputBase-root":{width:"100%"}}}}),Oe=i(u)({margin:"20px 40px",display:"flex",alignItems:"center","& > .MuiBox-root":{width:"120px",marginRight:"50px"},"@media screen and (max-width: 800px)":{display:"block"}}),Fe=i(u)(({isdisable:l})=>({display:"flex",justifyContent:"center",alignItems:"center",width:"160px !important",marginRight:"0px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:l=="true"?"#A1A1A1":"#FFAA5D",cursor:l=="true"?"not-allowed":"pointer",button:{width:"100%"},"&:hover":{backgroundColor:l=="true"?"#A1A1A1":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",fontWeight:"600 !important",textTransform:"none","&:hover":{backgroundColor:l=="true"?"#A1A1A1":"#EE994C"}}})),Ue=i(u)({width:"100%",padding:"20px 40px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between","@media screen and (max-width: 800px)":{flexDirection:"column"}}),Re=i(u)({display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{flexDirection:"column",width:"100%"}}),T=i(u)({display:"flex",justifyContent:"center",alignItems:"center",marginRight:"20px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:"#FFAA5D",cursor:"pointer",button:{width:"100%"},"&:hover":{backgroundColor:"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}},"@media screen and (max-width: 800px)":{width:"100%",marginRight:"0px !important",marginBottom:"10px"}}),ze=i(u)({width:"600px",display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",margin:"20px 40px 0px 40px"}),$e=i(u)({display:"flex",alignItems:"center",cursor:"pointer",transform:".25s all ease",marginBottom:"10px",alignSelf:"start","& svg":{fill:"#155D74",marginRight:"10px"},"& .MuiBox-root":{userSelect:"none"},"&:hover":{"& .MuiBox-root":{color:"#266E85"},"& svg":{fill:"#266E85"}}}),Je=i(u)({display:"flex",flexDirection:"column",width:"400px",margin:"20px 40px 0px 40px"}),He=i(u)({display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",border:"1px solid #155D74",backgroundColor:"#F0F5FB",padding:"10px",width:"100%","& .MuiBox-root":{width:"100%",wordWrap:"break-work",wordBreak:"break-word"},"& > .MuiBox-root: first-of-type":{marginBottom:"20px"},"@media screen and (max-width: 700px)":{width:"100%"}}),H=i(u)({display:"flex",alignItems:"center",width:"100%",marginBottom:"20px","& .MuiBox-root":{userSelect:"none"}}),Ge=i(u)({display:"flex",width:"100%",boxSizing:"border-box",border:"1px solid #000"});i(u)({display:"flex",margin:"20px 40px",boxSizing:"border-box",justifyContent:"space-between",gap:"20px","@media screen and (max-width: 700px)":{flexDirection:"column"}});const Ne=i(u)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),We=i(u)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),Ke=i("img")({width:"250px"}),qe=i(u)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px",width:"100%"}),Ve=i(u)({display:"flex",alignItems:"start"}),Ye=[{toolName:"Western",onClick:()=>{}},{toolName:"Arabic",onClick:()=>{}}];function Qe(l){const[G,v]=p.useState(!1),[N,W]=p.useState(l.currentJourneyBook||""),[d,_]=p.useState(l.currentLanguage),[K,q]=p.useState([]),[C,V]=p.useState(!1),[S,L]=p.useState(!1),[x,f]=p.useState([]),[O,m]=p.useState(!1),Y=xe(),A=me(),F=p.useCallback(()=>{var o;if(!((o=l.currentUser)!=null&&o.roles))return[];const e=l.currentUser.roles.reduce((a,t)=>{if(t.role!=="none"){const g=be(t.language);a.some(r=>r.value===g)||a.push({value:g,label:t.language})}return a},[]);return l.currentLanguage||l.dispatch({type:w.SET_CURRENT_LANGUAGE,payload:{language:e[0].value}}),e},[l.currentUser]);p.useEffect(()=>{const e=F();q(e),e.length>0&&!e.some(o=>o.value===d)&&_(e[0].value)},[l.currentUser,d,F]);const Q=()=>{localStorage.removeItem(ve),l.dispatch({type:w.RESET_USER}),l.dispatch({type:w.RESET_BOOK}),l.dispatch({type:w.RESET_APP_TEXT_PAGES}),A("/admin")},X=()=>n.jsx(Ce,{isLoggedIn:!0,username:l.currentUser.username,isAdmin:l.currentUser.isAdmin,onLogOut:Q}),Z=e=>{W(e),A("/admin/journeyoverview"),l.dispatch({type:w.SET_JOURNEY_BOOK,payload:{journeyBookTitle:e}})},ee=()=>n.jsx(Pe,{children:n.jsx(Ie,{books:Se.map(e=>({bookTitle:e.bookTitle,onClick:()=>{Z(e.value)}})),selectedBook:N})}),te=e=>{const o=e.target.value;_(o)},ne=()=>n.jsx(_e,{children:n.jsx(Le,{children:n.jsx(we,{label:"",options:K,value:d,backgroundColor:"#fff",textColor:"#155D74",onChange:te})})}),U=(e,o)=>{V(e),e&&L(o),!e&&L(!1),m(!0)},oe=p.useCallback(()=>{v(!0);const e=[];x.map((a,t)=>{var g;switch(a.type){case"title":{const s=a.value,r={article:l.articleId,title:{[d]:s},text:{},image:{},number:t+1,isCollapse:!1,content:[]};e.push(r);break}case"text":{const s=a.value,r={article:l.articleId,title:{},text:{[d]:s},image:{},number:t+1,isCollapse:!1,content:[]};e.push(r);break}case"image":{const s=a.value,r=s.url,c=s.alt,D={article:l.articleId,title:{},text:{},image:{url:r,alt:c},number:t+1,isCollapse:!1,content:[]};e.push(D);break}case"collapsible":{let s={article:l.articleId,title:{},text:{},image:{},number:t+1,isCollapse:!0,content:[]};const r=[],c=a.value,D=(g=c[0])==null?void 0:g.value;s={...s,title:{[d]:D}};for(const de of Object.keys(c).slice(1)){const y=c[de];if(y.type=="title"){const b={[d]:y.value,isTitle:!0};r.push(b)}else if(y.type=="text"){const b={[d]:y.value,isTitle:!1};r.push(b)}else if(y.type=="image"){const b=y.value,ge={url:b.url,alt:b.alt};r.push(ge)}}s={...s,content:r},e.push(s);break}}});const o={parentId:l.articleId,languageCode:d,isCompleted:C,isPublished:S,verses:e};$.saveArticle(o).then(()=>{E.success("Successfully saved.",{position:"top-right",draggable:!0,theme:"colored",transition:M,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),v(!1)}).catch(a=>{E.error(a.message,{position:"top-right",draggable:!0,theme:"colored",transition:M,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),v(!1)})},[x,C,S]),ae=()=>n.jsxs(Oe,{children:[n.jsx(J,{label:"Complete",value:C,disable:x.length==0,onChange:()=>U(!C,S)}),n.jsx(J,{label:"Publish",value:S,disable:!C,onChange:()=>U(C,!S)}),n.jsx(Fe,{isdisable:O?"false":"true",children:n.jsx(B,{label:"Save Changes",disabled:!O,onClick:oe})})]}),I=e=>{const a={id:`${e}-${Date.now()}`,blockIndex:x.length,type:e,value:e=="image"?{url:"",alt:""}:""};m(!0),f([...x,a])},j=e=>{const o=x.filter(a=>a.id!==e);m(!0),f(o)},le=()=>n.jsx(Ue,{children:n.jsxs(Re,{children:[n.jsx(T,{children:n.jsx(B,{label:"Add Title",onClick:()=>I("title")})}),n.jsx(T,{children:n.jsx(B,{label:"Add Text",onClick:()=>I("text")})}),n.jsx(T,{children:n.jsx(B,{label:"Add Image",onClick:()=>I("image")})}),n.jsx(T,{children:n.jsx(B,{label:"Add Collapsible",onClick:()=>I("collapsible")})})]})}),R=(e,o)=>{m(!0),f(x.map(a=>a.id==e?{...a,value:o}:a))},z=(e,o)=>{m(!0),f(a=>a.map(t=>t.id===e?{...t,value:{...t.value,...o}}:t))},re=(e,o)=>{var a;m(!0),(a=Object.values(o)[0])!=null&&a.value||m(!1),f(t=>t.map(g=>g.id==e?{...g,value:{...g.value,...o}}:g))},h=(e,o)=>{m(!0),f(a=>{const t=[...a];return o==="up"&&e>0&&([t[e],t[e-1]]=[t[e-1],t[e]]),o==="down"&&e<t.length-1&&([t[e],t[e+1]]=[t[e+1],t[e]]),t})};p.useEffect(()=>{$.getArticle(l.articleId).then(e=>{var a;const o=[];e.verses&&e.verses.length>0&&((a=e.verses)==null||a.map(t=>{var g,s;if(!t.isCollapse&&t.title){const r={id:t._id||`title-${Date.now()}-${Math.random()}`,type:"title",blockIndex:t.number,value:(g=t.title)==null?void 0:g[d]};o.push(r)}else if(!t.isCollapse&&t.text){const r={id:t._id||`text-${Date.now()}-${Math.random()}`,type:"text",blockIndex:t.number,value:(s=t.text)==null?void 0:s[d]};o.push(r)}else if(!t.isCollapse&&t.image){const r={id:t.id||`image-${Date.now()}-${Math.random()}`,type:"image",blockIndex:t.number,value:t.image};o.push(r)}else if(t.isCollapse){const r={id:t.id||`collapsible-${Date.now()}-${Math.random()}`,type:"collapsible",blockIndex:t.number,value:t};o.push(r)}})),f(o),v(!1)}).catch(e=>{E.warning(e,{position:"top-right",draggable:!0,theme:"colored",transition:M,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),v(!1)})},[d,l.articleId]);const ie=()=>n.jsxs(ze,{children:[n.jsxs($e,{onClick:()=>A("/admin/journeyoverview"),children:[n.jsx(ye,{}),n.jsx(k,{color:"#155D74",fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,children:`Back to "${l.articleTitle||"Prev"}"`})]}),x.map((e,o)=>{switch(e.type){case"title":return n.jsx(Ae,{language:P(d),inputVal:e.value,blockIndex:o,onInputChange:a=>R(e.id,a),onDelete:()=>j(e.id),onMoveUp:()=>h(o,"up"),onMoveDown:()=>h(o,"down")},e.id);case"text":return n.jsx(Te,{language:P(d),inputVal:e.value,blockIndex:o,onInputChange:a=>R(e.id,a),onDelete:()=>j(e.id),onMoveUp:()=>h(o,"up"),onMoveDown:()=>h(o,"down")},e.id);case"image":return n.jsx(ke,{url:e.value.url,alt:e.value.alt,blockIndex:o,onImageInputChange:a=>z(e.id,{url:a}),onAltInputChange:a=>z(e.id,{alt:a}),onDelete:()=>j(e.id),onMoveUp:()=>h(o,"up"),onMoveDown:()=>h(o,"down")},e.id);case"collapsible":return n.jsx(je,{language:P(d),blockIndex:o,value:e.value,onChange:a=>re(e.id,a),onDelete:()=>j(e.id),onMoveUp:()=>h(o,"up"),onMoveDown:()=>h(o,"down")},e.id);default:return null}})]}),se=()=>n.jsxs(Je,{children:[n.jsx(H,{children:n.jsx(k,{color:"#155D74",fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,children:"Journey Preview"})}),n.jsx(Ge,{children:x&&x.length>0&&n.jsx(He,{children:x.map((e,o)=>{var a;switch(e.type){case"title":return n.jsx(H,{children:n.jsx(k,{color:"black",fontWeight:"bold",textAlign:"left",fontFamily:"Inter",children:e.value})},o);case"text":return n.jsx(Ne,{children:n.jsx(k,{color:"black",fontSize:16,fontWeight:"400",fontFamily:"Inter",children:e.value})},o);case"image":return n.jsx(We,{children:n.jsx(Ke,{src:e.value.url,alt:e.value.alt})},o);case"collapsible":{const t=Object.values(e.value),g=(a=t[0])==null?void 0:a.value,s=[];for(let r=1;r<t.length;r++){const c=t[r];(c==null?void 0:c.type)=="title"?s.push({[d]:c==null?void 0:c.value,isTitle:!0}):(c==null?void 0:c.type)=="text"?s.push({[d]:c==null?void 0:c.value,isTitle:!1}):s.push(c==null?void 0:c.value)}return n.jsx(qe,{children:n.jsx(De,{language:d,blockIndex:e.blockIndex,value:e.value,title:g,contents:s,onChange:()=>{},onDelete:()=>{},onMoveDown:()=>{},onMoveUp:()=>{}})},o)}}})})})]}),ce=()=>n.jsxs(Ve,{children:[ie(),se()]}),ue=()=>n.jsxs(Me,{children:[n.jsx(Be,{tools:Ye}),ee(),ne(),ae(),le(),ce()]});return n.jsxs(n.Fragment,{children:[n.jsxs(Ee,{flexDirection:Y?"column":"row",children:[X(),ue()]}),G&&n.jsx(he,{}),n.jsx(fe,{})]})}function Xe(l){return{dispatch:l}}function Ze(l){return{currentUser:l.user.currentUser,bookInfos:l.book.bookInfos,chapterInfos:l.book.chapterInfos,currentLanguage:l.book.language,currentJourneyBook:l.journeys.journeyTitle,articleId:l.journeys.parentId,articleTitle:l.journeys.parentJourneyTitle}}const dt=pe(Ze,Xe)(Qe);export{dt as default};

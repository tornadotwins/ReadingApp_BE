import{B as we,j as o,a as c}from"./createTheme-BALI1a3O.js";import{r as je,s as _,B as E,T as O,I as ke,t as Lt,O as It,K as vt,u as Dt,F as I,A as U,H,P as Pt,R as Ut,U as Ht,Q as Mt,E as Vt,V as $t,W as Wt,X as Kt,Y as zt,w as qt,q as Gt,Z as Qt}from"./App-Bdw6BpTK.js";import{u as le,w as Yt,P as Xt,r as Zt,T as Jt,U as ea}from"./index-DVpDPE1P.js";import{j as oe,B as Be,h as ye,A as ta,i as aa,k as _e,n as Ee}from"./index-EvO0Tsir.js";import{b as ne,d as oa}from"./book.services-DPpFZPL-.js";import{t as na}from"./translator.services-BCUWsMaF.js";import{a as F,b as ue}from"./images-DAUHAXup.js";import{S as Oe}from"./index-BkzqFEF-.js";import{T as ra,B as ia}from"./index-Dv8qobKz.js";import{A as sa,S as ce}from"./index-DWgTTrXC.js";import"./TableContainer-Dl-UI7Lu.js";var ze={exports:{}};(function(e,d){(function(v,W){W()})(oe,function(){function v(n,m){return typeof m>"u"?m={autoBom:!1}:typeof m!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),m={autoBom:!m}),m.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function W(n,m,C){var f=new XMLHttpRequest;f.open("GET",n),f.responseType="blob",f.onload=function(){z(f.response,m,C)},f.onerror=function(){console.error("could not download file")},f.send()}function S(n){var m=new XMLHttpRequest;m.open("HEAD",n,!1);try{m.send()}catch{}return 200<=m.status&&299>=m.status}function k(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var m=document.createEvent("MouseEvents");m.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(m)}}var N=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof oe=="object"&&oe.global===oe?oe:void 0,x=N.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),z=N.saveAs||(typeof window!="object"||window!==N?function(){}:"download"in HTMLAnchorElement.prototype&&!x?function(n,m,C){var f=N.URL||N.webkitURL,T=document.createElement("a");m=m||n.name||"download",T.download=m,T.rel="noopener",typeof n=="string"?(T.href=n,T.origin===location.origin?k(T):S(T.href)?W(n,m,C):k(T,T.target="_blank")):(T.href=f.createObjectURL(n),setTimeout(function(){f.revokeObjectURL(T.href)},4e4),setTimeout(function(){k(T)},0))}:"msSaveOrOpenBlob"in navigator?function(n,m,C){if(m=m||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(v(n,C),m);else if(S(n))W(n,m,C);else{var f=document.createElement("a");f.href=n,f.target="_blank",setTimeout(function(){k(f)})}}:function(n,m,C,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof n=="string")return W(n,m,C);var T=n.type==="application/octet-stream",de=/constructor/i.test(N.HTMLElement)||N.safari,D=/CriOS\/[\d]+/.test(navigator.userAgent);if((D||T&&de||x)&&typeof FileReader<"u"){var q=new FileReader;q.onloadend=function(){var P=q.result;P=D?P:P.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=P:location=P,f=null},q.readAsDataURL(n)}else{var K=N.URL||N.webkitURL,M=K.createObjectURL(n);f?f.location=M:location.href=M,f=null,setTimeout(function(){K.revokeObjectURL(M)},4e4)}});N.saveAs=z.saveAs=z,e.exports=z})})(ze);var la=ze.exports,Ne={},ua=we;Object.defineProperty(Ne,"__esModule",{value:!0});var qe=Ne.default=void 0,ca=ua(je()),da=o;qe=Ne.default=(0,ca.default)((0,da.jsx)("path",{d:"M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z"}),"KeyboardBackspace");var Re={},ha=we;Object.defineProperty(Re,"__esModule",{value:!0});var Ge=Re.default=void 0,ga=ha(je()),ma=o;Ge=Re.default=(0,ga.default)((0,ma.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var Ae={},ba=we;Object.defineProperty(Ae,"__esModule",{value:!0});var Qe=Ae.default=void 0,fa=ba(je()),Ca=o;Qe=Ae.default=(0,fa.default)((0,Ca.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload");const pa=_(E)({position:"relative",minHeight:"calc(100vh - 37px)",width:"100%","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),xa=_(E)({width:"100%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"}),Sa=_(E)({margin:"20px 40px"}),Ta=_(E)({backgroundColor:"#F0F5FB",margin:"20px 40px",padding:"20px",boxSiaing:"border-box"}),ka=_(E)({margin:"20px 40px",display:"flex",justifyContent:"center",boxSizing:"border-box"}),Ba=_(E)({margin:"20px 40px",display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{display:"block"}}),ya=_(E)({height:"40px",display:"flex",alignItems:"center",cursor:"pointer",marginRight:"250px",transitionDuration:".25s","&:hover":{transform:"scale(1.1)"},"& .MuiSvgIcon-root":{width:"16px",marginRight:"10px",fill:"#155D74"},"@media screen and (max-width: 1050px)":{marginRight:"100px"},"@media screen and (max-width: 900px)":{marginRight:"30px"}}),_a=_(E)({display:"flex",justifyContent:"space-between",alignItems:"center","& >.MuiBox-root":{minWidth:"100px",marginRight:"20px"},"& > .MuiFormControl-root":{marginRight:"20px"},"@media screen and (max-width: 900px)":{"& >.MuiBox-root":{minWidth:"50px",marginRight:"10px"}},"@media screen and (max-width: 650px)":{display:"block","& > .MuiFormControl-root":{alignItems:"start","& .MuiInputBase-root":{width:"100%"}}}});_(E)({border:"1px solid #1B7695",backgroundColor:"#F0F5FB",boxSizing:"border-box",padding:"20px",margin:"20px 40px"});_(E)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"300px","& >.MuiBox-root>:nth-of-type(2)":{marginRight:"25px"}});const Ea=_(E)({display:"flex",alignItems:"center",margin:"50px 40px 20px 40px"}),We=_(E)(({active:e})=>({display:"flex",alignItems:"center",justifyContent:"center",width:"120px",padding:"5px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:e=="true"?"#1B7695":"#F0F5FB",color:e=="true"?"#FFF":"#474747",cursor:"pointer","& .MuiSvgIcon-root":{fill:e=="true"?"#FFF":"#474747",marginRight:"10px"}})),Oa=_(E)({display:"flex",justifyContent:"right",alignItems:"center",boxSizing:"border-box",margin:"20px 40px"}),wa=_(E)(({isdisable:e})=>({display:"flex",justifyContent:"center",alignItems:"center",marginLeft:"25px",padding:"0px 10px",boxSizing:"border-box",backgroundColor:"#FFAA5D",cursor:e=="true"?"not-allowed":"pointer","&:hover":{backgroundColor:e=="true"?"#FFAA5D":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:e=="true"?"#FFAA5D":"#EE994C"}}})),ja=_(E)({width:"90%",height:"calc(100% - 73px)",margin:"auto",marginTop:"20px"}),Ke=_(E)({border:"1px solid #1B7695",backgroundColor:"#F0F5FB",boxSizing:"border-box",padding:"20px",margin:"20px 40px","& .MuiAccordionDetails-root":{paddingLeft:"25px !important"},"& .MuiAccordionSummary-content > .MuiBox-root :nth-of-type(2)":{padding:"0px !important"}}),V=_(E)({height:"40px",display:"flex",alignItems:"center",width:"300px","& >.MuiBox-root:first-of-type":{minWidth:"150px",justifyContent:"left"},"& >.MuiBox-root > .MuiBox-root":{justifyContent:"left"},"& >.MuiBox-root >:first-of-type":{minWidth:"150px"},"& >.MuiBox-root >:nth-of-type(2)":{marginLeft:"10px"}});function Na(e){return e.isSpecialBook?o.jsx(Ke,{children:o.jsx(sa,{label:`Chapter name (${F(e.currentLanguage)}): `,summaryTitle:e.currentChapterTitle,onChange:d=>e.handleCurrentChapterTitleChange&&e.handleCurrentChapterTitleChange(d.target.value),onCurrentChapterTitleEnterPressed:()=>e.handleUpdateChapterSummary&&e.currentChapterTitle&&e.arabicChapterTitle&&e.transliteration&&e.englishChapterTitle&&e.handleUpdateChapterSummary(e.currentChapterTitle,e.arabicChapterTitle,e.transliteration,e.englishChapterTitle),detail:o.jsxs(o.Fragment,{children:[o.jsxs(V,{children:[o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Arabic:"}),e.currentUser.isAdmin?o.jsx(ke,{value:e.arabicChapterTitle,onChange:d=>e.handleArabicChapterTitleChange&&e.handleArabicChapterTitleChange(d.target.value),onKeyDown:d=>{d.key=="Enter"&&e.handleUpdateChapterSummary&&e.currentChapterTitle&&e.arabicChapterTitle&&e.transliteration&&e.englishChapterTitle&&e.handleUpdateChapterSummary(e.currentChapterTitle,e.arabicChapterTitle,e.transliteration,e.englishChapterTitle)}}):o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:e.arabicChapterTitle})]}),o.jsxs(V,{children:[o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Transliteration:"}),e.currentUser.isAdmin?o.jsx(ke,{value:e.transliteration,onChange:d=>e.handleTransliterationChapterTitleChange&&e.handleTransliterationChapterTitleChange(d.target.value),onKeyDown:d=>{d.key=="Enter"&&e.handleUpdateChapterSummary&&e.currentChapterTitle&&e.arabicChapterTitle&&e.transliteration&&e.englishChapterTitle&&e.handleUpdateChapterSummary(e.currentChapterTitle,e.arabicChapterTitle,e.transliteration,e.englishChapterTitle)}}):o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:e.transliteration})]}),o.jsxs(V,{children:[o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"English:"}),e.currentUser.isAdmin?o.jsx(ke,{value:e.englishChapterTitle,onChange:d=>e.handleEnglishChapterTitleChange&&e.handleEnglishChapterTitleChange(d.target.value),onKeyDown:d=>{d.key=="Enter"&&e.handleUpdateChapterSummary&&e.currentChapterTitle&&e.arabicChapterTitle&&e.transliteration&&e.englishChapterTitle&&e.handleUpdateChapterSummary(e.currentChapterTitle,e.arabicChapterTitle,e.transliteration,e.englishChapterTitle)}}):o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:e.englishChapterTitle})]}),o.jsxs(V,{children:[o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Ayas filled:"}),o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#000",children:`${e.languageCountVerse} of ${e.totalCountVerse}`})]}),o.jsx(V,{children:o.jsx(ce,{label:"Complete: ",value:e.isComplete,disable:!((e.currentUser.isAdmin||e.currentUser.roles.some(d=>d.language==F(e.currentLanguage)&&(d.role.toLowerCase()=="translator".toLowerCase()||d.role.toLowerCase()=="publisher".toLowerCase())))&&e.languageCountVerse),onChange:d=>e.translateComplete(d)})}),o.jsx(V,{children:o.jsx(ce,{label:"Publish: ",value:e.isComplete&&e.isPublish,disable:(e.currentUser.isAdmin||e.currentUser.roles.some(d=>d.language==F(e.currentLanguage)&&d.role.toLowerCase()=="publisher".toLowerCase()))&&!e.isComplete,onChange:d=>e.translatePublish(d)})})]})})}):o.jsxs(Ke,{children:[o.jsxs(V,{children:[o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Ayas filled:"}),o.jsx(O,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#000",children:`${e.languageCountVerse} of ${e.totalCountVerse}`})]}),o.jsx(V,{children:o.jsx(ce,{label:"Complete: ",value:e.isComplete,disable:!((e.currentUser.isAdmin||e.currentUser.roles.some(d=>d.language==F(e.currentLanguage)&&(d.role.toLowerCase()=="translator".toLowerCase()||d.role.toLowerCase()=="publisher".toLowerCase())))&&e.languageCountVerse),onChange:d=>e.translateComplete(d)})}),o.jsx(V,{children:o.jsx(ce,{label:"Publish: ",value:e.isComplete&&e.isPublish,disable:(e.currentUser.isAdmin||e.currentUser.roles.some(d=>d.language==F(e.currentLanguage)&&d.role.toLowerCase()=="publisher".toLowerCase()))&&!e.isComplete,onChange:d=>e.translatePublish(d)})})]})}const Ra=[{toolName:"Western",onClick:()=>{}},{toolName:"Arabic",onClick:()=>{}}];function Aa(e){const d=It(),v=d.state,[W,S]=c.useState(!1),[k,N]=c.useState(null),[x,z]=c.useState(null),[n,m]=c.useState(v.chapterInfo),[C,f]=c.useState([]),[T,de]=c.useState(null),[D,q]=c.useState(),[K,M]=c.useState([]),[P,G]=c.useState([]),[he,Q]=c.useState([]),[R,Fe]=c.useState([]),[Le,Ie]=c.useState([]),[Ye,ge]=c.useState(""),[re,ve]=c.useState([]),[Y,me]=c.useState([]),[B,Xe]=c.useState(e.currentBook),[w,X]=c.useState(v.subBookInfo.subBookId),[j,ie]=c.useState(v.chapterId),[g,De]=c.useState(e.currentLanguage),[y,Ze]=c.useState(v.isImport),[Je,be]=c.useState(!1),[fe,se]=c.useState(!1),[et,Pe]=c.useState(0),[tt,Ce]=c.useState(0),[at,Z]=c.useState(""),[ot,pe]=c.useState(""),[nt,Ue]=c.useState(""),[rt,xe]=c.useState(""),Se=c.useMemo(()=>d.state.languages,[e.currentUser]),it=vt(),Te=Dt(),st=c.useCallback(t=>{S(!0),ne.getBookInfoByTitle(t).then(a=>{var u,p,h;N(a),e.dispatch({type:I.ADD_BOOKINFO,payload:{bookInfo:a}});const r=Array.from(new Set(a.subBooks.map(i=>i.subBookId))).map(i=>a.subBooks.find(b=>b.subBookId===i)).map(i=>{var b;return{label:(b=i.subBookTitle)==null?void 0:b[g],value:i.subBookId}});ve(r),X(r.some(i=>i.value==w)?w:r.length?r[0].value:""),r.length>0&&!w&&X(r[0].value);const l=(p=(u=a==null?void 0:a.subBooks[0])==null?void 0:u.chapterInfos)==null?void 0:p.map(i=>{var b;return{label:(b=i==null?void 0:i.chapterNumber)==null?void 0:b.toString(),value:i==null?void 0:i.chapterId}});me(l),r.length>0&&!w&&X(r[0].value),Y.length>0&&ie((h=a==null?void 0:a.subBooks[0])==null?void 0:h.chapterInfos[0].chapterId),S(!1)}).catch(()=>{U.error("Failed to fetch book",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),S(!1)})},[B]),He=c.useCallback(async t=>(S(!0),await ne.getChapterInfoByChapterId(t)),[j]),J=c.useCallback(()=>{var l,u,p;const t=(l=k==null?void 0:k.subBooks)==null?void 0:l.find(h=>h.subBookId==w);let a=[],s=[];const r=((u=k==null?void 0:k.bookTitle)==null?void 0:u.en)=="Qur'an"||((p=k==null?void 0:k.bookTitle)==null?void 0:p.en)=="Zabur";if(g=="en")r?(a=["SubBook_English","SubBook_Transliteration","Chapter_Number","Verse_Number","Verse_English"],s=C==null?void 0:C.map(h=>{var i,b,A,L,$;return{SubBook_English:((i=t==null?void 0:t.subBookTitle)==null?void 0:i.en)||"",SubBook_Transliteration:((b=t==null?void 0:t.subBookTitle)==null?void 0:b.transliteration)||"",Chapter_Number:((A=n==null?void 0:n.chapterNumber)==null?void 0:A.toString())||"1",Verse_Number:((L=h==null?void 0:h.verseNumber)==null?void 0:L.toString())||"1",Verse_English:(($=h==null?void 0:h.verseText)==null?void 0:$.en)||""}})):(a=["SubBook_English","Chapter_Number","Verse_Number","Verse_English"],s=C==null?void 0:C.map(h=>{var i,b,A,L;return{SubBook_English:((i=t==null?void 0:t.subBookTitle)==null?void 0:i.en)||"",Chapter_Number:((b=n==null?void 0:n.chapterNumber)==null?void 0:b.toString())||"1",Verse_Number:((A=h==null?void 0:h.verseNumber)==null?void 0:A.toString())||"1",Verse_English:((L=h==null?void 0:h.verseText)==null?void 0:L.en)||""}}));else{const h=F(g);r?(a=["SubBook_English",`SubBook_${h}`,"SubBook_Transliteration","Chapter_Number","Verse_Number",`Verse_${h}`],s=C==null?void 0:C.map(i=>{var b,A,L,$,ee,te,ae,$e;return{SubBook_English:((b=t==null?void 0:t.subBookTitle)==null?void 0:b.en)||"",[`SubBook_${h}`]:((A=t==null?void 0:t.subBookTitle)==null?void 0:A[g])||((L=t==null?void 0:t.subBookTitle)==null?void 0:L.en)||"",SubBook_Transliteration:r&&(($=t==null?void 0:t.subBookTitle)==null?void 0:$.transliteration)||"",Chapter_Number:((ee=n==null?void 0:n.chapterNumber)==null?void 0:ee.toString())||"1",Verse_Number:((te=i==null?void 0:i.verseNumber)==null?void 0:te.toString())||"1",[`Verse_${h}`]:((ae=i==null?void 0:i.verseText)==null?void 0:ae[g])||(($e=i==null?void 0:i.verseText)==null?void 0:$e.en)||""}})):(a=["SubBook_English",`SubBook_${h}`,"Chapter_Number","Verse_Number",`Verse_${h}`],s=C==null?void 0:C.map(i=>{var b,A,L,$,ee,te,ae;return{SubBook_English:((b=t==null?void 0:t.subBookTitle)==null?void 0:b.en)||"",[`SubBook_${h}`]:((A=t==null?void 0:t.subBookTitle)==null?void 0:A[g])||((L=t==null?void 0:t.subBookTitle)==null?void 0:L.en)||"",Chapter_Number:(($=n==null?void 0:n.chapterNumber)==null?void 0:$.toString())||"1",Verse_Number:((ee=i==null?void 0:i.verseNumber)==null?void 0:ee.toString())||"1",[`Verse_${h}`]:((te=i==null?void 0:i.verseText)==null?void 0:te[g])||((ae=i==null?void 0:i.verseText)==null?void 0:ae.en)||""}}))}M(a||[]),G(s||[])},[k,n,C,w,g,y]),lt=c.useCallback(()=>{const t=`${B}-${ue(w,re)}-${ue(j,Y)}`,a=le.json_to_sheet(P),s=le.book_new();le.book_append_sheet(s,a,"Sheet1");const r=Yt(s,{bookType:"xlsx",type:"array"}),l=new Blob([r],{type:"application/octet-stream"});la.saveAs(l,`${t}.xlsx`),U.success(Pt,{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})},[P,K]);c.useEffect(()=>{window.scrollTo({top:0})},[]),c.useEffect(()=>{(async()=>{var a;S(!0);try{const s=e.bookInfos.find(r=>r.bookTitle.en==B);if(s){N(s);const l=Array.from(new Set(s.subBooks.map(u=>u.subBookId))).map(u=>s.subBooks.find(p=>p.subBookId===u)).map(u=>{var p;return{label:(p=u.subBookTitle)==null?void 0:p[g],value:u.subBookId}});ve(l),l.some(u=>u.value===w)||X(((a=l[0])==null?void 0:a.value)||"")}else await st(B);if(j){const r=e.chapterInfos.find(l=>l.chapterId==j);r?(m(r),f(r.verses)):He(j).then(l=>{m(l),f(l.verses),e.dispatch({type:I.ADD_CHAPTERINFO,payload:{chapterInfo:l}}),S(!1)}).catch(()=>{S(!1)})}J()}catch{U.error("Failed to load book information",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})}finally{S(!1)}})()},[B]),c.useEffect(()=>{var r,l,u,p,h;const t=e.bookInfos.find(i=>i.subBooks.find(b=>b.subBookId==w)),a=t==null?void 0:t.subBooks.find(i=>i.subBookId==w);a&&z(a),Z(((r=a==null?void 0:a.subBookTitle)==null?void 0:r[g])||""),pe(((l=a==null?void 0:a.subBookTitle)==null?void 0:l.ar)||""),xe(((u=a==null?void 0:a.subBookTitle)==null?void 0:u.en)||""),Ue(((p=a==null?void 0:a.subBookTitle)==null?void 0:p.transliteration)||"");const s=(h=a==null?void 0:a.chapterInfos)==null?void 0:h.map(i=>({value:i.chapterId,label:i.chapterNumber.toString()}));s&&v.chapterId?(me(s),ie(v.chapterId)):s&&(me(s),ie(s[0].value)),J()},[w]),c.useEffect(()=>{M([]),G([]);const t=e.chapterInfos.find(a=>a.chapterId==j);t?(m(t),f(t.verses)):He(j).then(a=>{m(a),f(a.verses),e.dispatch({type:I.ADD_CHAPTERINFO,payload:{chapterInfo:a}}),S(!1)}).catch(()=>{M([]),G([]),Pe(0),Ce(0),be(!1),se(!1),U.warning("Chapter is empty. Click Import to add verses.",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),S(!1)}),v.chapterId="",J()},[j]),c.useEffect(()=>{var s,r,l,u,p;J(),Ce(0);const t=((s=n==null?void 0:n.chapterIsCompleted)==null?void 0:s[g])||!1,a=((r=n==null?void 0:n.chapterIsPublished)==null?void 0:r[g])||!1;Pe(((l=n==null?void 0:n.verses)==null?void 0:l.length)||0),(u=n.verses)==null||u.map(h=>Ce(i=>{var b;return(b=h==null?void 0:h.verseText)!=null&&b[g]?i+1:i})),Z(((p=x==null?void 0:x.subBookTitle)==null?void 0:p[g])||""),be(t),se(a)},[C,k,x,n,g]),c.useEffect(()=>{y||J()},[y]),c.useEffect(()=>{const t=(D==null?void 0:D.target.files)&&(D==null?void 0:D.target.files[0]);t&&de(t)},[D,y]),c.useEffect(()=>{var t;if(y){Ie([]);const a=R[0],s=(t=Se.find(r=>r.value==g))==null?void 0:t.label;s!="English"&&Q(r=>[...r,"SubBook_English"]),a&&Object.keys(a).forEach(r=>{r=="SubBook_Transliteration"&&Q(l=>[...l,r]),s&&r.includes(s)&&Q(l=>[...l,r])}),Q(r=>[...r,"Chapter_Number","Verse_Number"]),R.forEach(r=>{const l={};l.SubBook_English=r.SubBook_English,Object.keys(r).forEach(u=>{u.includes(s)&&(l[u]=r[u]),u=="SubBook_Transliteration"&&s=="English"&&(l[u]=r[u])}),l.Chapter_Number=r.Chapter_Number,l.Verse_Number=r.Verse_Number,Ie(u=>[...u,l])})}},[R,g,y]),c.useEffect(()=>{if(y){if(Q([]),!T)return;const t=T.name,a=t.substr(t.lastIndexOf(".")+1).toLowerCase();a==="csv"?St(T):["xlsx","xls"].includes(a)?Tt(T):console.error("Unsupported file format")}},[T,g,y]),c.useEffect(()=>{if(y){const t=["SubBook_English",`SubBook_${F(g)}`,"Chapter_Number","Verse_Number",`Verse_${F(g)}`].filter((s,r,l)=>s&&l.indexOf(s)===r);let a="";if(R.length>1){const s=Object.keys(R[0]),r=t.filter(b=>!s.includes(b));r.forEach(b=>a+=`${b}, `),a&&(a=`You missed the ${r.length>=2?"fields":"field"}: `+a);const l=R[0][`SubBook_${F(g)}`];R.find(b=>b[`SubBook_${F(g)}`]!=l)&&(a=$t);const p=R[0].SubBook_Transliteration;R.find(b=>b.SubBook_Transliteration!=p)&&(a=Wt);const i=he.includes("SubBook_Transliteration");e.currentBook==Be||e.currentBook==ye?(i||(a=Kt),R.some(A=>A.Chapter_Number!="1")&&(a=zt),ge(a)):(i&&(a=Ut),ge(a))}R.length==0&&(a=Ht,ge(a))}},[P,he,y,g,R,Le]);const ut=t=>{Xe(t),Te("/admin/bookoverview"),e.dispatch({type:I.SET_BOOK,payload:{bookTitle:t}})},ct=t=>{const a=t.target.value;X(a)},dt=t=>{const a=t.target.value;ie(a)},ht=t=>{const a=t.target.value;De(a),M([]),G([]),e.dispatch({type:I.SET_CURRENT_LANGUAGE,payload:{language:a}})},Me=t=>{const a={chapterAudio:t.audio,chapterId:t._id,chapterNumber:t.chapterNumber,chapterTranslated:t.isTranslated,chapterIsCompleted:t.isCompleted,chapterIsPublished:t.isPublished,subBookId:t.subBook,verses:n.verses},s=e.bookInfos.map(r=>({...r,subBooks:r.subBooks.map(l=>({...l,chapterInfos:l.chapterInfos.map(u=>u.chapterId===j?{...u,...a}:u)}))}));e.dispatch({type:I.SET_BOOKINFOS,payload:{bookInfos:s}}),e.dispatch({type:I.UPDATE_CHAPTERINFOS,payload:{chapterInfo:a}})},gt=t=>{const a={chapterInfos:(x==null?void 0:x.chapterInfos)||[],subBookId:(x==null?void 0:x.subBookId)||"",subBookNumber:(x==null?void 0:x.subBookNumber)||1,subBookTitle:t.title,noChapter:!0},s=e.bookInfos.map(r=>({...r,subBooks:r.subBooks.map(l=>l.subBookId==w?{...l,...a}:l)}));e.dispatch({type:I.SET_BOOKINFOS,payload:{bookInfos:s}})},mt=async t=>{be(t),se(t&&fe),S(!0);const a={chapterNumber:n.chapterNumber||1,subBook:n.subBookId||"",audio:n.chapterAudio,isTranslated:n.chapterTranslated,isCompleted:{...n.chapterIsCompleted,[g]:t},isPublished:{...n.chapterIsPublished,[g]:t&&fe}};ne.updateChapterInfo({chapterId:j,newChapterInfo:a}).then(s=>{Me(s),S(!1)}).catch(()=>{U.error("Failed to complete the chapter",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),S(!1)})},bt=async t=>{se(t);const a={chapterNumber:n.chapterNumber||1,subBook:n.subBookId||"",audio:n.chapterAudio,isTranslated:n.chapterTranslated,isCompleted:n.chapterIsCompleted,isPublished:{...n.chapterIsPublished,[g]:t}};ne.updateChapterInfo({chapterId:j,newChapterInfo:a}).then(s=>{Me(s),S(!1)}).catch(()=>{U.error("Failed to publish the chapter",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),S(!1)})},ft=t=>{g=="en"?xe(t):g=="ar"&&pe(t),Z(t)},Ct=t=>{g=="ar"&&Z(t),pe(t)},pt=t=>{g=="en"&&Z(t),xe(t)},xt=(t,a,s,r)=>{const l={[`${g}`]:t,ar:a,transliteration:s,en:r},u={...x,subBookTitle:l},p={title:u.subBookTitle,number:u.subBookNumber||1,book:(k==null?void 0:k.bookId)||"",noChapter:!0};x!=null&&x.subBookId?(S(!0),ne.updateSubBookInfo({subBookId:x==null?void 0:x.subBookId,newSubBookInfo:p}).then(h=>{gt(h),S(!1)}).catch(()=>{U.error("Failed to update the summary of chapter",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),S(!1)})):U.error(Qt,{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})},Ve=t=>{Ze(t),M([]),G([])},St=t=>{try{const a=new FileReader;a.onload=s=>{var l;const r=(l=s.target)==null?void 0:l.result;if(!r){console.error("Failed to read file");return}Xt.parse(r,{complete:u=>{if(u.errors.length>0){console.error("CSV parsing errors:",u.errors);return}const p=u.data;Fe(p)},header:!0,skipEmptyLines:!0,transformHeader:u=>u.trim(),transform:u=>u.trim()})},a.onerror=s=>{console.error("Error reading file:",s)},a.readAsText(t)}catch(a){console.error("Error parsing CSV file:",a)}},Tt=c.useCallback(async t=>{try{const a=new FileReader;a.onload=s=>{var i;const r=(i=s.target)==null?void 0:i.result;if(!r){console.error("Failed to read file");return}const l=Zt(r,{type:"array"}),u=l.SheetNames[0],p=l.Sheets[u],h=le.sheet_to_json(p);Fe(h)},a.onerror=s=>{console.error("Error reading file:",s)},a.readAsArrayBuffer(t)}catch(a){console.error("Error parsing Excel file:",a)}},[T]),kt=()=>{na.saveBook({bookInfos:Le,bookTitle:e.currentBook,language:F(g)}).then(()=>{U.success("Saved successfully!",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})}).catch(()=>{U.success("Failed to save book",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})})},Bt=()=>{localStorage.removeItem(ta),e.dispatch({type:I.RESET_USER}),e.dispatch({type:I.RESET_BOOK}),e.dispatch({type:I.RESET_APP_TEXT_PAGES}),Te("/admin")},yt=()=>o.jsx(qt,{isLoggedIn:!0,username:e.currentUser.username,isAdmin:e.currentUser.isAdmin,onLogOut:Bt}),_t=()=>o.jsx(Sa,{children:o.jsx(ia,{books:aa.map(t=>({bookTitle:t.bookTitle,onClick:()=>{ut(t.value)}})),selectedBook:B})}),Et=()=>y&&o.jsx(Ta,{children:o.jsx(O,{color:"red",fontFamily:"'Baloo Da 2'",fontWeight:"bold",children:B==Be||B==ye?`For ${B} you can upload only one chapter at once`:`For ${B} you can upload multiple chapters of the same sub-book at once`})}),Ot=()=>o.jsxs(Ba,{children:[o.jsxs(ya,{onClick:()=>Te("/admin/bookoverview"),children:[o.jsx(qe,{}),o.jsx(O,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:"overview"})]}),!y&&o.jsxs(_a,{children:[o.jsx(O,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:B==_e||B==Ee?"Go to: ":"Go to Surah: "}),o.jsx(Oe,{label:"",options:re,value:re.find(t=>t.value===w)?w:"",backgroundColor:"#fff",textColor:"#155D74",onChange:ct}),(B==_e||B==Ee)&&o.jsx(Oe,{label:"",options:Y,value:Y.find(t=>t.value===j)?j:"",backgroundColor:"#fff",textColor:"#155D74",onChange:dt}),o.jsx(Oe,{label:"",options:Se,value:g,backgroundColor:"#fff",textColor:"#155D74",onChange:ht})]})]}),wt=()=>!y&&o.jsx(Na,{currentUser:e.currentUser,currentBook:e.currentBook,totalCountVerse:et,languageCountVerse:tt,isComplete:Je,isPublish:fe,isSpecialBook:B==Be||B==ye,currentLanguage:g,arabicChapterTitle:ot,englishChapterTitle:rt,transliteration:nt,currentChapterTitle:at,translateComplete:t=>mt(t),translatePublish:t=>bt(t),handleCurrentChapterTitleChange:t=>ft(t),handleArabicChapterTitleChange:t=>Ct(t),handleTransliterationChapterTitleChange:t=>Ue(t),handleEnglishChapterTitleChange:t=>pt(t),handleUpdateChapterSummary:xt}),jt=()=>o.jsxs(Ea,{children:[o.jsxs(We,{active:y?"false":"true",onClick:()=>Ve(!1),children:[o.jsx(Qe,{}),o.jsx(O,{fontFamily:"'Baloo Da 2'",children:"Database"})]}),o.jsxs(We,{active:y?"true":"false",onClick:()=>Ve(!0),children:[o.jsx(oa,{}),o.jsx(O,{fontFamily:"'Baloo Da 2'",children:"Import"})]})]}),Nt=()=>!y&&o.jsxs(Oa,{children:[o.jsx(O,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:`${B} - 
            ${ue(w,re)} 
            ${B==_e||B==Ee?ue(j,Y):""}`}),o.jsx(wa,{isdisable:K.length?"false":"true",children:o.jsx(Gt,{label:"Export to Excel",disabled:!K.length,icon:o.jsx(Ge,{}),onClick:lt})})]}),Rt=()=>!y&&o.jsx(ka,{children:o.jsx(Jt,{headers:K,rows:P})}),At=()=>y&&o.jsx(ja,{children:o.jsx(ea,{language:g,languageLabel:F(g),languages:Se,file:T,parsedData:R,headers:he,error:Ye,onChangeLanguage:t=>De(t.target.value),onChangeFile:t=>q(t),onUpload:kt})}),Ft=()=>o.jsxs(xa,{children:[o.jsx(ra,{tools:Ra}),_t(),jt(),Ot(),Et(),wt(),Nt(),Rt(),At()]});return o.jsxs(o.Fragment,{children:[o.jsxs(pa,{flexDirection:it?"column":"row",children:[yt(),Ft()]}),o.jsx(Mt,{}),W&&o.jsx(Vt,{})]})}function Fa(e){return{dispatch:e}}function La(e){return{currentUser:e.user.currentUser,bookInfos:e.book.bookInfos,chapterInfos:e.book.chapterInfos,currentBook:e.book.book,currentLanguage:e.book.language}}const za=Lt(La,Fa)(Aa);export{za as default};

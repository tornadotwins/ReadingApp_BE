import{a as n,j as d}from"./createTheme-CQxaqkbK.js";import{s as p,z as y,D as $,_ as I,E as M,K,$ as q,N as z,H as C,J as v,X as J}from"./App-Cd_NeJB5.js";import{U as X,P as Y,r as G,u as Q}from"./index-eHDfJkCz.js";import{A as W}from"./index-CeJZj2zO.js";import{t as Z}from"./translator.services-BXop6yax.js";import"./index-C4SHjxdA.js";import"./TableContainer-BixVrtgm.js";const ee=p(y)({display:"flex"}),re=p(ee)({justifyContent:"center",alignItems:"center"}),te=p(re)({width:"100%",height:"100vh","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),oe=p(y)({width:"90%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"});function se(l){const N=I(),j=M(),S=[{label:"English",value:"en"},{label:"Arabic",value:"ar"}],A="Injil",[g,P]=n.useState(S[0].value),[c,F]=n.useState(""),[h,L]=n.useState(null),[u,O]=n.useState(),[E,m]=n.useState([]),[i,_]=n.useState([]),[D,B]=n.useState([]),[H,k]=n.useState("");n.useEffect(()=>{const t=(u==null?void 0:u.target.files)&&(u==null?void 0:u.target.files[0]);t&&L(t)},[u]);const R=t=>{try{const e=new FileReader;e.onload=a=>{var o;const r=(o=a.target)==null?void 0:o.result;if(!r){console.error("Failed to read file");return}Y.parse(r,{complete:s=>{if(s.errors.length>0){console.error("CSV parsing errors:",s.errors);return}const b=s.data;_(b)},header:!0,skipEmptyLines:!0,transformHeader:s=>s.trim(),transform:s=>s.trim()})},e.onerror=a=>{console.error("Error reading file:",a)},e.readAsText(t)}catch(e){console.error("Error parsing CSV file:",e)}},U=async t=>{try{const e=new FileReader;e.onload=a=>{var x;const r=(x=a.target)==null?void 0:x.result;if(!r){console.error("Failed to read file");return}const o=G(r,{type:"array"}),s=o.SheetNames[0],b=o.Sheets[s],T=Q.sheet_to_json(b);_(T)},e.onerror=a=>{console.error("Error reading file:",a)},e.readAsArrayBuffer(t)}catch(e){console.error("Error parsing Excel file:",e)}},w=()=>{Z.saveBook({bookInfos:D,bookTitle:A,language:c}).then(()=>{C.success("Saved successfully!",{position:"top-right",draggable:!0,theme:"colored",transition:v,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})}).catch(t=>{C.success(t,{position:"top-right",draggable:!0,theme:"colored",transition:v,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})})};n.useEffect(()=>{if(m([]),!h)return;const t=h.name,e=t.substr(t.lastIndexOf(".")+1).toLowerCase();e==="csv"?R(h):["xlsx","xls"].includes(e)?U(h):console.error("Unsupported file format")},[h,g]),n.useEffect(()=>{var a;B([]);const t=i[0],e=(a=S.find(r=>r.value==g))==null?void 0:a.label;e!="English"&&m(r=>[...r,"SubBook_English"]),t&&Object.keys(t).forEach(r=>{r=="SubBook_Transliteration"&&m(o=>[...o,r]),e&&r.includes(e)&&m(o=>[...o,r])}),m(r=>[...r,"Chapter_Number","Verse_Number"]),i.forEach(r=>{const o={};o.SubBook_English=r.SubBook_English,Object.keys(r).forEach(s=>{s.includes(e)&&(o[s]=r[s]),s=="SubBook_Transliteration"&&e=="English"&&(o[s]=r[s])}),o.Chapter_Number=r.Chapter_Number,o.Verse_Number=r.Verse_Number,B(s=>[...s,o])})},[i,g]),n.useEffect(()=>{var e;m([]);const t=(e=S.find(a=>a.value==g))==null?void 0:e.label;t&&F(t)},[g]),n.useEffect(()=>{const t=["SubBook_English",`SubBook_${c}`,"Chapter_Number","Verse_Number",`Verse_${c}`].filter((a,r,o)=>a&&o.indexOf(a)===r);let e="";if(i.length>1){const a=Object.keys(i[0]),r=t.filter(f=>!a.includes(f));r.forEach(f=>e+=`${f}, `),e&&(e=`You missed the ${r.length>=2?"fields":"field"}: `+e);const o=i[0][`SubBook_${c}`];i.find(f=>f[`SubBook_${c}`]!=o)&&(e="A file must have only 1 sub book.");const b=i[0].SubBook_Transliteration;i.find(f=>f.SubBook_Transliteration!=b)&&(e="A file must have only 1 transliteration for a sub book."),E.includes("SubBook_Transliteration")&&(e="SubBook_Transliteration field is not required."),k(e)}i.length==0&&(e="Please select the file to upload.",k(e))},[E,c,i]);const V=()=>{localStorage.removeItem(W),l.dispatch({type:J.SET_CURRENT_USER,payload:{user:null}}),j("/admin")};return d.jsxs(d.Fragment,{children:[d.jsx(K,{title:q}),d.jsxs(te,{flexDirection:N?"column":"row",children:[d.jsx(z,{isAdmin:!!l.currentUser.isAdmin,username:l.currentUser.username,isLoggedIn:!0,onLogOut:V}),d.jsx(oe,{children:d.jsx(X,{language:g,languageLabel:c,languages:S,file:h,parsedData:i,headers:E,error:H,onChangeLanguage:t=>P(t.target.value),onChangeFile:t=>O(t),onUpload:w})})]})]})}function ae(l){return{dispatch:l}}function ne(l){return{currentUser:l.user.currentUser}}const he=$(ne,ae)(se);export{he as default};

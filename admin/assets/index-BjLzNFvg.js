import{a as g,j as n}from"./createTheme-ofxqs-8J.js";import{s as u,B as p,t as Te,W as Ee,K as Ae,u as De,A as R,H as L,E as Oe,Q as Pe,w as Me,F as E,q as k,T as z}from"./App-CZPziNuo.js";import{S as X}from"./index-CZAKi42N.js";import{a as N}from"./images-B-3euPqr.js";import{b as _e,o as Fe,k as Re,v as Le}from"./index-BPeTlqA_.js";import{S as Z}from"./index-BnrL84cM.js";import{T as ze,B as Ne}from"./index-geY3h-VB.js";import{C as Ue,I as $e,T as We,a as Ge,P as He}from"./PreviewCollapsibleBlock-3jofhsMU.js";import{b as ee}from"./book.services-B6NiTZsh.js";import"./ArrowDownward-Cje-TYvg.js";import"./index-5XX5DSGf.js";const Ke=u(p)({position:"relative",minHeight:"calc(100vh - 37px)",width:"100%","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),qe=u(p)({width:"100%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"}),Ve=u(p)({margin:"20px 40px"}),Ye=u(p)({margin:"20px 40px",display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{display:"block"}}),Je=u(p)({display:"flex",justifyContent:"space-between",alignItems:"center","& > .MuiFormControl-root":{marginRight:"20px"},"@media screen and (max-width: 650px)":{display:"block","& > .MuiFormControl-root":{alignItems:"start","& .MuiInputBase-root":{width:"100%"}}}}),Qe=u(p)({margin:"20px 40px",display:"flex",alignItems:"center","& > .MuiBox-root":{width:"120px",marginRight:"50px"},"@media screen and (max-width: 800px)":{display:"block"}}),Xe=u(p)(({isdisable:i})=>({display:"flex",justifyContent:"center",alignItems:"center",width:"160px !important",marginRight:"0px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:i=="true"?"#A1A1A1":"#FFAA5D",cursor:i=="true"?"not-allowed":"pointer",button:{width:"100%"},"&:hover":{backgroundColor:i=="true"?"#A1A1A1":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",fontWeight:"600 !important",textTransform:"none","&:hover":{backgroundColor:i=="true"?"#A1A1A1":"#EE994C"}}})),Ze=u(p)({width:"100%",padding:"20px 40px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between","@media screen and (max-width: 800px)":{flexDirection:"column"}}),et=u(p)({display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{flexDirection:"column",width:"100%"}}),O=u(p)(({isdisable:i})=>({display:"flex",justifyContent:"center",alignItems:"center",marginRight:"20px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:i==="true"?"#c0c0c0":"#FFAA5D",cursor:i==="true"?"not-allowed":"pointer",button:{width:"100%"},"&:hover":{backgroundColor:i==="true"?"#c0c0c0":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}},"@media screen and (max-width: 800px)":{width:"100%",marginRight:"0px !important",marginBottom:"10px"}})),tt=u(p)({display:"flex",justifyContent:"center",alignItems:"center",padding:"5px 10px",width:"150px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:"#FFAA5D",cursor:"pointer",button:{width:"100%"},"&:hover":{backgroundColor:"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}},"@media screen and (max-width: 800px)":{width:"100%"}}),ot=u(p)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:"100%"}),nt=u(p)({display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",border:"1px solid #155D74",borderRadius:"4px",backgroundColor:"#F0F5FB",padding:"10px",width:"300px",marginBottom:"10px","& .MuiBox-root":{width:"100%",wordWrap:"break-work",wordBreak:"break-word"},"& > .MuiBox-root: first-of-type":{marginBottom:"20px"},"@media screen and (max-width: 700px)":{width:"100%"}}),at=u(p)({display:"flex",alignItems:"center",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),st=u(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),rt=u(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),lt=u("img")({width:"250px"}),it=u(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px",width:"100%"}),ct=u(p)({display:"flex",margin:"20px 40px",boxSizing:"border-box",justifyContent:"space-between",gap:"20px","@media screen and (max-width: 700px)":{flexDirection:"column"}}),dt=[{toolName:"Western",onClick:()=>{}},{toolName:"Arabic",onClick:()=>{}}];function ut(i){var Y,J,Q;const v=Ee(),[te,B]=g.useState(!1),[P,oe]=g.useState(i.currentBook),[j,U]=g.useState((Y=v.state.subBookInfo)==null?void 0:Y.subBookId),[b,ne]=g.useState(v.state.chapterId),[r,ae]=g.useState(i.currentLanguage),[$,se]=g.useState([]),[w,W]=g.useState(((J=v.state.subBookInfo.chapterInfos[0].chapterIsCompleted)==null?void 0:J[r])||!1),[T,M]=g.useState(((Q=v.state.subBookInfo.chapterInfos[0].chapterIsPublished)==null?void 0:Q[r])||!1),[_,re]=g.useState(!0),[F,le]=g.useState([]),[x,f]=g.useState([]),[G,C]=g.useState(!1),ie=Ae(),H=De(),ce=g.useMemo(()=>v.state.languages,[v]);g.useEffect(()=>{var s,l;const e=i.bookInfos.find(a=>a.bookTitle.en==i.currentBook),t=(s=e==null?void 0:e.subBooks)==null?void 0:s.find(a=>a.subBookId==j),o=(t==null?void 0:t.chapterInfos)&&(t==null?void 0:t.chapterInfos[0].chapterNumber)==0&&((l=t==null?void 0:t.chapterInfos[0])==null?void 0:l.chapterId)||"";ne(o)},[j]),g.useEffect(()=>{B(!0),f([]),ee.getIntroVerses(b).then(e=>{var o,s,l;W(((o=e.isCompleted)==null?void 0:o[r])||!1),M(((s=e.isPublished)==null?void 0:s[r])||!1);const t=[];e.verses&&e.verses.length>0&&(le(e.verses),(l=e.verses)==null||l.map(a=>{var c,h;const d=a.number;if(!a.isCollapse&&a.title){const m={id:a.id||`title-${Date.now()}-${Math.random()}`,type:"title",blockIndex:d,value:(c=a.title)==null?void 0:c[r]};t.push(m)}else if(!a.isCollapse&&a.text){const m={id:a.id||`text-${Date.now()}-${Math.random()}`,type:"text",blockIndex:d,value:(h=a.text)==null?void 0:h[r]};t.push(m)}else if(!a.isCollapse&&a.image){const m={id:a.id||`image-${Date.now()}-${Math.random()}`,type:"image",blockIndex:d,value:a.image};t.push(m)}else if(a.isCollapse){const m={id:a.id||`collapsible-${Date.now()}-${Math.random()}`,type:"collapsible",blockIndex:d,value:a};t.push(m)}})),f(t),B(!1)}).catch(e=>{console.log(`warning/error while getting intro information: 
`,e),R.warning("No introduction information for the chapter.",{position:"top-right",draggable:!0,theme:"colored",transition:L,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)})},[b,r]);const de=()=>{localStorage.removeItem(_e),i.dispatch({type:E.RESET_USER}),i.dispatch({type:E.RESET_BOOK}),i.dispatch({type:E.RESET_APP_TEXT_PAGES}),H("/admin")},ue=()=>n.jsx(Me,{isLoggedIn:!0,username:i.currentUser.username,isAdmin:i.currentUser.isAdmin,isTranslationPage:!0,onLogOut:de}),pe=e=>{oe(e),H("/admin/bookoverview"),i.dispatch({type:E.SET_BOOK,payload:{bookTitle:e}})},ge=()=>n.jsx(Ve,{children:n.jsx(Ne,{books:Fe.map(e=>({bookTitle:e.bookTitle,onClick:()=>{pe(e.value)}})),selectedBook:P})});g.useEffect(()=>{var t;const e=i.bookInfos.find(o=>o.bookTitle.en==i.currentBook);if(e){const s=Array.from(new Set(e.subBooks.map(l=>l.subBookId))).map(l=>e.subBooks.find(a=>a.subBookId===l)).map(l=>{var a,d,c;return{label:((a=l.subBookTitle)==null?void 0:a[r])||((d=l.subBookTitle)==null?void 0:d.en)||((c=l.subBookTitle)==null?void 0:c.ar)||"No Sub book title",value:l.subBookId}});se(s),U(((t=v.state.subBookInfo)==null?void 0:t.subBookId)||s[0].value)}},[i.currentBook]);const he=e=>{const t=e.target.value;U(t)},xe=e=>{const t=e.target.value;ae(t)},me=()=>n.jsx(Ye,{children:n.jsxs(Je,{children:[(P==Re||P==Le)&&n.jsx(Z,{label:"",options:$,value:$.find(e=>e.value===j)?j:"",backgroundColor:"#fff",textColor:"#155D74",onChange:he}),n.jsx(Z,{label:"",options:ce,value:r,backgroundColor:"#fff",textColor:"#155D74",onChange:xe})]})}),K=(e,t)=>{W(e),e&&M(t),!e&&M(!1),C(!0)},be=e=>{const t={chapterAudio:e.audio,chapterId:e._id,chapterNumber:e.chapterNumber,chapterTranslated:e.isTranslated,chapterIsCompleted:e.isCompleted,chapterIsPublished:e.isPublished,subBookId:e.subBook},o=i.bookInfos.map(s=>({...s,subBooks:s.subBooks.map(l=>({...l,chapterInfos:l.chapterInfos.map(a=>a.chapterId===b?{...a,...t}:a)}))}));i.dispatch({type:E.SET_BOOKINFOS,payload:{bookInfos:o}})},fe=g.useCallback(()=>{B(!0);const e=[];x.map((o,s)=>{var a;const l=F==null?void 0:F.find(d=>(d==null?void 0:d.id)===(o==null?void 0:o.id));switch(o.type){case"title":{const d=l==null?void 0:l.title,c=o.value,h={chapter:b,title:{...d,[r]:c},text:{},image:{},number:s+1,isCollapse:!1,content:[]};e.push(h);break}case"text":{const d=l==null?void 0:l.text,c=o.value,h={chapter:b,title:{},text:{...d,[r]:c},image:{},number:s+1,isCollapse:!1,content:[]};e.push(h);break}case"image":{const d=o.value,c=d.url,h=d.alt,m={chapter:b,title:{},text:{},image:{url:c,alt:h},number:s+1,isCollapse:!1,content:[]};e.push(m);break}case"collapsible":{let d={chapter:b,title:{},text:{},image:{},number:s+1,isCollapse:!0,content:[]};const c=[],h=o.value,m=(a=h[0])==null?void 0:a.value;d={...d,title:{[r]:m}};for(const ke of Object.keys(h).slice(1)){const I=h[ke];if(I.type=="title"){const y={[r]:I.value,isTitle:!0};c.push(y)}else if(I.type=="text"){const y={[r]:I.value,isTitle:!1};c.push(y)}else if(I.type=="image"){const y=I.value,je={url:y.url,alt:y.alt};c.push(je)}}d={...d,content:c},e.push(d);break}}});const t={languageCode:r,subBookId:j,chapterId:b,isCompleted:{[r]:w},isPublished:{[r]:T},verses:e};ee.updateIntroData(t).then(o=>{be(o),R.success("Successfully updated.",{position:"top-right",draggable:!0,theme:"colored",transition:L,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)}).catch(o=>{R.error(o.message,{position:"top-right",draggable:!0,theme:"colored",transition:L,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)})},[x,w,T]),Ce=()=>n.jsxs(Qe,{children:[n.jsx(X,{label:"Complete",value:w,disable:x.length==0,onChange:()=>K(!w,T)}),n.jsx(X,{label:"Publish",value:T,disable:!w,onChange:()=>K(w,!T)}),n.jsx(Xe,{isdisable:G?"false":"true",children:n.jsx(k,{label:"Save Changes",disabled:!G,onClick:fe})})]}),A=e=>{const o={id:`${e}-${Date.now()}`,blockIndex:x.length,type:e,value:e=="image"?{url:"",alt:""}:""};C(!0),f([...x,o])},D=e=>{const t=x.filter(o=>o.id!==e);C(!0),f(t)},Se=()=>n.jsxs(Ze,{children:[n.jsxs(et,{children:[n.jsx(O,{isdisable:r!=="en"?"true":"false",children:n.jsx(k,{label:"Add Title",disabled:r!="en",tooltip:r!="en"?"You can only add title in English.":"",onClick:()=>A("title")})}),n.jsx(O,{isdisable:r!=="en"?"true":"false",children:n.jsx(k,{label:"Add Text",disabled:r!="en",tooltip:r!="en"?"You can only add text in English.":"",onClick:()=>A("text")})}),n.jsx(O,{isdisable:r!=="en"?"true":"false",children:n.jsx(k,{label:"Add Image",disabled:r!="en",tooltip:r!="en"?"You can only add image in English.":"",onClick:()=>A("image")})}),n.jsx(O,{isdisable:r!=="en"?"true":"false",children:n.jsx(k,{label:"Add Collapsible",disabled:r!="en",tooltip:r!="en"?"You can only add collapsile in English.":"",onClick:()=>A("collapsible")})})]}),n.jsx(tt,{children:n.jsx(k,{label:_?"Hide Preview":"Show Preview",onClick:()=>re(!_)})})]}),q=(e,t)=>{C(!0),f(x.map(o=>o.id==e?{...o,value:t}:o))},V=(e,t)=>{C(!0),f(o=>o.map(s=>s.id===e?{...s,value:{...s.value,...t}}:s))},ve=(e,t)=>{var o;C(!0),(o=Object.values(t)[0])!=null&&o.value||C(!1),f(s=>s.map(l=>l.id==e?{...l,value:{...l.value,...t}}:l))},S=(e,t)=>{C(!0),f(o=>{const s=[...o];return t==="up"&&e>0&&([s[e],s[e-1]]=[s[e-1],s[e]]),t==="down"&&e<s.length-1&&([s[e],s[e+1]]=[s[e+1],s[e]]),s.map((l,a)=>({...l,blockIndex:a}))})},Be=()=>n.jsx(ot,{children:x.map((e,t)=>{switch(e.type){case"title":return n.jsx(Ge,{language:N(r),inputVal:e.value,blockIndex:t,onInputChange:o=>q(e.id,o),onDelete:()=>D(e.id),onMoveUp:()=>S(t,"up"),onMoveDown:()=>S(t,"down")},e.id);case"text":return n.jsx(We,{language:N(r),inputVal:e.value,blockIndex:t,onInputChange:o=>q(e.id,o),onDelete:()=>D(e.id),onMoveUp:()=>S(t,"up"),onMoveDown:()=>S(t,"down")},e.id);case"image":return n.jsx($e,{url:e.value.url,alt:e.value.alt,blockIndex:t,onImageInputChange:o=>V(e.id,{url:o}),onAltInputChange:o=>V(e.id,{alt:o}),onDelete:()=>D(e.id),onMoveUp:()=>S(t,"up"),onMoveDown:()=>S(t,"down")},e.id);case"collapsible":return n.jsx(Ue,{language:N(r),blockIndex:t,value:e.value,onChange:o=>ve(e.id,o),onDelete:()=>D(e.id),onMoveUp:()=>S(t,"up"),onMoveDown:()=>S(t,"down")},e.id);default:return null}})}),we=()=>x&&x.length>0&&_&&n.jsxs(nt,{children:[n.jsx(z,{color:"#155D74",fontSize:18,fontWeight:"bold",textAlign:"left",fontFamily:"Inter",children:"PREVIEW:"}),x.map((e,t)=>{var o;switch(e.type){case"title":return n.jsx(at,{children:n.jsx(z,{color:"black",fontWeight:"bold",textAlign:"left",fontFamily:"Inter",children:e.value})},t);case"text":return n.jsx(st,{children:n.jsx(z,{color:"black",fontSize:16,fontWeight:"400",fontFamily:"Inter",children:e.value})},t);case"image":return n.jsx(rt,{children:n.jsx(lt,{src:e.value.url,alt:e.value.alt})},t);case"collapsible":{const s=Object.values(e.value),l=(o=s[0])==null?void 0:o.value,a=[];for(let d=1;d<s.length;d++){const c=s[d];(c==null?void 0:c.type)=="title"?a.push({[r]:c==null?void 0:c.value,isTitle:!0}):(c==null?void 0:c.type)=="text"?a.push({[r]:c==null?void 0:c.value,isTitle:!1}):a.push(c==null?void 0:c.value)}return n.jsx(it,{children:n.jsx(He,{language:r,blockIndex:e.blockIndex,value:e.value,title:l,contents:a,onChange:()=>{},onDelete:()=>{},onMoveDown:()=>{},onMoveUp:()=>{}})},t)}}})]}),Ie=()=>n.jsxs(ct,{children:[Be(),we()]}),ye=()=>n.jsxs(qe,{children:[n.jsx(ze,{tools:dt}),ge(),me(),Ce(),Se(),Ie()]});return n.jsxs(n.Fragment,{children:[n.jsxs(Ke,{flexDirection:ie?"column":"row",children:[ue(),ye()]}),te&&n.jsx(Oe,{}),n.jsx(Pe,{})]})}function pt(i){return{dispatch:i}}function gt(i){return{currentUser:i.user.currentUser,bookInfos:i.book.bookInfos,chapterInfos:i.book.chapterInfos,currentBook:i.book.book,currentLanguage:i.book.language}}const yt=Te(gt,pt)(ut);export{yt as default};

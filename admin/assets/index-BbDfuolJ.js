import{B as Be,j as o,a as d}from"./createTheme-C7nUuxX_.js";import{C as ke,s as k,z as y,h as j,I as pe,D as Lt,a1 as It,_ as vt,E as Ft,X as P,H as U,J as H,a2 as Dt,a3 as Ut,a4 as Pt,a0 as Ht,W as Mt,a5 as Vt,a6 as $t,a7 as Wt,a8 as Kt,N as zt,A as qt,a9 as Gt}from"./App-B9rHvszB.js";import{u as ie,w as Qt,P as Yt,r as Xt,T as Jt,U as Zt,t as ea}from"./translator.services-CoiTywDD.js";import{j as ae,B as He,h as Me,A as ta,i as aa,k as xe,n as Se}from"./index-DV8uR7_z.js";import{b as oe,d as oa}from"./book.services-Bu9GId0-.js";import{a as L,b as le}from"./images-DzPc_l-t.js";import{S as Te}from"./index-HJ1AIixL.js";import{T as na,B as ra}from"./index-CpFKnreP.js";import{A as sa,S as ue}from"./index-BnRBUWMx.js";import"./TableContainer-xJ0zOI-W.js";var We={exports:{}};(function(t,h){(function(v,W){W()})(ae,function(){function v(n,b){return typeof b>"u"?b={autoBom:!1}:typeof b!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),b={autoBom:!b}),b.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob(["\uFEFF",n],{type:n.type}):n}function W(n,b,C){var f=new XMLHttpRequest;f.open("GET",n),f.responseType="blob",f.onload=function(){K(f.response,b,C)},f.onerror=function(){console.error("could not download file")},f.send()}function T(n){var b=new XMLHttpRequest;b.open("HEAD",n,!1);try{b.send()}catch{}return 200<=b.status&&299>=b.status}function B(n){try{n.dispatchEvent(new MouseEvent("click"))}catch{var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),n.dispatchEvent(b)}}var N=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof ae=="object"&&ae.global===ae?ae:void 0,x=N.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),K=N.saveAs||(typeof window!="object"||window!==N?function(){}:"download"in HTMLAnchorElement.prototype&&!x?function(n,b,C){var f=N.URL||N.webkitURL,S=document.createElement("a");b=b||n.name||"download",S.download=b,S.rel="noopener",typeof n=="string"?(S.href=n,S.origin===location.origin?B(S):T(S.href)?W(n,b,C):B(S,S.target="_blank")):(S.href=f.createObjectURL(n),setTimeout(function(){f.revokeObjectURL(S.href)},4e4),setTimeout(function(){B(S)},0))}:"msSaveOrOpenBlob"in navigator?function(n,b,C){if(b=b||n.name||"download",typeof n!="string")navigator.msSaveOrOpenBlob(v(n,C),b);else if(T(n))W(n,b,C);else{var f=document.createElement("a");f.href=n,f.target="_blank",setTimeout(function(){B(f)})}}:function(n,b,C,f){if(f=f||open("","_blank"),f&&(f.document.title=f.document.body.innerText="downloading..."),typeof n=="string")return W(n,b,C);var S=n.type==="application/octet-stream",ce=/constructor/i.test(N.HTMLElement)||N.safari,F=/CriOS\/[\d]+/.test(navigator.userAgent);if((F||S&&ce||x)&&typeof FileReader<"u"){var z=new FileReader;z.onloadend=function(){var D=z.result;D=F?D:D.replace(/^data:[^;]*;/,"data:attachment/file;"),f?f.location.href=D:location=D,f=null},z.readAsDataURL(n)}else{var q=N.URL||N.webkitURL,V=q.createObjectURL(n);f?f.location=V:location.href=V,f=null,setTimeout(function(){q.revokeObjectURL(V)},4e4)}});N.saveAs=K.saveAs=K,t.exports=K})})(We);var ia=We.exports,ye={},la=Be;Object.defineProperty(ye,"__esModule",{value:!0});var Ke=ye.default=void 0,ua=la(ke()),ca=o;Ke=ye.default=(0,ua.default)((0,ca.jsx)("path",{d:"M21 11H6.83l3.58-3.59L9 6l-6 6 6 6 1.41-1.41L6.83 13H21z"}),"KeyboardBackspace");var _e={},da=Be;Object.defineProperty(_e,"__esModule",{value:!0});var ze=_e.default=void 0,ha=da(ke()),ga=o;ze=_e.default=(0,ha.default)((0,ga.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");var Ee={},ma=Be;Object.defineProperty(Ee,"__esModule",{value:!0});var qe=Ee.default=void 0,ba=ma(ke()),fa=o;qe=Ee.default=(0,ba.default)((0,fa.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96M17 13l-5 5-5-5h3V9h4v4z"}),"CloudDownload");const Ca=k(y)({position:"relative",minHeight:"calc(100vh - 37px)",width:"100%","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),pa=k(y)({width:"100%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"}),xa=k(y)({margin:"20px 40px"}),Sa=k(y)({margin:"20px 40px",display:"flex",justifyContent:"center",boxSizing:"border-box"}),Ta=k(y)({margin:"20px 40px",display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{display:"block"}}),Ba=k(y)({display:"flex",alignItems:"center",cursor:"pointer",marginRight:"250px",transitionDuration:".25s","&:hover":{transform:"scale(1.1)"},"& .MuiSvgIcon-root":{width:"16px",marginRight:"10px",fill:"#155D74"},"@media screen and (max-width: 1050px)":{marginRight:"100px"},"@media screen and (max-width: 900px)":{marginRight:"30px"}}),ka=k(y)({display:"flex",justifyContent:"space-between",alignItems:"center","& >.MuiBox-root":{minWidth:"100px",marginRight:"20px"},"& > .MuiFormControl-root":{marginRight:"20px"},"@media screen and (max-width: 900px)":{"& >.MuiBox-root":{minWidth:"50px",marginRight:"10px"}},"@media screen and (max-width: 650px)":{display:"block","& > .MuiFormControl-root":{alignItems:"start","& .MuiInputBase-root":{width:"100%"}}}});k(y)({border:"1px solid #1B7695",backgroundColor:"#F0F5FB",boxSizing:"border-box",padding:"20px",margin:"20px 40px"});k(y)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"300px","& >.MuiBox-root>:nth-of-type(2)":{marginRight:"25px"}});const ya=k(y)({display:"flex",alignItems:"center",margin:"20px 40px"}),Ve=k(y)(({active:t})=>({display:"flex",alignItems:"center",justifyContent:"center",width:"120px",padding:"5px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:t=="true"?"#1B7695":"#F0F5FB",color:t=="true"?"#FFF":"#474747",cursor:"pointer","& .MuiSvgIcon-root":{fill:t=="true"?"#FFF":"#474747",marginRight:"10px"}})),_a=k(y)({display:"flex",justifyContent:"right",alignItems:"center",boxSizing:"border-box",margin:"20px 40px"}),Ea=k(y)({display:"flex",justifyContent:"center",alignItems:"center",marginLeft:"25px",padding:"0px 10px",boxSizing:"border-box",backgroundColor:"#FFAA5D",cursor:"pointer","&:hover":{backgroundColor:"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}}}),Oa=k(y)({width:"90%",height:"calc(100% - 73px)",margin:"auto",marginTop:"20px"}),$e=k(y)({border:"1px solid #1B7695",backgroundColor:"#F0F5FB",boxSizing:"border-box",padding:"20px",margin:"20px 40px","& .MuiAccordionDetails-root":{paddingLeft:"25px !important"},"& .MuiAccordionSummary-content > .MuiBox-root :nth-of-type(2)":{padding:"0px !important"}}),M=k(y)({height:"40px",display:"flex",alignItems:"center",width:"300px","& >.MuiBox-root:first-of-type":{minWidth:"150px",justifyContent:"left"},"& >.MuiBox-root > .MuiBox-root":{justifyContent:"left"},"& >.MuiBox-root >:first-of-type":{minWidth:"150px"},"& >.MuiBox-root >:nth-of-type(2)":{marginLeft:"10px"}});function ja(t){return t.isSpecialBook?o.jsx($e,{children:o.jsx(sa,{label:`Chapter name (${L(t.currentLanguage)}): `,summaryTitle:t.currentChapterTitle,onChange:h=>t.handleCurrentChapterTitleChange&&t.handleCurrentChapterTitleChange(h.target.value),onCurrentChapterTitleEnterPressed:()=>t.handleUpdateChapterSummary&&t.currentChapterTitle&&t.arabicChapterTitle&&t.transliteration&&t.englishChapterTitle&&t.handleUpdateChapterSummary(t.currentChapterTitle,t.arabicChapterTitle,t.transliteration,t.englishChapterTitle),detail:o.jsxs(o.Fragment,{children:[o.jsxs(M,{children:[o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Arabic:"}),t.currentUser.isAdmin?o.jsx(pe,{value:t.arabicChapterTitle,onChange:h=>t.handleArabicChapterTitleChange&&t.handleArabicChapterTitleChange(h.target.value),onKeyDown:h=>{h.key=="Enter"&&t.handleUpdateChapterSummary&&t.currentChapterTitle&&t.arabicChapterTitle&&t.transliteration&&t.englishChapterTitle&&t.handleUpdateChapterSummary(t.currentChapterTitle,t.arabicChapterTitle,t.transliteration,t.englishChapterTitle)}}):o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:t.arabicChapterTitle})]}),o.jsxs(M,{children:[o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Transliteration:"}),t.currentUser.isAdmin?o.jsx(pe,{value:t.transliteration,onChange:h=>t.handleTransliterationChapterTitleChange&&t.handleTransliterationChapterTitleChange(h.target.value),onKeyDown:h=>{h.key=="Enter"&&t.handleUpdateChapterSummary&&t.currentChapterTitle&&t.arabicChapterTitle&&t.transliteration&&t.englishChapterTitle&&t.handleUpdateChapterSummary(t.currentChapterTitle,t.arabicChapterTitle,t.transliteration,t.englishChapterTitle)}}):o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:t.transliteration})]}),o.jsxs(M,{children:[o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"English:"}),t.currentUser.isAdmin?o.jsx(pe,{value:t.englishChapterTitle,onChange:h=>t.handleEnglishChapterTitleChange&&t.handleEnglishChapterTitleChange(h.target.value),onKeyDown:h=>{h.key=="Enter"&&t.handleUpdateChapterSummary&&t.currentChapterTitle&&t.arabicChapterTitle&&t.transliteration&&t.englishChapterTitle&&t.handleUpdateChapterSummary(t.currentChapterTitle,t.arabicChapterTitle,t.transliteration,t.englishChapterTitle)}}):o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#969696",children:t.englishChapterTitle})]}),o.jsxs(M,{children:[o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Ayas filled:"}),o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#000",children:`${t.languageCountVerse} of ${t.totalCountVerse}`})]}),o.jsx(M,{children:o.jsx(ue,{label:"Complete: ",value:t.isComplete,disable:!(t.currentUser.isAdmin||t.currentUser.roles.some(h=>h.language==L(t.currentLanguage)&&(h.role.toLowerCase()=="translator".toLowerCase()||h.role.toLowerCase()=="publisher".toLowerCase()))),onChange:h=>t.translateComplete(h)})}),o.jsx(M,{children:o.jsx(ue,{label:"Publish: ",value:t.isPublish,disable:!(t.currentUser.isAdmin||t.currentUser.roles.some(h=>h.language==L(t.currentLanguage)&&h.role.toLowerCase()=="publisher".toLowerCase())),onChange:h=>t.translatePublish(h)})})]})})}):o.jsxs($e,{children:[o.jsxs(M,{children:[o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#155D74",children:"Ayas filled:"}),o.jsx(j,{fontFamily:"Inter",fontWeight:"500",fontSize:16,lineHeight:24,color:"#000",children:`${t.languageCountVerse} of ${t.totalCountVerse}`})]}),o.jsx(M,{children:o.jsx(ue,{label:"Complete: ",value:t.isComplete,disable:!(t.currentUser.isAdmin||t.currentUser.roles.some(h=>h.language==L(t.currentLanguage)&&(h.role.toLowerCase()=="translator".toLowerCase()||h.role.toLowerCase()=="publisher".toLowerCase()))),onChange:h=>t.translateComplete(h)})}),o.jsx(M,{children:o.jsx(ue,{label:"Publish: ",value:t.isPublish,disable:!(t.currentUser.isAdmin||t.currentUser.roles.some(h=>h.language==L(t.currentLanguage)&&h.role.toLowerCase()=="publisher".toLowerCase())),onChange:h=>t.translatePublish(h)})})]})}const wa=[{toolName:"Western",onClick:()=>{}},{toolName:"Arabic",onClick:()=>{}}];function Na(t){const h=It(),v=h.state,[W,T]=d.useState(!1),[B,N]=d.useState(null),[x,K]=d.useState(null),[n,b]=d.useState(v.chapterInfo),[C,f]=d.useState([]),[S,ce]=d.useState(null),[F,z]=d.useState(),[q,V]=d.useState([]),[D,ne]=d.useState([]),[de,G]=d.useState([]),[R,Oe]=d.useState([]),[je,we]=d.useState([]),[Ge,he]=d.useState(""),[re,Ne]=d.useState([]),[Q,ge]=d.useState([]),[_,Qe]=d.useState(t.currentBook),[E,Y]=d.useState(v.subBookInfo.subBookId),[w,se]=d.useState(v.chapterId),[g,Re]=d.useState(t.currentLanguage),[O,Ye]=d.useState(v.isImport),[Xe,Ae]=d.useState(!1),[Je,Le]=d.useState(!1),[Ze,et]=d.useState(0),[tt,Ie]=d.useState(0),[at,X]=d.useState(""),[ot,me]=d.useState(""),[nt,ve]=d.useState(""),[rt,be]=d.useState(""),fe=d.useMemo(()=>h.state.languages,[t.currentUser]),st=vt(),Ce=Ft(),it=d.useCallback(e=>{T(!0),oe.getBookInfoByTitle(e).then(a=>{var u,p,c;N(a),t.dispatch({type:P.ADD_BOOKINFO,payload:{bookInfo:a}});const s=Array.from(new Set(a.subBooks.map(i=>i.subBookId))).map(i=>a.subBooks.find(m=>m.subBookId===i)).map(i=>{var m;return{label:(m=i.subBookTitle)==null?void 0:m[g],value:i.subBookId}});Ne(s),Y(s.some(i=>i.value==E)?E:s.length?s[0].value:""),s.length>0&&!E&&Y(s[0].value);const l=(p=(u=a==null?void 0:a.subBooks[0])==null?void 0:u.chapterInfos)==null?void 0:p.map(i=>{var m;return{label:(m=i==null?void 0:i.chapterNumber)==null?void 0:m.toString(),value:i==null?void 0:i.chapterId}});ge(l),s.length>0&&!E&&Y(s[0].value),Q.length>0&&se((c=a==null?void 0:a.subBooks[0])==null?void 0:c.chapterInfos[0].chapterId),T(!1)}).catch(a=>{U.error(a instanceof Error?a.message:String(a),{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),T(!1)})},[_]),Fe=d.useCallback(e=>{T(!0),oe.getChapterInfoByChapterId(e).then(a=>{b(a),f(a.verses),t.dispatch({type:P.ADD_CHAPTERINFO,payload:{chapterInfo:a}}),T(!1)}).catch(a=>{U.error(a instanceof Error?a.message:String(a),{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),T(!1)})},[w]),J=d.useCallback(()=>{var l,u,p;const e=(l=B==null?void 0:B.subBooks)==null?void 0:l.find(c=>c.subBookId==E);let a=[],r=[];const s=((u=B==null?void 0:B.bookTitle)==null?void 0:u.en)=="Qur'an"||((p=B==null?void 0:B.bookTitle)==null?void 0:p.en)=="Zabur";if(g=="en")s?(a=["SubBook_English","SubBook_Transliteration","Chapter_Number","Verse_Number","Verse_English"],r=C==null?void 0:C.map(c=>{var i,m,A,I,$;return{SubBook_English:((i=e==null?void 0:e.subBookTitle)==null?void 0:i.en)||"",SubBook_Transliteration:((m=e==null?void 0:e.subBookTitle)==null?void 0:m.transliteration)||"",Chapter_Number:((A=n==null?void 0:n.chapterNumber)==null?void 0:A.toString())||"1",Verse_Number:((I=c==null?void 0:c.verseNumber)==null?void 0:I.toString())||"1",Verse_English:(($=c==null?void 0:c.verseText)==null?void 0:$.en)||""}})):(a=["SubBook_English","Chapter_Number","Verse_Number","Verse_English"],r=C==null?void 0:C.map(c=>{var i,m,A,I;return{SubBook_English:((i=e==null?void 0:e.subBookTitle)==null?void 0:i.en)||"",Chapter_Number:((m=n==null?void 0:n.chapterNumber)==null?void 0:m.toString())||"1",Verse_Number:((A=c==null?void 0:c.verseNumber)==null?void 0:A.toString())||"1",Verse_English:((I=c==null?void 0:c.verseText)==null?void 0:I.en)||""}}));else{const c=L(g);s?(a=["SubBook_English",`SubBook_${c}`,"SubBook_Transliteration","Chapter_Number","Verse_Number",`Verse_${c}`],r=C==null?void 0:C.map(i=>{var m,A,I,$,Z,ee,te,Pe;return{SubBook_English:((m=e==null?void 0:e.subBookTitle)==null?void 0:m.en)||"",[`SubBook_${c}`]:((A=e==null?void 0:e.subBookTitle)==null?void 0:A[g])||((I=e==null?void 0:e.subBookTitle)==null?void 0:I.en)||"",SubBook_Transliteration:s&&(($=e==null?void 0:e.subBookTitle)==null?void 0:$.transliteration)||"",Chapter_Number:((Z=n==null?void 0:n.chapterNumber)==null?void 0:Z.toString())||"1",Verse_Number:((ee=i==null?void 0:i.verseNumber)==null?void 0:ee.toString())||"1",[`Verse_${c}`]:((te=i==null?void 0:i.verseText)==null?void 0:te[g])||((Pe=i==null?void 0:i.verseText)==null?void 0:Pe.en)||""}})):(a=["SubBook_English",`SubBook_${c}`,"Chapter_Number","Verse_Number",`Verse_${c}`],r=C==null?void 0:C.map(i=>{var m,A,I,$,Z,ee,te;return{SubBook_English:((m=e==null?void 0:e.subBookTitle)==null?void 0:m.en)||"",[`SubBook_${c}`]:((A=e==null?void 0:e.subBookTitle)==null?void 0:A[g])||((I=e==null?void 0:e.subBookTitle)==null?void 0:I.en)||"",Chapter_Number:(($=n==null?void 0:n.chapterNumber)==null?void 0:$.toString())||"1",Verse_Number:((Z=i==null?void 0:i.verseNumber)==null?void 0:Z.toString())||"1",[`Verse_${c}`]:((ee=i==null?void 0:i.verseText)==null?void 0:ee[g])||((te=i==null?void 0:i.verseText)==null?void 0:te.en)||""}}))}V(a||[]),ne(r||[])},[B,n,C,E,g,O]),lt=d.useCallback(()=>{const e=`${_}-${le(E,re)}-${le(w,Q)}`,a=ie.json_to_sheet(D),r=ie.book_new();ie.book_append_sheet(r,a,"Sheet1");const s=Qt(r,{bookType:"xlsx",type:"array"}),l=new Blob([s],{type:"application/octet-stream"});ia.saveAs(l,`${e}.xlsx`),U.success(Dt,{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})},[D,q]);d.useEffect(()=>{(async()=>{var a;T(!0);try{const r=t.bookInfos.find(s=>s.bookTitle.en==_);if(r){N(r);const l=Array.from(new Set(r.subBooks.map(u=>u.subBookId))).map(u=>r.subBooks.find(p=>p.subBookId===u)).map(u=>{var p;return{label:(p=u.subBookTitle)==null?void 0:p[g],value:u.subBookId}});Ne(l),l.some(u=>u.value===E)||Y(((a=l[0])==null?void 0:a.value)||"")}else await it(_);if(w){const s=t.chapterInfos.find(l=>l.chapterId==w);s?(b(s),f(s.verses)):await Fe(w)}J()}catch(r){console.error("Error loading data:",r),U.error(r instanceof Error?r.message:String(r))}finally{T(!1)}})()},[_]),d.useEffect(()=>{var s,l,u,p,c;const e=t.bookInfos.find(i=>i.subBooks.find(m=>m.subBookId==E)),a=e==null?void 0:e.subBooks.find(i=>i.subBookId==E);a&&K(a),X(((s=a==null?void 0:a.subBookTitle)==null?void 0:s[g])||""),me(((l=a==null?void 0:a.subBookTitle)==null?void 0:l.ar)||""),be(((u=a==null?void 0:a.subBookTitle)==null?void 0:u.en)||""),ve(((p=a==null?void 0:a.subBookTitle)==null?void 0:p.transliteration)||"");const r=(c=a==null?void 0:a.chapterInfos)==null?void 0:c.map(i=>({value:i.chapterId,label:i.chapterNumber.toString()}));r&&v.chapterId?(ge(r),se(v.chapterId)):r&&(ge(r),se(r[0].value)),J()},[E]),d.useEffect(()=>{V([]),ne([]);const e=t.chapterInfos.find(a=>a.chapterId==w);e?(b(e),f(e.verses)):Fe(w),v.chapterId="",J()},[w]),d.useEffect(()=>{var r,s,l,u,p;J(),Ie(0);const e=((r=n==null?void 0:n.chapterIsCompleted)==null?void 0:r[g])||!1,a=((s=n==null?void 0:n.chapterIsPublished)==null?void 0:s[g])||!1;et(((l=n==null?void 0:n.verses)==null?void 0:l.length)||0),(u=n.verses)==null||u.map(c=>Ie(i=>{var m;return(m=c==null?void 0:c.verseText)!=null&&m[g]?i+1:i})),X(((p=x==null?void 0:x.subBookTitle)==null?void 0:p[g])||""),Ae(e),Le(a)},[C,B,x,n,g]),d.useEffect(()=>{O||J()},[O]),d.useEffect(()=>{const e=(F==null?void 0:F.target.files)&&(F==null?void 0:F.target.files[0]);e&&ce(e)},[F,O]),d.useEffect(()=>{var e;if(O){we([]);const a=R[0],r=(e=fe.find(s=>s.value==g))==null?void 0:e.label;r!="English"&&G(s=>[...s,"SubBook_English"]),a&&Object.keys(a).forEach(s=>{s=="SubBook_Transliteration"&&G(l=>[...l,s]),r&&s.includes(r)&&G(l=>[...l,s])}),G(s=>[...s,"Chapter_Number","Verse_Number"]),R.forEach(s=>{const l={};l.SubBook_English=s.SubBook_English,Object.keys(s).forEach(u=>{u.includes(r)&&(l[u]=s[u]),u=="SubBook_Transliteration"&&r=="English"&&(l[u]=s[u])}),l.Chapter_Number=s.Chapter_Number,l.Verse_Number=s.Verse_Number,we(u=>[...u,l])})}},[R,g,O]),d.useEffect(()=>{if(O){if(G([]),!S)return;const e=S.name,a=e.substr(e.lastIndexOf(".")+1).toLowerCase();a==="csv"?St(S):["xlsx","xls"].includes(a)?Tt(S):console.error("Unsupported file format")}},[S,g,O]),d.useEffect(()=>{if(O){const e=["SubBook_English",`SubBook_${L(g)}`,"Chapter_Number","Verse_Number",`Verse_${L(g)}`].filter((r,s,l)=>r&&l.indexOf(r)===s);let a="";if(R.length>1){const r=Object.keys(R[0]),s=e.filter(m=>!r.includes(m));s.forEach(m=>a+=`${m}, `),a&&(a=`You missed the ${s.length>=2?"fields":"field"}: `+a);const l=R[0][`SubBook_${L(g)}`];R.find(m=>m[`SubBook_${L(g)}`]!=l)&&(a=Vt);const p=R[0].SubBook_Transliteration;R.find(m=>m.SubBook_Transliteration!=p)&&(a=$t);const i=de.includes("SubBook_Transliteration");t.currentBook==He||t.currentBook==Me?(i||(a=Wt),R.some(A=>A.Chapter_Number!="1")&&(a=Kt),he(a)):(i&&(a=Ut),he(a))}R.length==0&&(a=Pt,he(a))}},[D,de,O,g,R,je]);const ut=e=>{Qe(e),Ce("/admin/bookoverview"),t.dispatch({type:P.SET_BOOK,payload:{bookTitle:e}})},ct=e=>{const a=e.target.value;Y(a)},dt=e=>{const a=e.target.value;se(a)},ht=e=>{const a=e.target.value;Re(a),V([]),ne([]),t.dispatch({type:P.SET_CURRENT_LANGUAGE,payload:{language:a}})},De=e=>{const a={chapterAudio:e.audio,chapterId:e._id,chapterNumber:e.chapterNumber,chapterTranslated:e.isTranslated,chapterIsCompleted:e.isCompleted,chapterIsPublished:e.isPublished,subBookId:e.subBook,verses:n.verses},r=t.bookInfos.map(s=>({...s,subBooks:s.subBooks.map(l=>({...l,chapterInfos:l.chapterInfos.map(u=>u.chapterId===w?{...u,...a}:u)}))}));t.dispatch({type:P.SET_BOOKINFOS,payload:{bookInfos:r}}),t.dispatch({type:P.UPDATE_CHAPTERINFOS,payload:{chapterInfo:a}})},gt=e=>{const a={chapterInfos:(x==null?void 0:x.chapterInfos)||[],subBookId:(x==null?void 0:x.subBookId)||"",subBookNumber:(x==null?void 0:x.subBookNumber)||1,subBookTitle:e.title,noChapter:!0},r=t.bookInfos.map(s=>({...s,subBooks:s.subBooks.map(l=>l.subBookId==E?{...l,...a}:l)}));t.dispatch({type:P.SET_BOOKINFOS,payload:{bookInfos:r}})},mt=async e=>{Ae(e),T(!0);const a={chapterNumber:n.chapterNumber||1,subBook:n.subBookId||"",audio:n.chapterAudio,isTranslated:n.chapterTranslated,isCompleted:{...n.chapterIsCompleted,[g]:e},isPublished:n.chapterIsPublished};oe.updateChapterInfo({chapterId:w,newChapterInfo:a}).then(r=>{De(r),T(!1)}).catch(r=>{U.error(r instanceof Error?r.message:String(r),{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),T(!1)})},bt=async e=>{Le(e);const a={chapterNumber:n.chapterNumber||1,subBook:n.subBookId||"",audio:n.chapterAudio,isTranslated:n.chapterTranslated,isCompleted:n.chapterIsCompleted,isPublished:{...n.chapterIsPublished,[g]:e}};oe.updateChapterInfo({chapterId:w,newChapterInfo:a}).then(r=>{De(r),T(!1)}).catch(r=>{U.error(r instanceof Error?r.message:String(r),{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),T(!1)})},ft=e=>{g=="en"?be(e):g=="ar"&&me(e),X(e)},Ct=e=>{g=="ar"&&X(e),me(e)},pt=e=>{g=="en"&&X(e),be(e)},xt=(e,a,r,s)=>{const l={[`${g}`]:e,ar:a,transliteration:r,en:s},u={...x,subBookTitle:l},p={title:u.subBookTitle,number:u.subBookNumber||1,book:(B==null?void 0:B.bookId)||"",noChapter:!0};x!=null&&x.subBookId?(T(!0),oe.updateSubBookInfo({subBookId:x==null?void 0:x.subBookId,newSubBookInfo:p}).then(c=>{gt(c),T(!1)}).catch(c=>{U.error(c instanceof Error?c.message:String(c),{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),T(!1)})):U.error(Gt,{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})},Ue=e=>{Ye(e),V([]),ne([])},St=e=>{try{const a=new FileReader;a.onload=r=>{var l;const s=(l=r.target)==null?void 0:l.result;if(!s){console.error("Failed to read file");return}Yt.parse(s,{complete:u=>{if(u.errors.length>0){console.error("CSV parsing errors:",u.errors);return}const p=u.data;Oe(p)},header:!0,skipEmptyLines:!0,transformHeader:u=>u.trim(),transform:u=>u.trim()})},a.onerror=r=>{console.error("Error reading file:",r)},a.readAsText(e)}catch(a){console.error("Error parsing CSV file:",a)}},Tt=d.useCallback(async e=>{try{const a=new FileReader;a.onload=r=>{var i;const s=(i=r.target)==null?void 0:i.result;if(!s){console.error("Failed to read file");return}const l=Xt(s,{type:"array"}),u=l.SheetNames[0],p=l.Sheets[u],c=ie.sheet_to_json(p);Oe(c)},a.onerror=r=>{console.error("Error reading file:",r)},a.readAsArrayBuffer(e)}catch(a){console.error("Error parsing Excel file:",a)}},[S]),Bt=()=>{ea.saveBook({bookInfos:je,bookTitle:t.currentBook,language:L(g)}).then(()=>{U.success("Saved successfully!",{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})}).catch(e=>{U.success(e,{position:"top-right",draggable:!0,theme:"colored",transition:H,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3})})},kt=()=>{localStorage.removeItem(ta),t.dispatch({type:P.RESET_USER}),t.dispatch({type:P.RESET_BOOK}),Ce("/admin")},yt=()=>o.jsx(zt,{isLoggedIn:!0,username:t.currentUser.username,isAdmin:t.currentUser.isAdmin,onLogOut:kt}),_t=()=>o.jsx(xa,{children:o.jsx(ra,{books:aa.map(e=>({bookTitle:e.bookTitle,onClick:()=>{ut(e.value)}})),selectedBook:_})}),Et=()=>o.jsxs(Ta,{children:[o.jsxs(Ba,{onClick:()=>Ce("/admin/bookoverview"),children:[o.jsx(Ke,{}),o.jsx(j,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:"overview"})]}),o.jsxs(ka,{children:[o.jsx(j,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:_==xe||_==Se?"Go to: ":"Go to Surah: "}),o.jsx(Te,{label:"",options:re,value:re.find(e=>e.value===E)?E:"",backgroundColor:"#fff",textColor:"#155D74",onChange:ct}),(_==xe||_==Se)&&o.jsx(Te,{label:"",options:Q,value:Q.find(e=>e.value===w)?w:"",backgroundColor:"#fff",textColor:"#155D74",onChange:dt}),o.jsx(Te,{label:"",options:fe,value:g,backgroundColor:"#fff",textColor:"#155D74",onChange:ht})]})]}),Ot=()=>o.jsx(ja,{currentUser:t.currentUser,currentBook:t.currentBook,totalCountVerse:Ze,languageCountVerse:tt,isComplete:Xe,isPublish:Je,isSpecialBook:_==He||_==Me,currentLanguage:g,arabicChapterTitle:ot,englishChapterTitle:rt,transliteration:nt,currentChapterTitle:at,translateComplete:e=>mt(e),translatePublish:e=>bt(e),handleCurrentChapterTitleChange:e=>ft(e),handleArabicChapterTitleChange:e=>Ct(e),handleTransliterationChapterTitleChange:e=>ve(e),handleEnglishChapterTitleChange:e=>pt(e),handleUpdateChapterSummary:xt}),jt=()=>o.jsxs(ya,{children:[o.jsxs(Ve,{active:O?"false":"true",onClick:()=>Ue(!1),children:[o.jsx(qe,{}),o.jsx(j,{fontFamily:"'Baloo Da 2'",children:"Database"})]}),o.jsxs(Ve,{active:O?"true":"false",onClick:()=>Ue(!0),children:[o.jsx(oa,{}),o.jsx(j,{fontFamily:"'Baloo Da 2'",children:"Import"})]})]}),wt=()=>!O&&o.jsxs(_a,{children:[o.jsx(j,{fontFamily:"Inter",color:"#155D74",fontWeight:"500",children:`${_} - 
            ${le(E,re)} 
            ${_==xe||_==Se?le(w,Q):""}`}),o.jsx(Ea,{children:o.jsx(qt,{label:"Export to Excel",icon:o.jsx(ze,{}),onClick:lt})})]}),Nt=()=>!O&&o.jsx(Sa,{children:o.jsx(Jt,{headers:q,rows:D})}),Rt=()=>O&&o.jsx(Oa,{children:o.jsx(Zt,{language:g,languageLabel:L(g),languages:fe,file:S,parsedData:R,headers:de,error:Ge,onChangeLanguage:e=>Re(e.target.value),onChangeFile:e=>z(e),onUpload:Bt})}),At=()=>o.jsxs(pa,{children:[o.jsx(na,{tools:wa}),_t(),Et(),Ot(),jt(),wt(),Nt(),Rt()]});return o.jsxs(o.Fragment,{children:[o.jsxs(Ca,{flexDirection:st?"column":"row",children:[yt(),At()]}),o.jsx(Ht,{}),W&&o.jsx(Mt,{})]})}function Ra(t){return{dispatch:t}}function Aa(t){return{currentUser:t.user.currentUser,bookInfos:t.book.bookInfos,chapterInfos:t.book.chapterInfos,currentBook:t.book.book,currentLanguage:t.book.language}}const $a=Lt(Aa,Ra)(Na);export{$a as default};

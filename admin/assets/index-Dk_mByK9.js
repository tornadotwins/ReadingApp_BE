import{a as g,j as a}from"./createTheme-C_Nmnn35.js";import{s as d,B as p,t as Ie,W as ye,K as je,u as Te,A as F,H as R,E as Ee,Q as Ae,w as De,F as E,q as y,T as L}from"./App-DaaHOIBI.js";import{S as Q}from"./index-Bgjcn6g-.js";import{a as z}from"./images-B-3euPqr.js";import{b as Pe,o as Oe,k as Me,v as _e}from"./index-CaI9eg9J.js";import{S as X}from"./index-CFdtRtyq.js";import{T as Fe,B as Re}from"./index-C21iL05o.js";import{C as Le,I as ze,T as Ne,a as Ue,P as $e}from"./PreviewCollapsibleBlock-DEr_WnAJ.js";import{b as Z}from"./book.services-BuwRYMQE.js";import"./ArrowDownward-DCJs6-qH.js";import"./index-7HhkekAX.js";const We=d(p)({position:"relative",minHeight:"calc(100vh - 37px)",width:"100%","& >.MuiBox-root:first-of-type":{backgroundColor:"#1B7695","& >.MuiBox-root":{color:"#F6FCFC"}}}),Ge=d(p)({width:"100%",height:"calc(100% - 73px)",margin:"auto",marginTop:"73px"}),He=d(p)({margin:"20px 40px"}),Ke=d(p)({margin:"20px 40px",display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{display:"block"}}),qe=d(p)({display:"flex",justifyContent:"space-between",alignItems:"center","& > .MuiFormControl-root":{marginRight:"20px"},"@media screen and (max-width: 650px)":{display:"block","& > .MuiFormControl-root":{alignItems:"start","& .MuiInputBase-root":{width:"100%"}}}}),Ve=d(p)({margin:"20px 40px",display:"flex",alignItems:"center","& > .MuiBox-root":{width:"120px",marginRight:"50px"},"@media screen and (max-width: 800px)":{display:"block"}}),Ye=d(p)(({isdisable:r})=>({display:"flex",justifyContent:"center",alignItems:"center",width:"160px !important",marginRight:"0px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:r=="true"?"#A1A1A1":"#FFAA5D",cursor:r=="true"?"not-allowed":"pointer",button:{width:"100%"},"&:hover":{backgroundColor:r=="true"?"#A1A1A1":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",fontWeight:"600 !important",textTransform:"none","&:hover":{backgroundColor:r=="true"?"#A1A1A1":"#EE994C"}}})),Je=d(p)({width:"100%",padding:"20px 40px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between","@media screen and (max-width: 800px)":{flexDirection:"column"}}),Qe=d(p)({display:"flex",alignItems:"center","@media screen and (max-width: 800px)":{flexDirection:"column",width:"100%"}}),P=d(p)(({isdisable:r})=>({display:"flex",justifyContent:"center",alignItems:"center",marginRight:"20px !important",padding:"5px 10px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:r==="true"?"#c0c0c0":"#FFAA5D",cursor:r==="true"?"not-allowed":"pointer",button:{width:"100%"},"&:hover":{backgroundColor:r==="true"?"#c0c0c0":"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}},"@media screen and (max-width: 800px)":{width:"100%",marginRight:"0px !important",marginBottom:"10px"}})),Xe=d(p)({display:"flex",justifyContent:"center",alignItems:"center",padding:"5px 10px",width:"150px",boxSizing:"border-box",border:"1px solid #474747",backgroundColor:"#FFAA5D",cursor:"pointer",button:{width:"100%"},"&:hover":{backgroundColor:"#EE994C"},"& .MuiBox-root":{color:"#474747 !important",textTransform:"none","&:hover":{backgroundColor:"#EE994C"}},"@media screen and (max-width: 800px)":{width:"100%"}}),Ze=d(p)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",boxSizing:"border-box",width:"100%"}),et=d(p)({display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",border:"1px solid #155D74",borderRadius:"4px",backgroundColor:"#F0F5FB",padding:"10px",width:"300px",marginBottom:"10px","& .MuiBox-root":{width:"100%",wordWrap:"break-work",wordBreak:"break-word"},"& > .MuiBox-root: first-of-type":{marginBottom:"20px"},"@media screen and (max-width: 700px)":{width:"100%"}}),tt=d(p)({display:"flex",alignItems:"center",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),ot=d(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),nt=d(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px"}),at=d("img")({width:"250px"}),st=d(p)({display:"flex",alignSelf:"start",boxSizing:"border-box",padding:"0px 10px",marginBottom:"10px",width:"100%"}),lt=d(p)({display:"flex",margin:"20px 40px",boxSizing:"border-box",justifyContent:"space-between",gap:"20px","@media screen and (max-width: 700px)":{flexDirection:"column"}}),rt=[{toolName:"Western",onClick:()=>{}},{toolName:"Arabic",onClick:()=>{}}];function it(r){var V,Y,J;const S=ye(),[ee,B]=g.useState(!1),[O,te]=g.useState(r.currentBook),[j,N]=g.useState((V=S.state.subBookInfo)==null?void 0:V.subBookId),[m,oe]=g.useState(S.state.chapterId),[l,ne]=g.useState(r.currentLanguage),[U,ae]=g.useState([]),[k,$]=g.useState(((Y=S.state.subBookInfo.chapterInfos[0].chapterIsCompleted)==null?void 0:Y[l])||!1),[T,M]=g.useState(((J=S.state.subBookInfo.chapterInfos[0].chapterIsPublished)==null?void 0:J[l])||!1),[_,se]=g.useState(!0),[h,b]=g.useState([]),[W,f]=g.useState(!1),le=je(),G=Te(),re=g.useMemo(()=>S.state.languages,[S]);g.useEffect(()=>{var s,i;const e=r.bookInfos.find(o=>o.bookTitle.en==r.currentBook),t=(s=e==null?void 0:e.subBooks)==null?void 0:s.find(o=>o.subBookId==j),n=(t==null?void 0:t.chapterInfos)&&(t==null?void 0:t.chapterInfos[0].chapterNumber)==0&&((i=t==null?void 0:t.chapterInfos[0])==null?void 0:i.chapterId)||"";oe(n)},[j]),g.useEffect(()=>{B(!0),b([]),Z.getIntroVerses(m).then(e=>{var n,s,i;$(((n=e.isCompleted)==null?void 0:n[l])||!1),M(((s=e.isPublished)==null?void 0:s[l])||!1);const t=[];e.verses&&e.verses.length>0&&((i=e.verses)==null||i.map(o=>{var c,v;const u=o.number;if(!o.isCollapse&&o.title){const x={id:o.id||`title-${Date.now()}-${Math.random()}`,type:"title",blockIndex:u,value:(c=o.title)==null?void 0:c[l]};t.push(x)}else if(!o.isCollapse&&o.text){const x={id:o.id||`text-${Date.now()}-${Math.random()}`,type:"text",blockIndex:u,value:(v=o.text)==null?void 0:v[l]};t.push(x)}else if(!o.isCollapse&&o.image){const x={id:o.id||`image-${Date.now()}-${Math.random()}`,type:"image",blockIndex:u,value:o.image};t.push(x)}else if(o.isCollapse){const x={id:o.id||`collapsible-${Date.now()}-${Math.random()}`,type:"collapsible",blockIndex:u,value:o};t.push(x)}})),b(t),B(!1)}).catch(e=>{console.log(`warning/error while getting intro information: 
`,e),F.warning("No introduction information for the chapter.",{position:"top-right",draggable:!0,theme:"colored",transition:R,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)})},[m,l]);const ie=()=>{localStorage.removeItem(Pe),r.dispatch({type:E.RESET_USER}),r.dispatch({type:E.RESET_BOOK}),r.dispatch({type:E.RESET_APP_TEXT_PAGES}),G("/admin")},ce=()=>a.jsx(De,{isLoggedIn:!0,username:r.currentUser.username,isAdmin:r.currentUser.isAdmin,isTranslationPage:!0,onLogOut:ie}),ue=e=>{te(e),G("/admin/bookoverview"),r.dispatch({type:E.SET_BOOK,payload:{bookTitle:e}})},de=()=>a.jsx(He,{children:a.jsx(Re,{books:Oe.map(e=>({bookTitle:e.bookTitle,onClick:()=>{ue(e.value)}})),selectedBook:O})});g.useEffect(()=>{var t;const e=r.bookInfos.find(n=>n.bookTitle.en==r.currentBook);if(e){const s=Array.from(new Set(e.subBooks.map(i=>i.subBookId))).map(i=>e.subBooks.find(o=>o.subBookId===i)).map(i=>{var o,u,c;return{label:((o=i.subBookTitle)==null?void 0:o[l])||((u=i.subBookTitle)==null?void 0:u.en)||((c=i.subBookTitle)==null?void 0:c.ar)||"No Sub book title",value:i.subBookId}});ae(s),N(((t=S.state.subBookInfo)==null?void 0:t.subBookId)||s[0].value)}},[r.currentBook]);const pe=e=>{const t=e.target.value;N(t)},ge=e=>{const t=e.target.value;ne(t)},he=()=>a.jsx(Ke,{children:a.jsxs(qe,{children:[(O==Me||O==_e)&&a.jsx(X,{label:"",options:U,value:U.find(e=>e.value===j)?j:"",backgroundColor:"#fff",textColor:"#155D74",onChange:pe}),a.jsx(X,{label:"",options:re,value:l,backgroundColor:"#fff",textColor:"#155D74",onChange:ge})]})}),H=(e,t)=>{$(e),e&&M(t),!e&&M(!1),f(!0)},xe=e=>{const t={chapterAudio:e.audio,chapterId:e._id,chapterNumber:e.chapterNumber,chapterTranslated:e.isTranslated,chapterIsCompleted:e.isCompleted,chapterIsPublished:e.isPublished,subBookId:e.subBook},n=r.bookInfos.map(s=>({...s,subBooks:s.subBooks.map(i=>({...i,chapterInfos:i.chapterInfos.map(o=>o.chapterId===m?{...o,...t}:o)}))}));r.dispatch({type:E.SET_BOOKINFOS,payload:{bookInfos:n}})},me=g.useCallback(()=>{B(!0);const e=[];h.map((n,s)=>{var i;switch(n.type){case"title":{const o=n.value,u={chapter:m,title:{[l]:o},text:{},image:{},number:s+1,isCollapse:!1,content:[]};e.push(u);break}case"text":{const o=n.value,u={chapter:m,title:{},text:{[l]:o},image:{},number:s+1,isCollapse:!1,content:[]};e.push(u);break}case"image":{const o=n.value,u=o.url,c=o.alt,v={chapter:m,title:{},text:{},image:{url:u,alt:c},number:s+1,isCollapse:!1,content:[]};e.push(v);break}case"collapsible":{let o={chapter:m,title:{},text:{},image:{},number:s+1,isCollapse:!0,content:[]};const u=[],c=n.value,v=(i=c[0])==null?void 0:i.value;o={...o,title:{[l]:v}};for(const x of Object.keys(c).slice(1)){const w=c[x];if(w.type=="title"){const I={[l]:w.value,isTitle:!0};u.push(I)}else if(w.type=="text"){const I={[l]:w.value,isTitle:!1};u.push(I)}else if(w.type=="image"){const I=w.value,we={url:I.url,alt:I.alt};u.push(we)}}o={...o,content:u},e.push(o);break}}});const t={languageCode:l,subBookId:j,chapterId:m,isCompleted:{[l]:k},isPublished:{[l]:T},verses:e};Z.updateIntroData(t).then(n=>{xe(n),F.success("Successfully updated.",{position:"top-right",draggable:!0,theme:"colored",transition:R,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)}).catch(n=>{F.error(n.message,{position:"top-right",draggable:!0,theme:"colored",transition:R,closeOnClick:!0,pauseOnHover:!0,hideProgressBar:!1,autoClose:3e3}),B(!1)})},[h,k,T]),be=()=>a.jsxs(Ve,{children:[a.jsx(Q,{label:"Complete",value:k,disable:h.length==0,onChange:()=>H(!k,T)}),a.jsx(Q,{label:"Publish",value:T,disable:!k,onChange:()=>H(k,!T)}),a.jsx(Ye,{isdisable:W?"false":"true",children:a.jsx(y,{label:"Save Changes",disabled:!W,onClick:me})})]}),A=e=>{const n={id:`${e}-${Date.now()}`,blockIndex:h.length,type:e,value:e=="image"?{url:"",alt:""}:""};f(!0),b([...h,n])},D=e=>{const t=h.filter(n=>n.id!==e);f(!0),b(t)},fe=()=>a.jsxs(Je,{children:[a.jsxs(Qe,{children:[a.jsx(P,{isdisable:l!=="en"?"true":"false",children:a.jsx(y,{label:"Add Title",disabled:l!="en",tooltip:l!="en"?"You can only add title in English.":"",onClick:()=>A("title")})}),a.jsx(P,{isdisable:l!=="en"?"true":"false",children:a.jsx(y,{label:"Add Text",disabled:l!="en",tooltip:l!="en"?"You can only add text in English.":"",onClick:()=>A("text")})}),a.jsx(P,{isdisable:l!=="en"?"true":"false",children:a.jsx(y,{label:"Add Image",disabled:l!="en",tooltip:l!="en"?"You can only add image in English.":"",onClick:()=>A("image")})}),a.jsx(P,{isdisable:l!=="en"?"true":"false",children:a.jsx(y,{label:"Add Collapsible",disabled:l!="en",tooltip:l!="en"?"You can only add collapsile in English.":"",onClick:()=>A("collapsible")})})]}),a.jsx(Xe,{children:a.jsx(y,{label:_?"Hide Preview":"Show Preview",onClick:()=>se(!_)})})]}),K=(e,t)=>{f(!0),b(h.map(n=>n.id==e?{...n,value:t}:n))},q=(e,t)=>{f(!0),b(n=>n.map(s=>s.id===e?{...s,value:{...s.value,...t}}:s))},Ce=(e,t)=>{var n;f(!0),(n=Object.values(t)[0])!=null&&n.value||f(!1),b(s=>s.map(i=>i.id==e?{...i,value:{...i.value,...t}}:i))},C=(e,t)=>{f(!0),b(n=>{const s=[...n];return t==="up"&&e>0&&([s[e],s[e-1]]=[s[e-1],s[e]]),t==="down"&&e<s.length-1&&([s[e],s[e+1]]=[s[e+1],s[e]]),s.map((i,o)=>({...i,blockIndex:o}))})},Se=()=>a.jsx(Ze,{children:h.map((e,t)=>{switch(e.type){case"title":return a.jsx(Ue,{language:z(l),inputVal:e.value,blockIndex:t,onInputChange:n=>K(e.id,n),onDelete:()=>D(e.id),onMoveUp:()=>C(t,"up"),onMoveDown:()=>C(t,"down")},e.id);case"text":return a.jsx(Ne,{language:z(l),inputVal:e.value,blockIndex:t,onInputChange:n=>K(e.id,n),onDelete:()=>D(e.id),onMoveUp:()=>C(t,"up"),onMoveDown:()=>C(t,"down")},e.id);case"image":return a.jsx(ze,{url:e.value.url,alt:e.value.alt,blockIndex:t,onImageInputChange:n=>q(e.id,{url:n}),onAltInputChange:n=>q(e.id,{alt:n}),onDelete:()=>D(e.id),onMoveUp:()=>C(t,"up"),onMoveDown:()=>C(t,"down")},e.id);case"collapsible":return a.jsx(Le,{language:z(l),blockIndex:t,value:e.value,onChange:n=>Ce(e.id,n),onDelete:()=>D(e.id),onMoveUp:()=>C(t,"up"),onMoveDown:()=>C(t,"down")},e.id);default:return null}})}),Be=()=>h&&h.length>0&&_&&a.jsxs(et,{children:[a.jsx(L,{color:"#155D74",fontSize:18,fontWeight:"bold",textAlign:"left",fontFamily:"Inter",children:"PREVIEW:"}),h.map((e,t)=>{var n;switch(e.type){case"title":return a.jsx(tt,{children:a.jsx(L,{color:"black",fontWeight:"bold",textAlign:"left",fontFamily:"Inter",children:e.value})},t);case"text":return a.jsx(ot,{children:a.jsx(L,{color:"black",fontSize:16,fontWeight:"400",fontFamily:"Inter",children:e.value})},t);case"image":return a.jsx(nt,{children:a.jsx(at,{src:e.value.url,alt:e.value.alt})},t);case"collapsible":{const s=Object.values(e.value),i=(n=s[0])==null?void 0:n.value,o=[];for(let u=1;u<s.length;u++){const c=s[u];(c==null?void 0:c.type)=="title"?o.push({[l]:c==null?void 0:c.value,isTitle:!0}):(c==null?void 0:c.type)=="text"?o.push({[l]:c==null?void 0:c.value,isTitle:!1}):o.push(c==null?void 0:c.value)}return a.jsx(st,{children:a.jsx($e,{language:l,blockIndex:e.blockIndex,value:e.value,title:i,contents:o,onChange:()=>{},onDelete:()=>{},onMoveDown:()=>{},onMoveUp:()=>{}})},t)}}})]}),ke=()=>a.jsxs(lt,{children:[Se(),Be()]}),ve=()=>a.jsxs(Ge,{children:[a.jsx(Fe,{tools:rt}),de(),he(),be(),fe(),ke()]});return a.jsxs(a.Fragment,{children:[a.jsxs(We,{flexDirection:le?"column":"row",children:[ce(),ve()]}),ee&&a.jsx(Ee,{}),a.jsx(Ae,{})]})}function ct(r){return{dispatch:r}}function ut(r){return{currentUser:r.user.currentUser,bookInfos:r.book.bookInfos,chapterInfos:r.book.chapterInfos,currentBook:r.book.book,currentLanguage:r.book.language}}const kt=Ie(ut,ct)(it);export{kt as default};

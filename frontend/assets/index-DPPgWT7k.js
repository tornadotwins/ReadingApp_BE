var ne=Object.defineProperty;var oe=(e,s,i)=>s in e?ne(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i;var P=(e,s,i)=>oe(e,typeof s!="symbol"?s+"":s,i);import{b as c,j as n,a3 as m,ap as J,ay as O}from"./index-BlVR3GtE.js";import{s as r,B as u,S as T,g as p,c as ie,u as se,k as f,d as h}from"./App-BXdxJk5y.js";import{I as y,T as N}from"./index-BXFYU2Yo.js";import{L as ae}from"./index-BNfifEIC.js";import{C}from"./index-l8TiX9lb.js";import{H as le}from"./index-Cj9X7EEK.js";import{d as re}from"./ArrowBack-DFfRKsio.js";import{a as de}from"./auth.service-BbDv6u2-.js";import{a as M}from"./axios-upsvKRUO.js";import{i as b}from"./indexedDB.service-BsO_T_w7.js";import"./index-D78ZPMqG.js";const ce=r(u)({display:"flex",position:"relative",width:"100%"}),ue=r("img")({width:"100%",marginTop:"57px"}),he=r(u)({display:"flex",alignItems:"baseline",justifyContent:"space-between",position:"absolute",left:"30px",top:"30px",width:"calc(100% - 60px)"}),ye=r(u)({display:"flex",flexDirection:"column"}),ge=r(u)({width:"40px",cursor:"pointer",position:"relative","& div":{position:"absolute",top:"28px",width:"100%",textAlign:"center",maxWidth:"65px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}}),xe=r("img")({width:"100%",height:"100%"}),me=r(u)({margin:0,position:"relative",top:"-20px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}),fe=r(u)(({hamburgercolor:e})=>({position:"absolute",top:"12px",right:"15px",width:"46px","& .hamburger-react":{width:"46px !important",color:e},"& .hamburger-react ~ .MuiBox-root ":{border:`1px solid ${e}`},"@media (max-height: 639px)":{top:"8px",right:"10px"},"@media screen and (orientation: landscape)":{right:"15px"}})),Ce=r("img")({position:"relative",top:"10px",cursor:"pointer","&:active":{opacity:"0.8"}}),Ie=r(u)({position:"absolute",top:"60px",left:"50%",transform:"translate(-50%, -50%)",cursor:"pointer"}),we=r("img")({width:"100%","&:active":{opacity:"0.8"}});r("img")({position:"absolute",top:"18px",right:"30px",cursor:"pointer","&:active":{opacity:"0.8"}});const Se=r(u)({height:"calc(100dvh - 145px)",width:"100%",position:"absolute",top:"145px",padding:"0px 30px","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),be=r(u)({backgroundColor:"#FFF",height:"calc(100dvh - 145px)",position:"relative",zIndex:"1",display:"flex",flexDirection:"column",padding:"20px",overflowY:"scroll","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),je=r(u)(({showbtn:e})=>({width:"100%",display:e==="true"?"none":"flex",alignItems:"center",marginBottom:"10px",svg:{fill:"#1B7695"}})),_e=r(u)({padding:0,boxSizing:"border-box",display:"flex",flexDirection:"column"}),Ae=r(u)(({isdisable:e})=>({backgroundColor:"#F0F5FB",padding:"9px 11px",marginBottom:"10px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between",cursor:e==="false"?"pointer":"not-allowed",opacity:e==="true"?"0.5":"1"})),ve=r(u)({width:"calc(100% - 65px)",display:"flex",flexDirection:"column",alignItems:"center",marginRight:"20px"}),Ee=r(u)({width:"100%",display:"flex",alignItems:"center"}),ke=r(u)({width:"15px",height:"15px",marginRight:"10px"}),De=r("img")({width:"100%",height:"100%"}),Je=r(u)({width:"100%","& .MuiBox-root":{width:"100%",display:"-webkit-box",justifyContent:"center",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:"2",WebkitBoxOrient:"vertical"}}),H=r(u)(({isdownloaded:e})=>({width:"45px",display:"flex",alignItems:"center",justifyContent:e=="true"?"space-between":"flex-end",cursor:"pointer"})),L=r("img")({width:"16px",height:"16px"});function Te(e){const{theme:s}=c.useContext(T),{logoTextColor:i,headerBGColor:x}=p(s);return n.jsxs(ce,{children:[n.jsx(ue,{src:s==m.DEFAULT||s==m.DARK?y.book_subtract:s==m.BLACK_AND_WHITE?y.book_subtract_BAW:s==m.SAPPHIRE?y.book_subtract_sapphire:y.book_subtract_easyocean}),n.jsxs(he,{children:[n.jsxs(ye,{children:[n.jsx(ge,{onClick:e.onLogoClick,children:n.jsx(xe,{src:e.markImg})}),n.jsx(me,{children:n.jsx(N,{fontFamily:"Buenard",fontWeight:"700",fontSize:36,lineHeight:47,textAlign:"center",color:i,children:e.markTitle})})]}),n.jsx(Ce,{src:s==m.EASY_OCEAN?y.search_easyocean:y.search,onClick:e.onSearchClick})]}),n.jsx(Ie,{children:n.jsx(we,{src:s==m.DEFAULT||s==m.DARK?y.close2:s==m.BLACK_AND_WHITE?y.close2_BAW:s==m.SAPPHIRE?y.close2_sapphire:y.close2_easyocean,onClick:e.onCloseClick})}),n.jsx(fe,{hamburgercolor:x,children:n.jsx(le,{isLogin:e.isLoggedIn,textColor:i,itemBgColor:x,toggleColor:x,terms:e.welcomePageTerms,onLogin:e.onLogin,onSettings:e.onSettings})})]})}function Be(e){const{theme:s}=c.useContext(T);return n.jsxs(Ae,{isdisable:e.isPublished||!e.isArticle?"false":"true",children:[n.jsxs(ve,{onClick:e.isPublished||!e.isArticle?()=>e.onCardClick(e.cardId):()=>{},children:[n.jsxs(Ee,{children:[n.jsx(ke,{children:n.jsx(De,{src:J+e.image})}),n.jsx(N,{fontFamily:"Inter",fontWeight:"400",fontSize:12,lineHeight:24,color:"#899093",children:e.seriesTitle})]}),n.jsx(Je,{children:n.jsx(N,{fontFamily:"Inter",fontWeight:"700",fontSize:16,lineHeight:24,color:"#000",children:e.title})})]}),n.jsxs(n.Fragment,{children:[!e.isDownloaded&&n.jsx(H,{isdownloaded:e.isDownloaded?"true":"false",children:n.jsx(L,{src:s==m.DEFAULT||s==m.EASY_OCEAN?y.download:y.download_white,onClick:e.isPublished||!e.isArticle?()=>e.onDownload(e.cardId):()=>{}})}),e.isDownloaded&&n.jsxs(H,{isdownloaded:e.isDownloaded?"true":"false",children:[n.jsx(L,{src:s==m.DEFAULT||s==m.EASY_OCEAN?y.download_refresh:y.download_refresh_white,onClick:()=>e.onRefresh(e.cardId)}),n.jsx(L,{src:s==m.DEFAULT||s==m.EASY_OCEAN?y.download_cancel:y.download_cancel_white,onClick:()=>e.onCancel(e.cardId)})]})]})]})}function Re(e){var s;return n.jsx(_e,{children:(s=e.cards)==null?void 0:s.map((i,x)=>{var S,g,E,j,w;return n.jsx(Be,{cardId:i==null?void 0:i._id,isArticle:i==null?void 0:i.isArticle,image:(S=i==null?void 0:i.image)==null?void 0:S.url,seriesTitle:(g=i==null?void 0:i.seriesTitle)==null?void 0:g.en,title:(E=i==null?void 0:i.title)==null?void 0:E.en,isPublished:(j=i==null?void 0:i.isPublished)==null?void 0:j[e.language],isDownloaded:(w=e.downloadedJourneyIds)==null?void 0:w.includes(i==null?void 0:i._id),onCardClick:()=>e.onCardClick(i._id),onDownload:e.onDownload,onRefresh:e.onRefresh,onCancel:e.onCancel},x)})})}function Pe(e){const{theme:s}=c.useContext(T),{mainBGColor:i,headerBGColor:x}=p(s);return n.jsx(Se,{style:{backgroundColor:x},children:n.jsxs(be,{style:{backgroundColor:i},children:[n.jsx(je,{onClick:e.onBack,showbtn:e.showBackBtn?"false":"true",children:n.jsx(re,{})}),n.jsx(Re,{cards:e.journeyItems,language:e.language,downloadedJourneyIds:e.downloadedJourneyIds,onCardClick:e.onCardClick,onDownload:e.onDownload,onRefresh:e.onRefresh,onCancel:e.onCancel})]})})}class Oe{constructor(){P(this,"fetchJourneyInfo",s=>new Promise((i,x)=>{const S=J+`/journey/${s}/journeys`;M.get(S).then(g=>{g.data?i(g.data):x(g.data.error)}).catch(g=>{x(this.getErrorMessage(g))})}));P(this,"fetchHierarchy",s=>new Promise((i,x)=>{const S=J+`/journey/${s}/hierarchy`;M.get(S).then(g=>{g.data?i(g.data):x(g.data.error)}).catch(g=>{x(this.getErrorMessage(g))})}))}getErrorMessage(s){let i=s.message;return s.response&&s.response.data&&s.response.data.message&&(i=s.response.data.message),i}}const D=new Oe,Le=r(u)({display:"flex",flexDirection:"column",margin:"auto",position:"relative",height:"100dvh"});function Ne(e){const[s,i]=c.useState(!1),[x,S]=c.useState(""),[g,E]=c.useState(""),[j,w]=c.useState([]),[k,W]=c.useState(),[Y,G]=c.useState(),[z,F]=c.useState(!1),{readingLanguage:_}=c.useContext(T),v=se();c.useEffect(()=>{var t,l;const a=e.terms.find(d=>d.pageTitle==="Index & Bookmark Page"),o=e.terms.find(d=>d.pageTitle==="Welcome Page");(t=a==null?void 0:a.isPublished)!=null&&t[_]?W(a):f.custom(d=>n.jsx(C,{text:"The terminologies for this page are not published.",visible:d.visible})),(l=o==null?void 0:o.isPublished)!=null&&l[_]?G(o):f.custom(d=>n.jsx(C,{text:"The terminologies for hamburger menu are not published.",visible:d.visible}))},[e.terms,_]),c.useEffect(()=>{var t,l;const o=(((t=e.books[1])==null?void 0:t.books)||[]).find(d=>(d==null?void 0:d._id)===e.currentBook);o&&(S(J+o.markImage||y.default_cover),E(((l=o==null?void 0:o.title)==null?void 0:l[_])||"Title"))},[e.books,e.currentBook,_]);const B=c.useCallback(a=>{var t;const o=(t=e.journeyCardInfos)==null?void 0:t.filter(l=>l.parent===a);if((o==null?void 0:o.length)>0){const l=Array.from(new Map(o.map(d=>[d._id,d])).values());return w(l),l}else return w([]),[]},[e.journeyCardInfos]);c.useEffect(()=>{!e.downloadedJourneyIds&&b.getAllJourneyIds().then(a=>{e.dispatch({type:h.SET_DOWNLOADED_JOURNEY_IDS,payload:{downloadedJourneyIds:a}})}),!e.downloadedArticleIds&&b.getAllArticleIds().then(a=>{e.dispatch({type:h.SET_DOWNLOADED_ARTICLE_IDS,payload:{downloadedArticleIds:a}})})},[]),c.useCallback(async a=>{i(!0),b.getJourneyCards(a).then(o=>{e.dispatch({type:h.ADD_JOURNEY_CARD_INFOS,payload:{cards:o}}),w(o)}).catch(o=>f.custom(t=>n.jsx(C,{text:o,visible:t.visible}))),i(!1)},[]),c.useEffect(()=>{if(i(!0),e.prevPage===O.LIBRARY||!e.parentJourneyId||e.parentJourneyId==e.currentBook)B(e.currentBook).length===0&&[].length==0&&D.fetchJourneyInfo(e.currentBook).then(t=>{e.dispatch({type:h.ADD_JOURNEY_CARD_INFOS,payload:{cards:t.cards}}),w(t.cards)}).catch(t=>f.custom(l=>n.jsx(C,{text:t,visible:l.visible}))),e.dispatch({type:h.SET_PREVIOUS_PAGE,payload:{prevPage:O.JOURNEYS}});else if(e.parentJourneyId&&B(e.parentJourneyId).length===0){let o=[];b.getJourneyCards(e.currentBook).then(t=>{o=t,w(t)}).catch(t=>f.custom(l=>n.jsx(C,{text:t,visible:l.visible}))),o.length==0&&D.fetchJourneyInfo(e.parentJourneyId).then(t=>{e.dispatch({type:h.ADD_JOURNEY_CARD_INFOS,payload:{cards:t.cards}}),w(t.cards)}).catch(t=>f.custom(l=>n.jsx(C,{text:t,visible:l.visible})))}i(!1)},[e.currentBook,e.prevPage,e.parentJourneyId]),c.useEffect(()=>{j.length>0&&j[0].depth!=1?F(!0):F(!1)},[j]);const K=()=>{var o,t,l;const a=((l=(t=(o=k==null?void 0:k.texts)==null?void 0:o.find(d=>d.variable==="Not Built Yet"))==null?void 0:t.text)==null?void 0:l[_])||"";f.custom(d=>n.jsx(C,{text:a,visible:d.visible}))},V=()=>{v("/library"),e.dispatch({type:h.SET_PREVIOUS_PAGE,payload:{prevPage:O.JOURNEYS}}),e.dispatch({type:h.SET_PARENT,payload:{parent:""}})},$=()=>{e.dispatch({type:h.RESET_USER}),e.dispatch({type:h.RESET_BOOK}),e.dispatch({type:h.RESET_PAGE_STATUS}),de.logout()},q=()=>v("/login"),Q=c.useCallback(()=>{var o;const a=(o=e.journeyCardInfos)==null?void 0:o.find(t=>t._id===e.parentJourneyId);B((a==null?void 0:a.parent)||""),e.dispatch({type:h.SET_PARENT,payload:{parentId:(a==null?void 0:a.parent)||""}})},[e.parentJourneyId,e.journeyCardInfos]),X=c.useCallback(a=>{var o,t;(t=(o=e.journeyCardInfos)==null?void 0:o.find(l=>(l==null?void 0:l._id)===a))!=null&&t.isArticle?(e.dispatch({type:h.SET_CURRENT_ARTICLE,payload:{articleId:a}}),v("/journeyReading")):e.dispatch({type:h.SET_PARENT,payload:{parentId:a}})},[e.journeyCardInfos]),U=c.useCallback((a,o)=>{i(!0),Promise.all([b.saveJourneys(a),b.saveArticleInfo(o)]).then(()=>{f.custom(t=>n.jsx(C,{text:"Downloaded successfully",visible:t.visible}))}).catch(t=>{f.custom(l=>n.jsx(C,{text:t,visible:l.visible}))}).finally(()=>{i(!1)})},[]),Z=a=>{D.fetchHierarchy(a).then(o=>{const t=o.journeys,l=o.articles,d=e.downloadedJourneyIds?t.filter(I=>!e.downloadedJourneyIds.includes(I._id)):t,R=e.downloadedArticleIds?l.filter(I=>{var A;return!((A=e.downloadedArticleIds)!=null&&A.includes(I._id))&&I.isArticle}):t.filter(I=>I.isArticle);if(d&&d.length>0){const I=d.map(A=>A._id)||[];I.push(a),e.dispatch({type:h.ADD_DOWNLOADED_JOURNEY_IDS,payload:{downloadedJourneyIds:I}})}if(R&&R.length>0){const I=R.map(A=>A._id)||[];I.push(a),e.dispatch({type:h.ADD_DOWNLOADED_ARTICLE_IDS,payload:{downloadedArticleIds:I}})}U(t,l)}).catch(o=>f.custom(t=>n.jsx(C,{text:o,visible:t.visible})))},ee=a=>{b.removeJourneyInfo(a).then(o=>{}).catch(o=>{f.custom(t=>n.jsx(C,{text:"Download canceled",visible:t.visible}))}),D.fetchHierarchy(a).then(o=>{const t=o.journeys,l=o.articles;U(t,l)})},te=a=>{b.removeJourneyInfo(a).then(o=>{f.custom(t=>n.jsx(C,{text:"Download canceled",visible:t.visible})),e.dispatch({type:h.REMOVE_DOWNLOADED_JOURNEY_IDS,payload:{journeyIds:o}})}).catch(o=>f.custom(t=>n.jsx(C,{text:o,visible:t.visible})))};return n.jsxs(Le,{children:[n.jsx(Te,{markImg:x,markTitle:g,isLoggedIn:!!e.currentUser,terms:k||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},welcomePageTerms:Y||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},onLogoClick:()=>v("/"),onCloseClick:V,onLogin:e.currentUser?$:q,onSettings:()=>v("/settings"),onSearchClick:K}),n.jsx(Pe,{currentUser:e.currentUser,language:_,journeyItems:j||[],showBackBtn:z,downloadedJourneyIds:e.downloadedJourneyIds,onBack:Q,onCardClick:X,onDownload:Z,onRefresh:ee,onCancel:te}),s&&n.jsx(ae,{})]})}function Fe(e){return{currentBook:e.pageStatus.currentBook,books:e.books.books,currentUser:e.user.currentUser,parentJourneyId:e.journeys.parentId,journeyCardInfos:e.journeys.journeyCardInfos,downloadedJourneyIds:e.journeys.downloadedJourneyIds,downloadedArticleIds:e.journeys.downloadedArticleIds,terms:e.terms.terms,prevPage:e.pageStatus.prevPage}}const Qe=ie(Fe)(Ne);export{Qe as default};

var Q=Object.defineProperty;var Z=(e,o,i)=>o in e?Q(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;var T=(e,o,i)=>Z(e,typeof o!="symbol"?o+"":o,i);import{b as c,j as t,a3 as m,X as ee,ap as w,ay as p}from"./index-BlVR3GtE.js";import{s as r,B as d,S as J,g as M,J as te,c as ne,u as oe,k as f,d as y}from"./App-BJY6yC-A.js";import{I as x,T as B}from"./index-D5V6sI32.js";import{L as ie}from"./index-RvPIy0zx.js";import{C}from"./index-D05QJQAH.js";import{H as ae}from"./index-Cmz9N20C.js";import{a as se}from"./auth.service-BbDv6u2-.js";import{a as D}from"./axios-upsvKRUO.js";import{i as _}from"./indexedDB.service-DjeHtksZ.js";import"./index-vAMjffkV.js";const re=r(d)({display:"flex",position:"relative",width:"100%"}),le=r("img")({width:"100%",marginTop:"57px"}),ce=r(d)({display:"flex",alignItems:"baseline",justifyContent:"space-between",position:"absolute",left:"30px",top:"30px",width:"calc(100% - 60px)"}),de=r(d)({display:"flex",flexDirection:"column"}),ue=r(d)({width:"40px",cursor:"pointer",position:"relative","& div":{position:"absolute",top:"28px",width:"100%",textAlign:"center",maxWidth:"65px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}}),ge=r("img")({width:"100%",height:"100%"}),he=r(d)({margin:0,position:"relative",top:"-20px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}),xe=r(d)(({hamburgercolor:e})=>({position:"absolute",top:"12px",right:"15px",width:"46px","& .hamburger-react":{width:"46px !important",color:e},"& .hamburger-react ~ .MuiBox-root ":{border:`1px solid ${e}`},"@media (max-height: 639px)":{top:"8px",right:"10px"},"@media screen and (orientation: landscape)":{right:"15px"}})),ye=r("img")({position:"relative",top:"10px",cursor:"pointer","&:active":{opacity:"0.8"}}),me=r(d)({position:"absolute",top:"60px",left:"50%",transform:"translate(-50%, -50%)",cursor:"pointer"}),fe=r("img")({width:"100%","&:active":{opacity:"0.8"}});r("img")({position:"absolute",top:"18px",right:"30px",cursor:"pointer","&:active":{opacity:"0.8"}});const Ce=r(d)({height:"calc(100dvh - 145px)",width:"100%",position:"absolute",top:"145px",padding:"0px 30px","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),Se=r(d)({backgroundColor:"#FFF",height:"calc(100dvh - 145px)",position:"relative",zIndex:"1",display:"flex",flexDirection:"column",padding:"20px",overflowY:"scroll","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),be=r(d)(({showbtn:e})=>({width:"100%",display:e==="true"?"none":"flex",alignItems:"center",marginBottom:"10px",svg:{fill:"#1B7695"}})),ke=r(d)({padding:0,boxSizing:"border-box",display:"flex",flexDirection:"column"}),je=r(d)({backgroundColor:"#F0F5FB",padding:"9px 11px",marginBottom:"10px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between"}),ve=r(d)({width:"95%",display:"flex",flexDirection:"column",alignItems:"center"}),Ie=r(d)({width:"100%",display:"flex",alignItems:"center"}),pe=r(d)({width:"15px",height:"15px",marginRight:"10px"}),we=r("img")({width:"100%",height:"100%"}),Ee=r(d)({width:"100%","& .MuiBox-root":{width:"100%",display:"-webkit-box",justifyContent:"center",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:"2",WebkitBoxOrient:"vertical"}}),Te=r(d)({width:"3%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer"}),_e=r("img")({width:"16px",height:"16px"});function Be(e){const{theme:o}=c.useContext(J),{logoTextColor:i,headerBGColor:g}=M(o);return t.jsxs(re,{children:[t.jsx(le,{src:o==m.DEFAULT||o==m.DARK?x.book_subtract:o==m.BLACK_AND_WHITE?x.book_subtract_BAW:o==m.SAPPHIRE?x.book_subtract_sapphire:x.book_subtract_easyocean}),t.jsxs(ce,{children:[t.jsxs(de,{children:[t.jsx(ue,{onClick:e.onLogoClick,children:t.jsx(ge,{src:e.markImg})}),t.jsx(he,{children:t.jsx(B,{fontFamily:"Buenard",fontWeight:"700",fontSize:36,lineHeight:47,textAlign:"center",color:i,children:e.markTitle})})]}),t.jsx(ye,{src:o==m.EASY_OCEAN?x.search_easyocean:x.search,onClick:e.onSearchClick})]}),t.jsx(me,{children:t.jsx(fe,{src:o==m.DEFAULT||o==m.DARK?x.close2:o==m.BLACK_AND_WHITE?x.close2_BAW:o==m.SAPPHIRE?x.close2_sapphire:x.close2_easyocean,onClick:e.onCloseClick})}),t.jsx(xe,{hamburgercolor:g,children:t.jsx(ae,{isLogin:e.isLoggedIn,textColor:i,itemBgColor:g,toggleColor:g,terms:e.welcomePageTerms,onLogin:e.onLogin,onSettings:e.onSettings})})]})}var A={},Je=ee;Object.defineProperty(A,"__esModule",{value:!0});var H=A.default=void 0,Ae=Je(te()),Re=t;H=A.default=(0,Ae.default)((0,Re.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");function Pe(e){return t.jsxs(je,{children:[t.jsxs(ve,{onClick:()=>e.onCardClick(e.cardId),children:[t.jsxs(Ie,{children:[t.jsx(pe,{children:t.jsx(we,{src:w+e.image})}),t.jsx(B,{fontFamily:"Inter",fontWeight:"400",fontSize:12,lineHeight:24,color:"#899093",children:e.seriesTitle})]}),t.jsx(Ee,{children:t.jsx(B,{fontFamily:"Inter",fontWeight:"700",fontSize:16,lineHeight:24,color:"#000",children:e.title})})]}),t.jsx(Te,{children:t.jsx(_e,{src:x.download,onClick:()=>e.onDownload(e.cardId)})})]})}function De(e){var o;return t.jsx(ke,{children:(o=e.cards)==null?void 0:o.map((i,g)=>{var S,u;return t.jsx(Pe,{cardId:i._id,image:i==null?void 0:i.image,seriesTitle:(S=i==null?void 0:i.seriesTitle)==null?void 0:S.en,title:(u=i==null?void 0:i.title)==null?void 0:u.en,isDownloaded:!1,onCardClick:()=>e.onCardClick(i._id),onDownload:e.onDownload},g)})})}function Le(e){const{theme:o}=c.useContext(J),{mainBGColor:i,headerBGColor:g}=M(o);return t.jsx(Ce,{style:{backgroundColor:g},children:t.jsxs(Se,{style:{backgroundColor:i},children:[t.jsx(be,{onClick:e.onBack,showbtn:e.showBackBtn?"false":"true",children:t.jsx(H,{})}),t.jsx(De,{cards:e.journeyItems,onCardClick:e.onCardClick,onDownload:e.onDownload})]})})}class Me{constructor(){T(this,"fetchJourneyInfo",o=>new Promise((i,g)=>{const S=w+`/journey/${o}/journeys`;D.get(S).then(u=>{u.data?i(u.data):g(u.data.error)}).catch(u=>{g(this.getErrorMessage(u))})}));T(this,"fetchHierarchy",o=>new Promise((i,g)=>{const S=w+`/journey/${o}/hierarchy`;D.get(S).then(u=>{u.data?i(u.data):g(u.data.error)}).catch(u=>{g(this.getErrorMessage(u))})}))}getErrorMessage(o){let i=o.message;return o.response&&o.response.data&&o.response.data.message&&(i=o.response.data.message),i}}const L=new Me,He=r(d)({display:"flex",flexDirection:"column",margin:"auto",position:"relative",height:"100dvh"});function Ne(e){const[o,i]=c.useState(!1),[g,S]=c.useState(""),[u,N]=c.useState(""),[j,v]=c.useState([]),[I,F]=c.useState(),[U,O]=c.useState(),[W,R]=c.useState(!1),{readingLanguage:b}=c.useContext(J),k=oe();c.useEffect(()=>{var s,l;const a=e.terms.find(h=>h.pageTitle==="Index & Bookmark Page"),n=e.terms.find(h=>h.pageTitle==="Welcome Page");(s=a==null?void 0:a.isPublished)!=null&&s[b]?F(a):f.custom(h=>t.jsx(C,{text:"The terminologies for this page are not published.",visible:h.visible})),(l=n==null?void 0:n.isPublished)!=null&&l[b]?O(n):f.custom(h=>t.jsx(C,{text:"The terminologies for hamburger menu are not published.",visible:h.visible}))},[e.terms,b]),c.useEffect(()=>{var s,l;const n=(((s=e.books[1])==null?void 0:s.books)||[]).find(h=>(h==null?void 0:h._id)===e.currentBook);n&&(S(w+n.markImage||x.default_cover),N(((l=n==null?void 0:n.title)==null?void 0:l[b])||"Title"))},[e.books,e.currentBook,b]);const E=c.useCallback(a=>{var s;const n=(s=e.journeyCardInfos)==null?void 0:s.filter(l=>l.parent===a);return n.length>0?(v(n),n):(v([]),[])},[e.journeyCardInfos]),P=c.useCallback(a=>{L.fetchJourneyInfo(a).then(n=>{e.dispatch({type:y.ADD_JOURNEY_CARD_INFOS,payload:{cards:n.cards}}),v(n.cards)}).catch(n=>f.custom(s=>t.jsx(C,{text:n,visible:s.visible})))},[]);c.useCallback(async a=>{i(!0),_.getJourneyCards(a).then(n=>{e.dispatch({type:y.ADD_JOURNEY_CARD_INFOS,payload:{cards:n}}),v(n)}).catch(n=>f.custom(s=>t.jsx(C,{text:n,visible:s.visible}))),i(!1)},[]),c.useEffect(()=>{i(!0),e.prevPage===p.LIBRARY||e.prevPage===p.READING&&e.parentJourneyId==e.currentBook?(E(e.currentBook).length===0&&P(e.currentBook),e.dispatch({type:y.SET_PREVIOUS_PAGE,payload:{prevPage:p.JOURNEYS}})):e.parentJourneyId&&E(e.parentJourneyId).length===0&&P(e.parentJourneyId),i(!1)},[e.currentBook,e.prevPage,e.parentJourneyId]),c.useEffect(()=>{j.length>0&&j[0].depth!=1?R(!0):R(!1)},[j]);const G=()=>{var n,s,l;const a=((l=(s=(n=I==null?void 0:I.texts)==null?void 0:n.find(h=>h.variable==="Not Built Yet"))==null?void 0:s.text)==null?void 0:l[b])||"";f.custom(h=>t.jsx(C,{text:a,visible:h.visible}))},Y=()=>{k("/library"),e.dispatch({type:y.SET_PREVIOUS_PAGE,payload:{prevPage:p.JOURNEYS}}),e.dispatch({type:y.SET_PARENT,payload:{parent:""}})},z=()=>{e.dispatch({type:y.RESET_USER}),e.dispatch({type:y.RESET_BOOK}),e.dispatch({type:y.RESET_PAGE_STATUS}),se.logout()},K=()=>k("/login"),q=c.useCallback(()=>{var n;const a=(n=e.journeyCardInfos)==null?void 0:n.find(s=>s._id===e.parentJourneyId);E((a==null?void 0:a.parent)||""),e.dispatch({type:y.SET_PARENT,payload:{parentId:(a==null?void 0:a.parent)||""}})},[e.parentJourneyId,e.journeyCardInfos]),$=c.useCallback(a=>{var n,s;(s=(n=e.journeyCardInfos)==null?void 0:n.find(l=>(l==null?void 0:l._id)===a))!=null&&s.isArticle?(e.dispatch({type:y.SET_CURRENT_ARTICLE,payload:{articleId:a}}),k("/Reading")):e.dispatch({type:y.SET_PARENT,payload:{parentId:a}})},[e.journeyCardInfos]),V=c.useCallback((a,n)=>{_.saveJourneys(a).then(s=>console.log("Downloaded journey cards")).catch(s=>f.custom(l=>t.jsx(C,{text:s,visible:l.visible}))),_.saveArticleInfo(n).then(s=>f.custom(l=>t.jsx(C,{text:"Downloaded successfully",visible:l.visible}))).catch(s=>f.custom(l=>t.jsx(C,{text:s,visible:l.visible})))},[]),X=c.useCallback(a=>{L.fetchHierarchy(a).then(n=>{const s=n.journeys,l=n.articles;V(s,l)}).catch(n=>f.custom(s=>t.jsx(C,{text:n,visible:s.visible})))},[e.journeyCardInfos,b]);return t.jsxs(He,{children:[t.jsx(Be,{markImg:g,markTitle:u,isLoggedIn:!!e.currentUser,terms:I||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},welcomePageTerms:U||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},onLogoClick:()=>k("/"),onCloseClick:Y,onLogin:e.currentUser?z:K,onSettings:()=>k("/settings"),onSearchClick:G}),t.jsx(Le,{currentUser:e.currentUser,journeyItems:j||[],showBackBtn:W,onBack:q,onCardClick:$,onDownload:X}),o&&t.jsx(ie,{})]})}function Fe(e){return{currentBook:e.pageStatus.currentBook,books:e.books.books,currentUser:e.user.currentUser,parentJourneyId:e.journeys.parentId,journeyCardInfos:e.journeys.journeyCardInfos,terms:e.terms.terms,prevPage:e.pageStatus.prevPage}}const Qe=ne(Fe)(Ne);export{Qe as default};

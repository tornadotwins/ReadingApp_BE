var Dt=Object.defineProperty;var Ut=(e,o,n)=>o in e?Dt(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n;var ut=(e,o,n)=>Ut(e,typeof o!="symbol"?o+"":o,n);import{c as Ae,_ as W,j as s,$ as le,b,ak as $t,F as re,ao as It,ar as Ot,as as Ie,at as Oe,a3 as z,Z as V,au as _e,av as Lt,aw as Mt,ax as Ce,ay as bt,az as Ne,aA as gt,ap as zt}from"./index-BDXlx7Nx.js";import{w as _t,x as Nt,y as Ft,z as Te,s as de,A as Ht,D as Rt,E as je,F as jt,S as Pe,g as Ee,k as K,B as At,c as Kt,u as Gt,d as A}from"./App-Bk_IYhqz.js";import{S as Wt,a as Vt,b as Yt,c as qt,d as Xt,e as Zt,f as Qt,g as Jt,h as xt,i as pt,j as eo,k as to,l as kt,m as oo,n as ao,o as so,p as no,q as io,r as lo,s as ro,t as co,u as uo,v as bo,w as go,x as xo,y as ko,z as fo,A as mo,B as vo,C as ft,D as mt,E as vt,F as yo}from"./BookHeader-CE7RS6BW.js";import{T as J,I,g as Bo,a as yt}from"./index-B0O_8s5r.js";import{C as G}from"./index-BgvThBuo.js";import{A as So,b as Bt}from"./bookmark.service-C-pAdqt5.js";import{S as Co}from"./index-CL6b5zES.js";import{L as ho}from"./index-DDqzpGV-.js";import{b as St}from"./book.service-7b7scVsx.js";import{a as Re}from"./auth.service-wo9EdzIN.js";import"./index-DKIqm1vo.js";import"./index-CQTB8SNX.js";import"./axios-upsvKRUO.js";function To(e){return Nt("MuiPagination",e)}_t("MuiPagination",["root","ul","outlined","text"]);const Po=["boundaryCount","componentName","count","defaultPage","disabled","hideNextButton","hidePrevButton","onChange","page","showFirstButton","showLastButton","siblingCount"];function Eo(e={}){const{boundaryCount:o=1,componentName:n="usePagination",count:t=1,defaultPage:g=1,disabled:k=!1,hideNextButton:m=!1,hidePrevButton:S=!1,onChange:_,page:f,showFirstButton:y=!1,showLastButton:O=!1,siblingCount:d=1}=e,l=Ae(e,Po),[B,P]=Ft({controlled:f,default:g,name:n,state:"page"}),U=(c,C)=>{f||P(C),_&&_(c,C)},E=(c,C)=>{const r=C-c+1;return Array.from({length:r},(i,u)=>c+u)},N=E(1,Math.min(o,t)),R=E(Math.max(t-o+1,o+1),t),q=Math.max(Math.min(B-d,t-o-d*2-1),o+2),w=Math.min(Math.max(B+d,o+d*2+2),R.length>0?R[0]-2:t-1),L=[...y?["first"]:[],...S?[]:["previous"],...N,...q>o+2?["start-ellipsis"]:o+1<t-o?[o+1]:[],...E(q,w),...w<t-o-1?["end-ellipsis"]:t-o>o?[t-o]:[],...R,...m?[]:["next"],...O?["last"]:[]],X=c=>{switch(c){case"first":return 1;case"previous":return B-1;case"next":return B+1;case"last":return t;default:return null}},x=L.map(c=>typeof c=="number"?{onClick:C=>{U(C,c)},type:"page",page:c,selected:c===B,disabled:k,"aria-current":c===B?"true":void 0}:{onClick:C=>{U(C,X(c))},type:c,page:X(c),selected:!1,disabled:k||c.indexOf("ellipsis")===-1&&(c==="next"||c==="last"?B>=t:B<=1)});return W({items:x},l)}function Io(e){return Nt("MuiPaginationItem",e)}const Y=_t("MuiPaginationItem",["root","page","sizeSmall","sizeLarge","text","textPrimary","textSecondary","outlined","outlinedPrimary","outlinedSecondary","rounded","ellipsis","firstLast","previousNext","focusVisible","disabled","selected","icon","colorPrimary","colorSecondary"]),Ct=Te(s.jsx("path",{d:"M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"}),"FirstPage"),ht=Te(s.jsx("path",{d:"M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"}),"LastPage"),Tt=Te(s.jsx("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"}),"NavigateBefore"),Pt=Te(s.jsx("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"}),"NavigateNext"),Oo=["className","color","component","components","disabled","page","selected","shape","size","slots","type","variant"],wt=(e,o)=>{const{ownerState:n}=e;return[o.root,o[n.variant],o[`size${re(n.size)}`],n.variant==="text"&&o[`text${re(n.color)}`],n.variant==="outlined"&&o[`outlined${re(n.color)}`],n.shape==="rounded"&&o.rounded,n.type==="page"&&o.page,(n.type==="start-ellipsis"||n.type==="end-ellipsis")&&o.ellipsis,(n.type==="previous"||n.type==="next")&&o.previousNext,(n.type==="first"||n.type==="last")&&o.firstLast]},_o=e=>{const{classes:o,color:n,disabled:t,selected:g,size:k,shape:m,type:S,variant:_}=e,f={root:["root",`size${re(k)}`,_,m,n!=="standard"&&`color${re(n)}`,n!=="standard"&&`${_}${re(n)}`,t&&"disabled",g&&"selected",{page:"page",first:"firstLast",last:"firstLast","start-ellipsis":"ellipsis","end-ellipsis":"ellipsis",previous:"previousNext",next:"previousNext"}[S]],icon:["icon"]};return jt(f,Io,o)},No=de("div",{name:"MuiPaginationItem",slot:"Root",overridesResolver:wt})(({theme:e,ownerState:o})=>W({},e.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,padding:"0 6px",margin:"0 3px",color:(e.vars||e).palette.text.primary,height:"auto",[`&.${Y.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity}},o.size==="small"&&{minWidth:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},o.size==="large"&&{minWidth:40,borderRadius:40/2,padding:"0 10px",fontSize:e.typography.pxToRem(15)})),Ro=de(Ht,{name:"MuiPaginationItem",slot:"Root",overridesResolver:wt})(({theme:e,ownerState:o})=>W({},e.typography.body2,{borderRadius:32/2,textAlign:"center",boxSizing:"border-box",minWidth:32,height:32,padding:"0 6px",margin:"0 3px",color:(e.vars||e).palette.text.primary,[`&.${Y.focusVisible}`]:{backgroundColor:(e.vars||e).palette.action.focus},[`&.${Y.disabled}`]:{opacity:(e.vars||e).palette.action.disabledOpacity},transition:e.transitions.create(["color","background-color"],{duration:e.transitions.duration.short}),"&:hover":{backgroundColor:(e.vars||e).palette.action.hover,"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Y.selected}`]:{backgroundColor:(e.vars||e).palette.action.selected,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.selectedChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:le(e.palette.action.selected,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(e.vars||e).palette.action.selected}},[`&.${Y.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.action.selectedChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.focusOpacity}))`:le(e.palette.action.selected,e.palette.action.selectedOpacity+e.palette.action.focusOpacity)},[`&.${Y.disabled}`]:{opacity:1,color:(e.vars||e).palette.action.disabled,backgroundColor:(e.vars||e).palette.action.selected}}},o.size==="small"&&{minWidth:26,height:26,borderRadius:26/2,margin:"0 1px",padding:"0 4px"},o.size==="large"&&{minWidth:40,height:40,borderRadius:40/2,padding:"0 10px",fontSize:e.typography.pxToRem(15)},o.shape==="rounded"&&{borderRadius:(e.vars||e).shape.borderRadius}),({theme:e,ownerState:o})=>W({},o.variant==="text"&&{[`&.${Y.selected}`]:W({},o.color!=="standard"&&{color:(e.vars||e).palette[o.color].contrastText,backgroundColor:(e.vars||e).palette[o.color].main,"&:hover":{backgroundColor:(e.vars||e).palette[o.color].dark,"@media (hover: none)":{backgroundColor:(e.vars||e).palette[o.color].main}},[`&.${Y.focusVisible}`]:{backgroundColor:(e.vars||e).palette[o.color].dark}},{[`&.${Y.disabled}`]:{color:(e.vars||e).palette.action.disabled}})},o.variant==="outlined"&&{border:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${e.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${Y.selected}`]:W({},o.color!=="standard"&&{color:(e.vars||e).palette[o.color].main,border:`1px solid ${e.vars?`rgba(${e.vars.palette[o.color].mainChannel} / 0.5)`:le(e.palette[o.color].main,.5)}`,backgroundColor:e.vars?`rgba(${e.vars.palette[o.color].mainChannel} / ${e.vars.palette.action.activatedOpacity})`:le(e.palette[o.color].main,e.palette.action.activatedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[o.color].mainChannel} / calc(${e.vars.palette.action.activatedOpacity} + ${e.vars.palette.action.focusOpacity}))`:le(e.palette[o.color].main,e.palette.action.activatedOpacity+e.palette.action.focusOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${Y.focusVisible}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette[o.color].mainChannel} / calc(${e.vars.palette.action.activatedOpacity} + ${e.vars.palette.action.focusOpacity}))`:le(e.palette[o.color].main,e.palette.action.activatedOpacity+e.palette.action.focusOpacity)}},{[`&.${Y.disabled}`]:{borderColor:(e.vars||e).palette.action.disabledBackground,color:(e.vars||e).palette.action.disabled}})})),jo=de("div",{name:"MuiPaginationItem",slot:"Icon",overridesResolver:(e,o)=>o.icon})(({theme:e,ownerState:o})=>W({fontSize:e.typography.pxToRem(20),margin:"0 -8px"},o.size==="small"&&{fontSize:e.typography.pxToRem(18)},o.size==="large"&&{fontSize:e.typography.pxToRem(22)})),Ao=b.forwardRef(function(o,n){const t=Rt({props:o,name:"MuiPaginationItem"}),{className:g,color:k="standard",component:m,components:S={},disabled:_=!1,page:f,selected:y=!1,shape:O="circular",size:d="medium",slots:l={},type:B="page",variant:P="text"}=t,U=Ae(t,Oo),E=W({},t,{color:k,disabled:_,selected:y,shape:O,size:d,type:B,variant:P}),N=$t(),R=_o(E),w=(N?{previous:l.next||S.next||Pt,next:l.previous||S.previous||Tt,last:l.first||S.first||Ct,first:l.last||S.last||ht}:{previous:l.previous||S.previous||Tt,next:l.next||S.next||Pt,first:l.first||S.first||Ct,last:l.last||S.last||ht})[B];return B==="start-ellipsis"||B==="end-ellipsis"?s.jsx(No,{ref:n,ownerState:E,className:je(R.root,g),children:"â€¦"}):s.jsxs(Ro,W({ref:n,ownerState:E,component:m,disabled:_,className:je(R.root,g)},U,{children:[B==="page"&&f,w?s.jsx(jo,{as:w,ownerState:E,className:R.icon}):null]}))}),wo=["boundaryCount","className","color","count","defaultPage","disabled","getItemAriaLabel","hideNextButton","hidePrevButton","onChange","page","renderItem","shape","showFirstButton","showLastButton","siblingCount","size","variant"],Do=e=>{const{classes:o,variant:n}=e;return jt({root:["root",n],ul:["ul"]},To,o)},Uo=de("nav",{name:"MuiPagination",slot:"Root",overridesResolver:(e,o)=>{const{ownerState:n}=e;return[o.root,o[n.variant]]}})({}),$o=de("ul",{name:"MuiPagination",slot:"Ul",overridesResolver:(e,o)=>o.ul})({display:"flex",flexWrap:"wrap",alignItems:"center",padding:0,margin:0,listStyle:"none"});function Lo(e,o,n){return e==="page"?`${n?"":"Go to "}page ${o}`:`Go to ${e} page`}const Mo=b.forwardRef(function(o,n){const t=Rt({props:o,name:"MuiPagination"}),{boundaryCount:g=1,className:k,color:m="standard",count:S=1,defaultPage:_=1,disabled:f=!1,getItemAriaLabel:y=Lo,hideNextButton:O=!1,hidePrevButton:d=!1,renderItem:l=x=>s.jsx(Ao,W({},x)),shape:B="circular",showFirstButton:P=!1,showLastButton:U=!1,siblingCount:E=1,size:N="medium",variant:R="text"}=t,q=Ae(t,wo),{items:w}=Eo(W({},t,{componentName:"Pagination"})),L=W({},t,{boundaryCount:g,color:m,count:S,defaultPage:_,disabled:f,getItemAriaLabel:y,hideNextButton:O,hidePrevButton:d,renderItem:l,shape:B,showFirstButton:P,showLastButton:U,siblingCount:E,size:N,variant:R}),X=Do(L);return s.jsx(Uo,W({"aria-label":"pagination navigation",className:je(X.root,k),ownerState:L,ref:n},q,{children:s.jsx($o,{className:X.ul,ownerState:L,children:w.map((x,c)=>s.jsx("li",{children:l(W({},x,{color:m,"aria-label":y(x.type,x.page,x.selected),shape:B,size:N,variant:R}))},c))})}))});function zo(e){return s.jsx(Mo,{count:e.count,hidePrevButton:e.hideNextButton,hideNextButton:e.hideNextButton,page:e.page,siblingCount:0,boundaryCount:1,onChange:e.onChange})}function Et(){const{innerWidth:e,innerHeight:o}=window;return{width:e,height:o}}function Fo(){const[e,o]=b.useState(Et());return b.useEffect(()=>{function n(){o(Et())}return window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]),e}function Ho(e){var C,r,i,u,T,v,h,Z,ae,p,ee,te,oe,se,ce,ue,be,D,we,De,Ue,$e,Le,Me,ze,Fe,He,Ke,Ge,We,Ve,Ye,qe,Xe,Ze,Qe,Je,pe,et,tt;const[o,n]=b.useState([]),[t,g]=b.useState(),[k,m]=b.useState(!1),[S,_]=b.useState(!1),[f,y]=b.useState(0),{theme:O,referenceLanguage:d,readingLanguage:l}=b.useContext(Pe),{mainBGColor:B,altTextColor:P,backgroundColor:U,topTextColor:E,buttonColor:N,buttonTextColor:R}=Ee(O),q=localStorage.getItem(It)||Ot,w=b.useMemo(()=>{if(e.userHistory&&e.userHistory.length>0){const a=e.userHistory.filter(M=>M.bookId==e.bookId);if(a&&a.length>0)return a[0].readChapterIds}return[]},[e.userHistory]),L=e.subBookId;b.useEffect(()=>{e.bookTitle.en=="Qur'an"||e.bookTitle.en=="Zabur"?m(!1):e.openedSubBook==e.subBookId?m(!0):m(!1)},[e.openedSubBook]),b.useEffect(()=>{var H,F;const a=e.subBooks.filter($=>$.subBookId===L);let M=0;if(a&&a.length>0&&(M=(H=a[0].chapterInfos)==null?void 0:H.length,g(a[0])),e.currentUser){const $=e.userHistory.filter(j=>j.bookId==e.bookId);if($&&$.length>0){const j=$[0].subBooks.filter(Q=>Q.subBookId==L);j&&j.length>0&&y(Math.floor(((F=j[0])==null?void 0:F.readChapters)/M*100))}}if(e.subBooks&&e.subBooks.length>0){const $=e.subBooks.filter(j=>j.subBookId==L);if($&&$.length>0){let j=$[0].chapterInfos;j.sort((Q,ne)=>Q.chapterNumber-ne.chapterNumber),n(j)}}},[e.subBooks,e.userHistory]),b.useEffect(()=>{if(e.subBookInfos&&e.subBookInfos.length>0){const a=e.subBookInfos.filter(M=>M.subBookId==L);a&&a.length>0?_(!0):_(!1)}},[]);const X=b.useCallback(a=>{_(M=>!M),e.onDownload(a)},[]),x=()=>{var a,M;if(t!=null&&t.noChapter){const H=(a=t==null?void 0:t.chapterInfos[0])==null?void 0:a.isTranslated,F=(M=t==null?void 0:t.chapterInfos[0])==null?void 0:M.isPublished;!(H!=null&&H[d])&&!(H!=null&&H[l])||!(F!=null&&F[d])&&!(F!=null&&F[l])?K.custom($=>{var j,Q,ne;return s.jsx(G,{text:((ne=(Q=(j=e.terms)==null?void 0:j.texts.find(Se=>Se.variable=="None Translated"))==null?void 0:Q.text)==null?void 0:ne[l])||"",visible:$.visible})}):e.moveToReading(t==null?void 0:t.chapterInfos[0].chapterId,t.subBookId)}else m(!k),e.handleOpenedSubBook(e.subBookId)},c=(a,M)=>{M=="none"?K.custom(H=>{var F,$,j;return s.jsx(G,{text:((j=($=(F=e.terms)==null?void 0:F.texts.find(Q=>Q.variable=="None Translated"))==null?void 0:$.text)==null?void 0:j[l])||"",visible:H.visible})}):e.moveToReading(a,t.subBookId)};return s.jsxs(Wt,{id:e.id,children:[s.jsxs(Vt,{children:[s.jsxs(Yt,{progress:f,progresscolor:N,onClick:x,children:[(t==null?void 0:t.subBookNumber)!=0&&s.jsxs(qt,{istransliteration:((C=t==null?void 0:t.subBookTitle)==null?void 0:C[Ie])!=null?"true":"false",translatestatus:(t==null?void 0:t.noChapter)&&(!((i=(r=t==null?void 0:t.chapterInfos[0])==null?void 0:r.isTranslated)!=null&&i[d])&&!((T=(u=t==null?void 0:t.chapterInfos[0])==null?void 0:u.isTranslated)!=null&&T[l])||!((h=(v=t==null?void 0:t.chapterInfos[0])==null?void 0:v.isPublished)!=null&&h[d])&&!((ae=(Z=t==null?void 0:t.chapterInfos[0])==null?void 0:Z.isPublished)!=null&&ae[l])?"none":(!((ee=(p=t==null?void 0:t.chapterInfos[0])==null?void 0:p.isTranslated)!=null&&ee[d])||!((oe=(te=t==null?void 0:t.chapterInfos[0])==null?void 0:te.isTranslated)!=null&&oe[l]))&&((ce=(se=t==null?void 0:t.chapterInfos[0])==null?void 0:se.isPublished)!=null&&ce[d]||!((be=(ue=t==null?void 0:t.chapterInfos[0])==null?void 0:ue.isPublished)!=null&&be[l]))?"one":"both")||"",children:[((D=t==null?void 0:t.subBookTitle)==null?void 0:D[Ie])&&s.jsx(J,{fontFamily:'"Baloo Da 2"',fontWeight:"bold",color:P,language:Oe,children:(t==null?void 0:t.subBookNumber)+". "+((we=t==null?void 0:t.subBookTitle)==null?void 0:we[Ie])}),s.jsx(J,{fontFamily:'"Baloo Da 2"',fontWeight:"bold",color:P,language:Oe,direction:"rtl",children:(De=t==null?void 0:t.subBookTitle)==null?void 0:De[Oe]})]}),s.jsxs(Xt,{children:[s.jsxs(Zt,{translatestatus:t!=null&&t.noChapter&&(!(($e=(Ue=t==null?void 0:t.chapterInfos[0])==null?void 0:Ue.isTranslated)!=null&&$e[d])&&!((Me=(Le=t==null?void 0:t.chapterInfos[0])==null?void 0:Le.isTranslated)!=null&&Me[l])||!((Fe=(ze=t==null?void 0:t.chapterInfos[0])==null?void 0:ze.isPublished)!=null&&Fe[d])&&!((Ke=(He=t==null?void 0:t.chapterInfos[0])==null?void 0:He.isPublished)!=null&&Ke[l]))?"none":(!((We=(Ge=t==null?void 0:t.chapterInfos[0])==null?void 0:Ge.isTranslated)!=null&&We[d])||!((Ye=(Ve=t==null?void 0:t.chapterInfos[0])==null?void 0:Ve.isTranslated)!=null&&Ye[l]))&&((Xe=(qe=t==null?void 0:t.chapterInfos[0])==null?void 0:qe.isPublished)!=null&&Xe[d]||!((Qe=(Ze=t==null?void 0:t.chapterInfos[0])==null?void 0:Ze.isPublished)!=null&&Qe[l]))?"one":"both",children:[s.jsx(J,{fontFamily:'"Baloo Da 2"',color:P,children:(Je=t==null?void 0:t.subBookTitle)==null?void 0:Je[q]}),(t==null?void 0:t.subBookNumber)==0&&s.jsx(Qt,{src:I.icon_intro})]}),e.currentUser&&f!==0&&!(t!=null&&t.noChapter)&&s.jsx(J,{fontFamily:'"Baloo Da 2"',color:N,children:`${f}%`})]})]}),s.jsxs(Jt,{isdownloaded:S?"true":"false",children:[s.jsx(xt,{src:S?O==z.DEFAULT||O==z.EASY_OCEAN?I.download_cancel:I.download_cancel_white:O==z.DEFAULT||O==z.EASY_OCEAN?I.download:I.download_white,onClick:()=>X(L)}),S&&s.jsx(xt,{src:O==z.DEFAULT||O==z.EASY_OCEAN?I.download_refresh:I.download_refresh_white,onClick:()=>e.onDownloadRefresh(L)})]})]}),k&&s.jsxs(pt,{style:{backgroundColor:U},children:[s.jsx(eo,{children:s.jsx(J,{fontFamily:"Inter",color:E,children:((tt=(et=(pe=e.terms)==null?void 0:pe.texts.find(a=>a.variable=="Chapter"))==null?void 0:et.text)==null?void 0:tt[l])||""})}),s.jsx(to,{children:o==null?void 0:o.map((a,M)=>{var H,F,$,j,Q,ne,Se,ot,at,st,nt,it,lt,rt,dt,ct;return a.chapterNumber==0?s.jsx(kt,{translatestatus:!((H=a==null?void 0:a.isTranslated)!=null&&H[d])&&!((F=a==null?void 0:a.isTranslated)!=null&&F[l])||!(($=a==null?void 0:a.isPublished)!=null&&$[d])&&!((j=a==null?void 0:a.isPublished)!=null&&j[l])?"none":(!((Q=a==null?void 0:a.isTranslated)!=null&&Q[d])||!((ne=a==null?void 0:a.isTranslated)!=null&&ne[l]))&&((Se=a==null?void 0:a.isPublished)!=null&&Se[d]||!((ot=a==null?void 0:a.isPublished)!=null&&ot[l]))?"one":"both",readalready:w&&w.length>0&&w.includes(a.chapterId)?"true":"false",style:{backgroundColor:B,color:P},readbgcolor:N,readtextcolor:R,onClick:()=>{var ge,xe,ke,fe,me,ve,ye,Be;return c(a.chapterId,!((ge=a==null?void 0:a.isTranslated)!=null&&ge[d])&&!((xe=a==null?void 0:a.isTranslated)!=null&&xe[l])||!((ke=a==null?void 0:a.isPublished)!=null&&ke[d])&&!((fe=a==null?void 0:a.isPublished)!=null&&fe[l])?"none":(!((me=a.isTranslated)!=null&&me[d])||!((ve=a==null?void 0:a.isTranslated)!=null&&ve[l]))&&((ye=a==null?void 0:a.isPublished)!=null&&ye[d]||!((Be=a==null?void 0:a.isPublished)!=null&&Be[l]))?"one":"both")},children:s.jsx(oo,{src:I.icon_intro})},M):s.jsx(kt,{translatestatus:!((at=a==null?void 0:a.isTranslated)!=null&&at[d])&&!((st=a==null?void 0:a.isTranslated)!=null&&st[l])||!((nt=a==null?void 0:a.isPublished)!=null&&nt[d])&&!((it=a==null?void 0:a.isPublished)!=null&&it[l])?"none":(!((lt=a==null?void 0:a.isTranslated)!=null&&lt[d])||!((rt=a==null?void 0:a.isTranslated)!=null&&rt[l]))&&((dt=a==null?void 0:a.isPublished)!=null&&dt[d]||!((ct=a==null?void 0:a.isPublished)!=null&&ct[l]))?"one":"both",readalready:w&&w.length>0&&w.includes(a.chapterId)?"true":"false",style:{backgroundColor:B,color:P},readbgcolor:N,readtextcolor:R,onClick:()=>{var ge,xe,ke,fe,me,ve,ye,Be;return c(a.chapterId,!((ge=a==null?void 0:a.isTranslated)!=null&&ge[d])&&!((xe=a==null?void 0:a.isTranslated)!=null&&xe[l])||!((ke=a==null?void 0:a.isPublished)!=null&&ke[d])&&!((fe=a==null?void 0:a.isPublished)!=null&&fe[l])?"none":(!((me=a.isTranslated)!=null&&me[d])||!((ve=a.isTranslated)!=null&&ve[l]))&&(!((ye=a==null?void 0:a.isPublished)!=null&&ye[d])||!((Be=a==null?void 0:a.isPublished)!=null&&Be[l]))?"one":"both")},children:s.jsx(J,{fontFamily:"Inter",fontWeight:"500",textAlign:"center",children:a.chapterNumber})},M)})})]})]})}function Ko(e){const[o,n]=b.useState([]);return b.useEffect(()=>{let t=e.subBooks;t&&t.sort((g,k)=>g.subBookNumber-k.subBookNumber),n(t)},[e.subBooks]),s.jsx(s.Fragment,{children:o&&o.length>0&&o.map((t,g)=>s.jsx(Ho,{id:`subbook-${t.subBookId}`,bookId:e.bookId,bookTitle:e.bookTitle,bookImage:e.bookImage,subBooks:o,subBookId:t.subBookId,subBookInfos:e.subBookInfos,currentUser:e.currentUser,userHistory:e.userHistory,openedSubBook:e.openedSubBook,terms:e.terms,moveToReading:e.moveToReading,onDownload:e.onDownload,onDownloadRefresh:e.onDownloadRefresh,handleOpenedSubBook:e.handleOpenedSubBook},g))})}function Go(e){const[o,n]=b.useState(""),[t,g]=b.useState([]),[k,m]=b.useState(1),[S,_]=b.useState([]),{theme:f,readingLanguage:y}=b.useContext(Pe),{backgroundColor:O,topTextColor:d,mainTextColor:l}=Ee(f),B=Bo(e.deviceHeight),P=k*B,U=P-B,E=e.currentUser&&t.slice(U,P);b.useEffect(()=>{var x,c,C,r,i,u;if(e.subBooks&&e.subBooks.length>0){const T=e.subBooks.map(v=>{var h;return{label:(h=v.subBookTitle)==null?void 0:h[y],value:v.subBookId}});T.unshift({label:((x=e.bookTitle)==null?void 0:x.en)=="Qur'an"||((c=e.bookTitle)==null?void 0:c.en)=="Zabur"?(r=(C=e.terms.texts.find(v=>v.variable=="All Chapters"))==null?void 0:C.text)==null?void 0:r[y]:(u=(i=e.terms.texts.find(v=>v.variable=="All SubBooks"))==null?void 0:i.text)==null?void 0:u[y],value:"all"}),_(T)}},[e.subBooks]),b.useEffect(()=>{S.length>0&&n(S[0].value)},[S]),b.useEffect(()=>{if(e.bookmark&&e.bookmark.length>0){const x=e.bookmark.filter(c=>c.subBookId===o);g(o==="all"||o===""?e.bookmark:x)}else g([]),m(0);k>1&&E.length==1&&m(x=>x-1)},[e.bookmark]);const N=(x,c)=>{m(c)},R=b.useCallback(x=>{const c=x.target.value;n(c);const C=e.bookmark.filter(r=>r.subBookId===c);g(c==="all"?e.bookmark:C)},[e.bookmark]),q=()=>{var x,c,C,r;return s.jsx(so,{style:{backgroundColor:O},children:s.jsx(So,{label:((c=(x=e.terms.texts.find(i=>i.variable=="Filter"))==null?void 0:x.text)==null?void 0:c[y])||"",detail:s.jsxs(no,{children:[s.jsx(J,{color:d,children:(r=(C=e.terms.texts.find(i=>i.variable=="Show"))==null?void 0:C.text)==null?void 0:r[y]}),s.jsx(Co,{label:"",options:S,value:o,backgroundColor:O,textColor:d,onChange:R})]})})})},w=()=>s.jsx(io,{children:(E==null?void 0:E.length)>0&&E.map((x,c)=>{var C,r,i,u,T,v,h,Z,ae,p,ee,te,oe,se,ce,ue,be;return s.jsxs(At,{children:[s.jsxs(lo,{children:[s.jsxs(ro,{onClick:()=>e.moveToReadingFromBookmark(x._id),children:[s.jsx(J,{color:l,children:(C=x.subBookTitle)==null?void 0:C[y]}),s.jsx(J,{color:l,children:x.bookTitle.en=="Qur'an"||x.bookTitle.en=="Zabur"?x.chapterNumber>0?`${(i=(r=e.terms.texts.find(D=>D.variable=="Surah Bookmark"))==null?void 0:r.text)==null?void 0:i[y]} ${x.chapterNumber}, ${(T=(u=e.terms.texts.find(D=>D.variable=="Aya"))==null?void 0:u.text)==null?void 0:T[y]} ${x.verseNumber}`:`${(h=(v=e.terms.texts.find(D=>D.variable=="Surah Bookmark"))==null?void 0:v.text)==null?void 0:h[y]} _ , ${(ae=(Z=e.terms.texts.find(D=>D.variable=="Aya"))==null?void 0:Z.text)==null?void 0:ae[y]} ${x.verseNumber}`:x.chapterNumber>0?`${(ee=(p=e.terms.texts.find(D=>D.variable=="Chapter Bookmark"))==null?void 0:p.text)==null?void 0:ee[y]} ${x.chapterNumber}, ${(oe=(te=e.terms.texts.find(D=>D.variable=="Aya"))==null?void 0:te.text)==null?void 0:oe[y]} ${x.verseNumber}`:`${(ce=(se=e.terms.texts.find(D=>D.variable=="Chapter Bookmark"))==null?void 0:se.text)==null?void 0:ce[y]} _ , ${(be=(ue=e.terms.texts.find(D=>D.variable=="Aya"))==null?void 0:ue.text)==null?void 0:be[y]} ${x.verseNumber}`})]}),s.jsx(co,{src:f==z.DEFAULT||f==z.EASY_OCEAN||f==z.EASY_SUNRISE?I.black_bookmark:I.white_bookmark,onClick:()=>e.removeBookmark(x._id)})]}),s.jsx(uo,{})]},c)})}),L=()=>s.jsx(bo,{buttoncolor:l,children:s.jsx(zo,{count:e.currentUser?Math.ceil(t.length/B):0,page:k,hidePrevButton:!0,hideNextButton:!0,onChange:N})}),X=()=>{var x,c;return s.jsxs(go,{style:{backgroundColor:O},children:[s.jsx(xo,{src:f==z.DEFAULT||f==z.BLACK_AND_WHITE?I.swipe:f==z.EASY_OCEAN?I.swipe_easyocean:I.swipe_white}),s.jsx(ko,{style:{color:d},children:(c=(x=e.terms.texts.find(C=>C.variable=="Bookmark Help"))==null?void 0:x.text)==null?void 0:c[y]})]})};return s.jsxs(ao,{children:[q(),w(),L(),X()]})}function Wo(e){var O,d,l,B;const[o,n]=b.useState(V),{theme:t,readingLanguage:g}=b.useContext(Pe),{mainBGColor:k,headerBGColor:m,buttonColor:S,buttonTextColor:_,mainTextColor:f}=Ee(t),y=P=>{e.currentUser?n(P):K.custom(U=>{var E,N;return s.jsx(G,{text:((N=(E=e.terms.texts.find(R=>R.variable=="Bookmark Read Description"))==null?void 0:E.text)==null?void 0:N[g])||"",visible:U.visible})})};return s.jsx(fo,{style:{backgroundColor:m},children:s.jsxs(mo,{style:{backgroundColor:k},children:[s.jsxs(vo,{children:[s.jsxs(ft,{active:o==V?"true":"false",style:{backgroundColor:o==V?S:k},bordercolor:f,onClick:()=>y(V),children:[s.jsx(mt,{src:t==z.DEFAULT?I.index:t==z.EASY_OCEAN?o==V?I.index_active:I.index:o==V?I.index:I.index_active}),s.jsx(vt,{active:o==V?"true":"false",children:s.jsx(J,{fontSize:16,fontWeight:"500",lineHeight:24,color:o==V?_:f,children:((d=(O=e.terms.texts.find(P=>P.variable=="Index"))==null?void 0:O.text)==null?void 0:d[g])||""})})]}),s.jsxs(ft,{active:o==V?"false":"true",style:{backgroundColor:o==_e?S:k},bordercolor:f,onClick:()=>y(_e),children:[s.jsx(mt,{src:t==z.DEFAULT?I.bookmark2_default:t==z.EASY_OCEAN?o==V?I.bookmark2_default:I.bookmark2_white:o==V?I.bookmark2_white:I.bookmark2_default}),s.jsx(vt,{active:o==V?"false":"true",children:s.jsx(J,{fontSize:16,fontWeight:"500",lineHeight:24,color:o==_e?_:f,children:((B=(l=e.terms.texts.find(P=>P.variable=="Bookmarks"))==null?void 0:l.text)==null?void 0:B[g])||""})})]})]}),o==V?s.jsx(Ko,{bookId:e.bookId,bookTitle:e.bookTitle,bookImage:e.bookImage,subBooks:e.subBooks,subBookInfos:e.subBookInfos,currentUser:e.currentUser,userHistory:e.userHistory,openedSubBook:e.openedSubBook,terms:e.terms,moveToReading:e.moveToReading,onDownload:e.onDownload,onDownloadRefresh:e.onDownloadRefresh,handleOpenedSubBook:e.handleOpenedSubBook}):s.jsx(Go,{bookTitle:e.bookTitle,subBooks:e.subBooks,currentUser:e.currentUser,bookmark:e.bookmark.filter(P=>P.bookId==e.bookId),deviceHeight:e.deviceHeight,terms:e.terms,moveToReadingFromBookmark:e.moveToReadingFromBookmark,removeBookmark:e.removeBookmark})]})})}const Vo=Lt,ie=Mt,Yo=1;class qo{constructor(){ut(this,"db",null)}async initDB(){return new Promise((o,n)=>{const t=indexedDB.open(Vo,Yo);t.onerror=()=>n(t.error),t.onsuccess=()=>{this.db=t.result,o()},t.onupgradeneeded=g=>{g.target.result.createObjectStore(ie,{keyPath:"subBookId"})}})}async saveSubBookInfo(o){return this.db||await this.initDB(),new Promise((n,t)=>{const m=this.db.transaction([ie],"readwrite").objectStore(ie).put(o);m.onerror=()=>t(m.error),m.onsuccess=()=>n()})}async getSubBookInfo(o){return this.db||await this.initDB(),new Promise((n,t)=>{const m=this.db.transaction([ie],"readonly").objectStore(ie).get(o);m.onerror=()=>t(m.error),m.onsuccess=()=>n(m.result)})}async removeSubBookInfo(o){return this.db||await this.initDB(),new Promise((n,t)=>{const m=this.db.transaction([ie],"readwrite").objectStore(ie).delete(o);m.onerror=()=>t(m.error),m.onsuccess=()=>n()})}}const he=new qo,Xo=de(At)({display:"flex",flexDirection:"column",margin:"auto",position:"relative",height:"100dvh"});function Zo(e){const[o,n]=b.useState(),[t,g]=b.useState(!1),[k,m]=b.useState(),[S,_]=b.useState(),f=Gt(),{height:y}=Fo(),{theme:O,readingLanguage:d}=b.useContext(Pe),{mainBGColor:l}=Ee(O),B=localStorage.getItem(It)||Ot,P=b.useCallback(()=>{e.currentBook&&St.fetchBookInfo(e.currentBook).then(r=>{var i,u,T;if(e.dispatch({type:A.ADD_BOOKINFO,payload:{bookInfo:r}}),n(r),e.currentUser&&!e.userHistory.some(h=>h.bookId==e.currentBook)&&r.subBooks){const h=r.subBooks.find(p=>p.subBookNumber==0),Z=(i=h==null?void 0:h.chapterInfos[0])==null?void 0:i.chapterId,ae=h==null?void 0:h.subBookId;(T=(u=h==null?void 0:h.chapterInfos[0])==null?void 0:u.isTranslated)!=null&&T[B]?N(Z,ae):K.custom(p=>{var ee,te,oe;return s.jsx(G,{text:((oe=(te=(ee=k==null?void 0:k.texts)==null?void 0:ee.find(se=>se.variable=="None Translated"))==null?void 0:te.text)==null?void 0:oe[d])||"",type:Ce.BOOKMARK,visible:p.visible})})}}).catch(r=>{K.custom(i=>s.jsx(G,{text:r,type:Ce.BOOKMARK,visible:i.visible}))}).finally(()=>{g(!1)})},[e.currentBook,e.dispatch,e.userHistory,e.currentUser]),U=b.useCallback(async r=>{try{const i=await St.fetchSubBookInfo(r);e.dispatch({type:A.ADD_SUBBOOKINFO,payload:{subBookInfo:i}}),e.dispatch({type:A.ADD_SUBBOOK,payload:{subBook:i}}),await he.saveSubBookInfo(i),g(!1)}catch(i){K.custom(u=>s.jsx(G,{text:i,visible:u.visible})),g(!1)}},[e.dispatch]);b.useEffect(()=>{var u,T;const r=e.terms.find(v=>v.pageTitle=="Index & Bookmark Page"),i=e.terms.find(v=>v.pageTitle=="Welcome Page");(u=r==null?void 0:r.isPublished)!=null&&u[d]?m(r):K.custom(v=>s.jsx(G,{text:"The terminologies for this page are not published.",visible:v.visible})),(T=i==null?void 0:i.isPublished)!=null&&T[d]?_(i):K.custom(v=>s.jsx(G,{text:"The terminologies for hamburgur menu are not published.",visible:v.visible}))},[e.terms]),b.useEffect(()=>{(async()=>{var i;g(!0),!((i=e.bookInfos)!=null&&i.length)||!e.bookInfos.some(u=>u.bookId===e.currentBook)?await P():(n(e.bookInfos.find(u=>u.bookId===e.currentBook)),g(!1))})(),e.currentUser&&Bt.fetchBookmarks().then(i=>{e.dispatch({type:A.SET_BOOKMARKS,payload:{bookmark:i}})}).catch(i=>{i.status===401&&i.response.data.message===bt&&(K.custom(u=>s.jsx(G,{text:i.response.data.message,visible:u.visible})),Re.logout(),f("/login"))})},[e.currentBook,e.bookInfos,e.currentUser,e.dispatch]),b.useEffect(()=>{if(e.currentSubBook&&e.prevPage===Ne.READING){const i=setTimeout(()=>{const u=document.getElementById(`subbook-${e.currentSubBook}`);u&&u.scrollIntoView({behavior:"smooth"})},100);return()=>clearTimeout(i)}},[e.currentSubBook,e.prevPage]);const E=()=>{K.custom(r=>{var i,u,T;return s.jsx(G,{text:((T=(u=(i=k==null?void 0:k.texts)==null?void 0:i.find(v=>v.variable=="Not Built Yet"))==null?void 0:u.text)==null?void 0:T[d])||"",visible:r.visible})})},N=(r,i)=>{e.dispatch({type:A.SET_CURRENT_CHAPTER,payload:{currentChapter:r}}),e.dispatch({type:A.SET_CURRENT_SUBBOOK,payload:{currentSubBook:i}}),e.dispatch({type:A.SET_PREVIOUS_PAGE,payload:{prevPage:Ne.BOOKS}}),f("/reading")},R=()=>{f("/library"),e.dispatch({type:A.SET_PREVIOUS_PAGE,payload:{prevPage:Ne.BOOKS}}),e.dispatch({type:A.SET_CURRENT_SUBBOOK,payload:{currentSubBook:""}})},q=b.useCallback(async r=>{g(!0),yt()<gt?await he.getSubBookInfo(r)?(await he.removeSubBookInfo(r),e.dispatch({type:A.REMOVE_SUBBOOKINFO,payload:{subBookId:r}})):await U(r):K.custom(u=>{var T,v,h;return s.jsx(G,{text:((h=(v=(T=k==null?void 0:k.texts)==null?void 0:T.find(Z=>Z.variable=="Not Enough Space"))==null?void 0:v.text)==null?void 0:h[d])||"",visible:u.visible})}),g(!1)},[U,e.dispatch]),w=b.useCallback(async r=>{g(!0),await he.removeSubBookInfo(r),e.dispatch({type:A.REMOVE_SUBBOOKINFO,payload:{subBookId:r}}),yt()<gt?await U(r):K.custom(u=>{var T,v,h;return s.jsx(G,{text:((h=(v=(T=k==null?void 0:k.texts)==null?void 0:T.find(Z=>Z.variable=="Not Enough Space"))==null?void 0:v.text)==null?void 0:h[d])||"",visible:u.visible})}),g(!1)},[U,e.dispatch]),L=b.useCallback(r=>{if(g(!0),e.bookmark&&e.bookmark.length>0){const i=e.bookmark.find(u=>u._id===r);if(i){const{chapterId:u,subBookId:T,verseId:v}=i;e.dispatch({type:A.SET_CURRENT_SUBBOOK,payload:{currentSubBook:T}}),e.dispatch({type:A.SET_CURRENT_CHAPTER,payload:{currentChapter:u}}),e.dispatch({type:A.SET_CURRENT_VERSE,payload:{currentVerse:v}}),f("/reading"),g(!1)}}},[e.currentBook,f,e.bookmark]),X=b.useCallback(r=>{g(!0),Bt.deleteBookmark(r).then(i=>{e.dispatch({type:A.REMOVE_BOOKMARK,payload:{bookmarkId:r}}),K.custom(u=>s.jsx(G,{text:i.message,type:Ce.BOOKMARK,visible:u.visible})),g(!1)}).catch(i=>{i.status==401&&i.response.data.message==bt&&(K.custom(u=>s.jsx(G,{text:i.response.data.message,type:Ce.BOOKMARK,visible:u.visible})),Re.logout(),f("/login")),g(!1)})},[e.dispatch]),x=b.useCallback(r=>{e.dispatch({type:A.SET_CURRENT_SUBBOOK,payload:{currentSubBook:e.currentSubBook===r?"":r}})},[e.currentSubBook,e.dispatch]),c=()=>{e.dispatch({type:A.RESET_USER}),e.dispatch({type:A.RESET_BOOK}),e.dispatch({type:A.RESET_PAGE_STATUS}),Re.logout()},C=()=>{f("/login")};return s.jsxs(Xo,{style:{backgroundColor:l},children:[s.jsx(yo,{markImg:o&&zt+o.bookImage,markTitle:o==null?void 0:o.bookTitle,isLogIn:!!e.currentUser,terms:k||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},welcomePageTerms:S||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},onLogoClick:()=>f("/"),onCloseClick:R,onLogin:e.currentUser?c:C,onSettings:()=>f("/settings"),onSearchClick:E}),s.jsx(Wo,{bookId:e.currentBook,bookTitle:o==null?void 0:o.bookTitle,bookImage:o==null?void 0:o.bookImage,subBooks:o==null?void 0:o.subBooks,deviceHeight:y,subBookInfos:e.subBookInfos,userHistory:e.userHistory,currentUser:e.currentUser,bookmark:e.bookmark,openedSubBook:e.currentSubBook,terms:k||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},moveToReading:N,moveToReadingFromBookmark:L,onDownload:q,onDownloadRefresh:w,removeBookmark:X,handleOpenedSubBook:x}),t&&s.jsx(ho,{})]})}function Qo(e){return{userHistory:e.books.userHistory,bookmark:e.books.bookmark,subBookInfos:e.books.subBookInfos,bookInfos:e.books.bookInfos,terms:e.terms.terms,currentBook:e.pageStatus.currentBook,currentBookPageOpenTab:e.pageStatus.currentBookPageOpenTab,currentSubBook:e.pageStatus.currentSubBook,prevPage:e.pageStatus.prevPage,currentUser:e.user.currentUser,activeChapterId:e.books.activeChapterId}}const ba=Kt(Qo)(Zo);export{ba as default};

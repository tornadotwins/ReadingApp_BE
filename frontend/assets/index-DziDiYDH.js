var ie=Object.defineProperty;var ae=(e,o,i)=>o in e?ie(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i;var p=(e,o,i)=>ae(e,typeof o!="symbol"?o+"":o,i);import{b as l,j as t,a3 as m,X as se,ap as J,ay as D}from"./index-BlVR3GtE.js";import{s as r,B as u,S as T,g as Y,J as re,c as le,u as de,k as C,d as g}from"./App-BwzROJtC.js";import{I as h,T as L}from"./index-T3aZZFzM.js";import{L as ce}from"./index-C_H5WnYP.js";import{C as I}from"./index-CKKuGpuV.js";import{H as ue}from"./index-C7xhiutE.js";import{a as he}from"./auth.service-BbDv6u2-.js";import{a as M}from"./axios-upsvKRUO.js";import{i as _}from"./indexedDB.service-KlEqTZIR.js";import"./index-BandVPnE.js";const ye=r(u)({display:"flex",position:"relative",width:"100%"}),ge=r("img")({width:"100%",marginTop:"57px"}),xe=r(u)({display:"flex",alignItems:"baseline",justifyContent:"space-between",position:"absolute",left:"30px",top:"30px",width:"calc(100% - 60px)"}),me=r(u)({display:"flex",flexDirection:"column"}),fe=r(u)({width:"40px",cursor:"pointer",position:"relative","& div":{position:"absolute",top:"28px",width:"100%",textAlign:"center",maxWidth:"65px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}}),Ce=r("img")({width:"100%",height:"100%"}),Ie=r(u)({margin:0,position:"relative",top:"-20px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",userSelect:"none"}),Se=r(u)(({hamburgercolor:e})=>({position:"absolute",top:"12px",right:"15px",width:"46px","& .hamburger-react":{width:"46px !important",color:e},"& .hamburger-react ~ .MuiBox-root ":{border:`1px solid ${e}`},"@media (max-height: 639px)":{top:"8px",right:"10px"},"@media screen and (orientation: landscape)":{right:"15px"}})),we=r("img")({position:"relative",top:"10px",cursor:"pointer","&:active":{opacity:"0.8"}}),be=r(u)({position:"absolute",top:"60px",left:"50%",transform:"translate(-50%, -50%)",cursor:"pointer"}),_e=r("img")({width:"100%","&:active":{opacity:"0.8"}});r("img")({position:"absolute",top:"18px",right:"30px",cursor:"pointer","&:active":{opacity:"0.8"}});const je=r(u)({height:"calc(100dvh - 145px)",width:"100%",position:"absolute",top:"145px",padding:"0px 30px","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),ve=r(u)({backgroundColor:"#FFF",height:"calc(100dvh - 145px)",position:"relative",zIndex:"1",display:"flex",flexDirection:"column",padding:"20px",overflowY:"scroll","@media screen and (orientation: landscape)":{height:"calc(100dvh - 145px)"}}),Ee=r(u)(({showbtn:e})=>({width:"100%",display:e==="true"?"none":"flex",alignItems:"center",marginBottom:"10px",svg:{fill:"#1B7695"}})),ke=r(u)({padding:0,boxSizing:"border-box",display:"flex",flexDirection:"column"}),Ae=r(u)({backgroundColor:"#F0F5FB",padding:"9px 11px",marginBottom:"10px",boxSizing:"border-box",display:"flex",alignItems:"center",justifyContent:"space-between"}),De=r(u)({width:"calc(100% - 65px)",display:"flex",flexDirection:"column",alignItems:"center",marginRight:"20px"}),Je=r(u)({width:"100%",display:"flex",alignItems:"center"}),Te=r(u)({width:"15px",height:"15px",marginRight:"10px"}),Be=r("img")({width:"100%",height:"100%"}),Re=r(u)({width:"100%","& .MuiBox-root":{width:"100%",display:"-webkit-box",justifyContent:"center",overflow:"hidden",textOverflow:"ellipsis",WebkitLineClamp:"2",WebkitBoxOrient:"vertical"}}),H=r(u)(({isdownloaded:e})=>({width:"45px",display:"flex",alignItems:"center",justifyContent:e=="true"?"space-between":"flex-end",cursor:"pointer"})),P=r("img")({width:"16px",height:"16px"});function pe(e){const{theme:o}=l.useContext(T),{logoTextColor:i,headerBGColor:x}=Y(o);return t.jsxs(ye,{children:[t.jsx(ge,{src:o==m.DEFAULT||o==m.DARK?h.book_subtract:o==m.BLACK_AND_WHITE?h.book_subtract_BAW:o==m.SAPPHIRE?h.book_subtract_sapphire:h.book_subtract_easyocean}),t.jsxs(xe,{children:[t.jsxs(me,{children:[t.jsx(fe,{onClick:e.onLogoClick,children:t.jsx(Ce,{src:e.markImg})}),t.jsx(Ie,{children:t.jsx(L,{fontFamily:"Buenard",fontWeight:"700",fontSize:36,lineHeight:47,textAlign:"center",color:i,children:e.markTitle})})]}),t.jsx(we,{src:o==m.EASY_OCEAN?h.search_easyocean:h.search,onClick:e.onSearchClick})]}),t.jsx(be,{children:t.jsx(_e,{src:o==m.DEFAULT||o==m.DARK?h.close2:o==m.BLACK_AND_WHITE?h.close2_BAW:o==m.SAPPHIRE?h.close2_sapphire:h.close2_easyocean,onClick:e.onCloseClick})}),t.jsx(Se,{hamburgercolor:x,children:t.jsx(ue,{isLogin:e.isLoggedIn,textColor:i,itemBgColor:x,toggleColor:x,terms:e.welcomePageTerms,onLogin:e.onLogin,onSettings:e.onSettings})})]})}var O={},Pe=se;Object.defineProperty(O,"__esModule",{value:!0});var G=O.default=void 0,Le=Pe(re()),Oe=t;G=O.default=(0,Le.default)((0,Oe.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBack");function Ne(e){const{theme:o}=l.useContext(T);return t.jsxs(Ae,{children:[t.jsxs(De,{onClick:()=>e.onCardClick(e.cardId),children:[t.jsxs(Je,{children:[t.jsx(Te,{children:t.jsx(Be,{src:J+e.image})}),t.jsx(L,{fontFamily:"Inter",fontWeight:"400",fontSize:12,lineHeight:24,color:"#899093",children:e.seriesTitle})]}),t.jsx(Re,{children:t.jsx(L,{fontFamily:"Inter",fontWeight:"700",fontSize:16,lineHeight:24,color:"#000",children:e.title})})]}),t.jsxs(t.Fragment,{children:[!e.isDownloaded&&t.jsx(H,{isdownloaded:e.isDownloaded?"true":"false",children:t.jsx(P,{src:o==m.DEFAULT||o==m.EASY_OCEAN?h.download:h.download_white,onClick:()=>e.onDownload(e.cardId)})}),e.isDownloaded&&t.jsxs(H,{isdownloaded:e.isDownloaded?"true":"false",children:[t.jsx(P,{src:o==m.DEFAULT||o==m.EASY_OCEAN?h.download_refresh:h.download_refresh_white,onClick:()=>e.onRefresh(e.cardId)}),t.jsx(P,{src:o==m.DEFAULT||o==m.EASY_OCEAN?h.download_cancel:h.download_cancel_white,onClick:()=>e.onCancel(e.cardId)})]})]})]})}function Ue(e){var o;return t.jsx(ke,{children:(o=e.cards)==null?void 0:o.map((i,x)=>{var S,y,v;return t.jsx(Ne,{cardId:i._id,image:i==null?void 0:i.image,seriesTitle:(S=i==null?void 0:i.seriesTitle)==null?void 0:S.en,title:(y=i==null?void 0:i.title)==null?void 0:y.en,isDownloaded:(v=e.downloadedJourneyIds)==null?void 0:v.includes(i==null?void 0:i._id),onCardClick:()=>e.onCardClick(i._id),onDownload:e.onDownload,onRefresh:e.onRefresh,onCancel:e.onCancel},x)})})}function Fe(e){const{theme:o}=l.useContext(T),{mainBGColor:i,headerBGColor:x}=Y(o);return t.jsx(je,{style:{backgroundColor:x},children:t.jsxs(ve,{style:{backgroundColor:i},children:[t.jsx(Ee,{onClick:e.onBack,showbtn:e.showBackBtn?"false":"true",children:t.jsx(G,{})}),t.jsx(Ue,{cards:e.journeyItems,downloadedJourneyIds:e.downloadedJourneyIds,onCardClick:e.onCardClick,onDownload:e.onDownload,onRefresh:e.onRefresh,onCancel:e.onCancel})]})})}class Me{constructor(){p(this,"fetchJourneyInfo",o=>new Promise((i,x)=>{const S=J+`/journey/${o}/journeys`;M.get(S).then(y=>{y.data?i(y.data):x(y.data.error)}).catch(y=>{x(this.getErrorMessage(y))})}));p(this,"fetchHierarchy",o=>new Promise((i,x)=>{const S=J+`/journey/${o}/hierarchy`;M.get(S).then(y=>{y.data?i(y.data):x(y.data.error)}).catch(y=>{x(this.getErrorMessage(y))})}))}getErrorMessage(o){let i=o.message;return o.response&&o.response.data&&o.response.data.message&&(i=o.response.data.message),i}}const W=new Me,He=r(u)({display:"flex",flexDirection:"column",margin:"auto",position:"relative",height:"100dvh"});function We(e){const[o,i]=l.useState(!1),[x,S]=l.useState(""),[y,v]=l.useState(""),[E,k]=l.useState([]),[A,z]=l.useState(),[K,q]=l.useState(),[V,N]=l.useState(!1),{readingLanguage:w}=l.useContext(T),j=de();l.useEffect(()=>{var s,d;const a=e.terms.find(c=>c.pageTitle==="Index & Bookmark Page"),n=e.terms.find(c=>c.pageTitle==="Welcome Page");(s=a==null?void 0:a.isPublished)!=null&&s[w]?z(a):C.custom(c=>t.jsx(I,{text:"The terminologies for this page are not published.",visible:c.visible})),(d=n==null?void 0:n.isPublished)!=null&&d[w]?q(n):C.custom(c=>t.jsx(I,{text:"The terminologies for hamburger menu are not published.",visible:c.visible}))},[e.terms,w]),l.useEffect(()=>{var s,d;const n=(((s=e.books[1])==null?void 0:s.books)||[]).find(c=>(c==null?void 0:c._id)===e.currentBook);n&&(S(J+n.markImage||h.default_cover),v(((d=n==null?void 0:n.title)==null?void 0:d[w])||"Title"))},[e.books,e.currentBook,w]);const B=l.useCallback(a=>{var s;const n=(s=e.journeyCardInfos)==null?void 0:s.filter(d=>d.parent===a);return n.length>0?(k(n),n):(k([]),[])},[e.journeyCardInfos]),U=l.useCallback(a=>{W.fetchJourneyInfo(a).then(n=>{e.dispatch({type:g.ADD_JOURNEY_CARD_INFOS,payload:{cards:n.cards}}),k(n.cards)}).catch(n=>C.custom(s=>t.jsx(I,{text:n,visible:s.visible})))},[]);l.useEffect(()=>{_.getAllJourneyIds().then(a=>{e.dispatch({type:g.SET_DOWNLOADED_JOURNEY_IDS,payload:{downloadedJourneyIds:a}})}),_.getAllArticleIds().then(a=>{e.dispatch({type:g.SET_DOWNLOADED_ARTICLE_IDS,payload:{downloadedArticleIds:a}})})},[]),l.useCallback(async a=>{i(!0),_.getJourneyCards(a).then(n=>{e.dispatch({type:g.ADD_JOURNEY_CARD_INFOS,payload:{cards:n}}),k(n)}).catch(n=>C.custom(s=>t.jsx(I,{text:n,visible:s.visible}))),i(!1)},[]),l.useEffect(()=>{i(!0),e.prevPage===D.LIBRARY||e.prevPage===D.READING&&e.parentJourneyId==e.currentBook?(B(e.currentBook).length===0&&U(e.currentBook),e.dispatch({type:g.SET_PREVIOUS_PAGE,payload:{prevPage:D.JOURNEYS}})):e.parentJourneyId&&B(e.parentJourneyId).length===0&&U(e.parentJourneyId),i(!1)},[e.currentBook,e.prevPage,e.parentJourneyId]),l.useEffect(()=>{E.length>0&&E[0].depth!=1?N(!0):N(!1)},[E]);const $=()=>{var n,s,d;const a=((d=(s=(n=A==null?void 0:A.texts)==null?void 0:n.find(c=>c.variable==="Not Built Yet"))==null?void 0:s.text)==null?void 0:d[w])||"";C.custom(c=>t.jsx(I,{text:a,visible:c.visible}))},X=()=>{j("/library"),e.dispatch({type:g.SET_PREVIOUS_PAGE,payload:{prevPage:D.JOURNEYS}}),e.dispatch({type:g.SET_PARENT,payload:{parent:""}})},Q=()=>{e.dispatch({type:g.RESET_USER}),e.dispatch({type:g.RESET_BOOK}),e.dispatch({type:g.RESET_PAGE_STATUS}),he.logout()},Z=()=>j("/login"),ee=l.useCallback(()=>{var n;const a=(n=e.journeyCardInfos)==null?void 0:n.find(s=>s._id===e.parentJourneyId);B((a==null?void 0:a.parent)||""),e.dispatch({type:g.SET_PARENT,payload:{parentId:(a==null?void 0:a.parent)||""}})},[e.parentJourneyId,e.journeyCardInfos]),te=l.useCallback(a=>{var n,s;(s=(n=e.journeyCardInfos)==null?void 0:n.find(d=>(d==null?void 0:d._id)===a))!=null&&s.isArticle?(e.dispatch({type:g.SET_CURRENT_ARTICLE,payload:{articleId:a}}),j("/Reading")):e.dispatch({type:g.SET_PARENT,payload:{parentId:a}})},[e.journeyCardInfos]),ne=l.useCallback((a,n)=>{i(!0),Promise.all([_.saveJourneys(a),_.saveArticleInfo(n)]).then(()=>{C.custom(s=>t.jsx(I,{text:"Downloaded successfully",visible:s.visible}))}).catch(s=>{C.custom(d=>t.jsx(I,{text:s,visible:d.visible}))}).finally(()=>{i(!1)})},[]),F=a=>{W.fetchHierarchy(a).then(n=>{const s=n.journeys,d=n.articles,c=e.downloadedJourneyIds?s.filter(f=>!e.downloadedJourneyIds.includes(f._id)):s,R=e.downloadedArticleIds?d.filter(f=>{var b;return!((b=e.downloadedArticleIds)!=null&&b.includes(f._id))&&f.isArticle}):s.filter(f=>f.isArticle);if(c&&c.length>0){const f=c.map(b=>b._id)||[];f.push(a),e.dispatch({type:g.ADD_DOWNLOADED_JOURNEY_IDS,payload:{downloadedJourneyIds:f}})}if(R&&R.length>0){const f=R.map(b=>b._id)||[];f.push(a),e.dispatch({type:g.ADD_DOWNLOADED_ARTICLE_IDS,payload:{downloadedArticleIds:f}})}ne(s,d)}).catch(n=>C.custom(s=>t.jsx(I,{text:n,visible:s.visible})))},oe=a=>{_.removeJourneyInfo(a).then(n=>{C.custom(s=>t.jsx(I,{text:"Download canceled",visible:s.visible})),e.dispatch({type:g.REMOVE_DOWNLOADED_JOURNEY_IDS,payload:{journeyIds:n}})}).catch(n=>C.custom(s=>t.jsx(I,{text:n,visible:s.visible})))};return t.jsxs(He,{children:[t.jsx(pe,{markImg:x,markTitle:y,isLoggedIn:!!e.currentUser,terms:A||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},welcomePageTerms:K||{pageId:"",pageNumber:0,pageTitle:"",isCompleted:{},isPublished:{},texts:[]},onLogoClick:()=>j("/"),onCloseClick:X,onLogin:e.currentUser?Q:Z,onSettings:()=>j("/settings"),onSearchClick:$}),t.jsx(Fe,{currentUser:e.currentUser,journeyItems:E||[],showBackBtn:V,downloadedJourneyIds:e.downloadedJourneyIds,onBack:ee,onCardClick:te,onDownload:F,onRefresh:F,onCancel:oe}),o&&t.jsx(ce,{})]})}function Ye(e){return{currentBook:e.pageStatus.currentBook,books:e.books.books,currentUser:e.user.currentUser,parentJourneyId:e.journeys.parentId,journeyCardInfos:e.journeys.journeyCardInfos,downloadedJourneyIds:e.journeys.downloadedJourneyIds,downloadedArticleIds:e.journeys.downloadedArticleIds,terms:e.terms.terms,prevPage:e.pageStatus.prevPage}}const nt=le(Ye)(We);export{nt as default};
